--
-- Test domains.
--

-- Test Comment / Drop
create domain domaindroptest int4
ERROR: --
-- Test domains.
--

-- Test Comment / Drop
create domain domaindroptest int4

Parser Error: syntax error at or near "domain"

comment on domain domaindroptest is 'About to drop this..'
ERROR: 
comment on domain domaindroptest is 'About to drop this..'

Parser Error: syntax error at or near "domain"


create domain dependenttypetest domaindroptest
ERROR: 

create domain dependenttypetest domaindroptest

Parser Error: syntax error at or near "domain"


-- fail because of dependent type
drop domain domaindroptest
ERROR: 

-- fail because of dependent type
drop domain domaindroptest

Parser Error: syntax error at or near "domain"


drop domain domaindroptest cascade
ERROR: 

drop domain domaindroptest cascade

Parser Error: syntax error at or near "domain"


-- this should fail because already gone
drop domain domaindroptest cascade
ERROR: 

-- this should fail because already gone
drop domain domaindroptest cascade

Parser Error: syntax error at or near "domain"



-- Test domain input.

-- Note: the point of checking both INSERT and COPY FROM is that INSERT
-- exercises CoerceToDomain while COPY exercises domain_in.

create domain domainvarchar varchar(5)
ERROR: 


-- Test domain input.

-- Note: the point of checking both INSERT and COPY FROM is that INSERT
-- exercises CoerceToDomain while COPY exercises domain_in.

create domain domainvarchar varchar(5)

Parser Error: syntax error at or near "domain"

create domain domainnumeric numeric(8,2)
ERROR: 
create domain domainnumeric numeric(8,2)

Parser Error: syntax error at or near "domain"

create domain domainint4 int4
ERROR: 
create domain domainint4 int4

Parser Error: syntax error at or near "domain"

create domain domaintext text
ERROR: 
create domain domaintext text

Parser Error: syntax error at or near "domain"


-- Test explicit coercions --- these should succeed (and truncate)
SELECT cast('123456' as domainvarchar)
ERROR: 

-- Test explicit coercions --- these should succeed (and truncate)
SELECT cast('123456' as domainvarchar)

Catalog Error: Type with name domainvarchar does not exist!
Did you mean "nvarchar"?

SELECT cast('12345' as domainvarchar)
ERROR: 
SELECT cast('12345' as domainvarchar)

Catalog Error: Type with name domainvarchar does not exist!
Did you mean "nvarchar"?


-- Test tables using domains
create table basictest
           ( testint4 domainint4
           , testtext domaintext
           , testvarchar domainvarchar
           , testnumeric domainnumeric
           )
ERROR: 

-- Test tables using domains
create table basictest
           ( testint4 domainint4
           , testtext domaintext
           , testvarchar domainvarchar
           , testnumeric domainnumeric
           )

Catalog Error: Type with name domainint4 does not exist!
Did you mean "int4"?


INSERT INTO basictest values ('88', 'haha', 'short', '123.12')
ERROR: 

INSERT INTO basictest values ('88', 'haha', 'short', '123.12')

Catalog Error: Table with name basictest does not exist!
Did you mean "temp.information_schema.schemata"?
      -- Good
INSERT INTO basictest values ('88', 'haha', 'short text', '123.12')
ERROR:       -- Good
INSERT INTO basictest values ('88', 'haha', 'short text', '123.12')

Catalog Error: Table with name basictest does not exist!
Did you mean "temp.information_schema.schemata"?
 -- Bad varchar
INSERT INTO basictest values ('88', 'haha', 'short', '123.1212')
ERROR:  -- Bad varchar
INSERT INTO basictest values ('88', 'haha', 'short', '123.1212')

Catalog Error: Table with name basictest does not exist!
Did you mean "temp.information_schema.schemata"?
    -- Truncate numeric

-- Test copy
COPY basictest (testvarchar) FROM stdin
ERROR:     -- Truncate numeric

-- Test copy
COPY basictest (testvarchar) FROM stdin

Catalog Error: Table with name basictest does not exist!
Did you mean "temp.information_schema.schemata"?
 -- fail
notsoshorttext
\.

COPY basictest (testvarchar) FROM stdin
ERROR:  -- fail
notsoshorttext
\.

COPY basictest (testvarchar) FROM stdin

Parser Error: syntax error at or near "notsoshorttext"

short
\.

select * from basictest
ERROR: 
short
\.

select * from basictest

Parser Error: syntax error at or near "short"


-- check that domains inherit operations from base types
select testtext || testvarchar as concat, testnumeric + 42 as sum
from basictest
ERROR: 

-- check that domains inherit operations from base types
select testtext || testvarchar as concat, testnumeric + 42 as sum
from basictest

Catalog Error: Table with name basictest does not exist!
Did you mean "temp.information_schema.schemata"?


-- check that union/case/coalesce type resolution handles domains properly
select pg_typeof(coalesce(4::domainint4, 7))
ERROR: 

-- check that union/case/coalesce type resolution handles domains properly
select pg_typeof(coalesce(4::domainint4, 7))

Catalog Error: Type with name domainint4 does not exist!
Did you mean "int4"?

select pg_typeof(coalesce(4::domainint4, 7::domainint4))
ERROR: 
select pg_typeof(coalesce(4::domainint4, 7::domainint4))

Catalog Error: Type with name domainint4 does not exist!
Did you mean "int4"?


drop table basictest
ERROR: 

drop table basictest

Catalog Error: Table with name basictest does not exist!
Did you mean "temp.information_schema.schemata"?

drop domain domainvarchar restrict
ERROR: 
drop domain domainvarchar restrict

Parser Error: syntax error at or near "domain"

drop domain domainnumeric restrict
ERROR: 
drop domain domainnumeric restrict

Parser Error: syntax error at or near "domain"

drop domain domainint4 restrict
ERROR: 
drop domain domainint4 restrict

Parser Error: syntax error at or near "domain"

drop domain domaintext
ERROR: 
drop domain domaintext

Parser Error: syntax error at or near "domain"



-- Test non-error-throwing input

create domain positiveint int4 check(value > 0)
ERROR: 


-- Test non-error-throwing input

create domain positiveint int4 check(value > 0)

Parser Error: syntax error at or near "domain"

create domain weirdfloat float8 check((1 / value) < 10)
ERROR: 
create domain weirdfloat float8 check((1 / value) < 10)

Parser Error: syntax error at or near "domain"


select pg_input_is_valid('1', 'positiveint')
ERROR: 

select pg_input_is_valid('1', 'positiveint')

Catalog Error: Scalar Function with name pg_input_is_valid does not exist!
Did you mean "json_valid"?

select pg_input_is_valid('junk', 'positiveint')
ERROR: 
select pg_input_is_valid('junk', 'positiveint')

Catalog Error: Scalar Function with name pg_input_is_valid does not exist!
Did you mean "json_valid"?

select pg_input_is_valid('-1', 'positiveint')
ERROR: 
select pg_input_is_valid('-1', 'positiveint')

Catalog Error: Scalar Function with name pg_input_is_valid does not exist!
Did you mean "json_valid"?

select * from pg_input_error_info('junk', 'positiveint')
ERROR: 
select * from pg_input_error_info('junk', 'positiveint')

Catalog Error: Table Function with name pg_input_error_info does not exist!
Did you mean "pragma_storage_info"?

select * from pg_input_error_info('-1', 'positiveint')
ERROR: 
select * from pg_input_error_info('-1', 'positiveint')

Catalog Error: Table Function with name pg_input_error_info does not exist!
Did you mean "pragma_storage_info"?

select * from pg_input_error_info('junk', 'weirdfloat')
ERROR: 
select * from pg_input_error_info('junk', 'weirdfloat')

Catalog Error: Table Function with name pg_input_error_info does not exist!
Did you mean "pragma_storage_info"?

select * from pg_input_error_info('0.01', 'weirdfloat')
ERROR: 
select * from pg_input_error_info('0.01', 'weirdfloat')

Catalog Error: Table Function with name pg_input_error_info does not exist!
Did you mean "pragma_storage_info"?

-- We currently can''t trap errors raised in the CHECK expression itself
select * from pg_input_error_info('0', 'weirdfloat')
ERROR: 
-- We currently can''t trap errors raised in the CHECK expression itself
select * from pg_input_error_info('0', 'weirdfloat')

Catalog Error: Table Function with name pg_input_error_info does not exist!
Did you mean "pragma_storage_info"?


drop domain positiveint
ERROR: 

drop domain positiveint

Parser Error: syntax error at or near "domain"

drop domain weirdfloat
ERROR: 
drop domain weirdfloat

Parser Error: syntax error at or near "domain"



-- Test domains over array types

create domain domainint4arr int4[1]
ERROR: 


-- Test domains over array types

create domain domainint4arr int4[1]

Parser Error: syntax error at or near "domain"

create domain domainchar4arr varchar(4)[2][3]
ERROR: 
create domain domainchar4arr varchar(4)[2][3]

Parser Error: syntax error at or near "domain"


create table domarrtest
           ( testint4arr domainint4arr
           , testchar4arr domainchar4arr
            )
ERROR: 

create table domarrtest
           ( testint4arr domainint4arr
           , testchar4arr domainchar4arr
            )

Catalog Error: Type with name domainint4arr does not exist!
Did you mean "int4"?

INSERT INTO domarrtest values ('{2,2}', '{{"a","b"},{"c","d"}}')
ERROR: 
INSERT INTO domarrtest values ('{2,2}', '{{"a","b"},{"c","d"}}')

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO domarrtest values ('{{2,2},{2,2}}', '{{"a","b"}}')
ERROR: 
INSERT INTO domarrtest values ('{{2,2},{2,2}}', '{{"a","b"}}')

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO domarrtest values ('{2,2}', '{{"a","b"},{"c","d"},{"e","f"}}')
ERROR: 
INSERT INTO domarrtest values ('{2,2}', '{{"a","b"},{"c","d"},{"e","f"}}')

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO domarrtest values ('{2,2}', '{{"a"},{"c"}}')
ERROR: 
INSERT INTO domarrtest values ('{2,2}', '{{"a"},{"c"}}')

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO domarrtest values (NULL, '{{"a","b","c"},{"d","e","f"}}')
ERROR: 
INSERT INTO domarrtest values (NULL, '{{"a","b","c"},{"d","e","f"}}')

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO domarrtest values (NULL, '{{"toolong","b","c"},{"d","e","f"}}')
ERROR: 
INSERT INTO domarrtest values (NULL, '{{"toolong","b","c"},{"d","e","f"}}')

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO domarrtest (testint4arr[1], testint4arr[3]) values (11,22)
ERROR: 
INSERT INTO domarrtest (testint4arr[1], testint4arr[3]) values (11,22)

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

select * from domarrtest
ERROR: 
select * from domarrtest

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

select testint4arr[1], testchar4arr[2:2] from domarrtest
ERROR: 
select testint4arr[1], testchar4arr[2:2] from domarrtest

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

select array_dims(testint4arr), array_dims(testchar4arr) from domarrtest
ERROR: 
select array_dims(testint4arr), array_dims(testchar4arr) from domarrtest

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?


COPY domarrtest FROM stdin
ERROR: 

COPY domarrtest FROM stdin

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

{3,4}	{q,w,e}
\N	\N
\.

COPY domarrtest FROM stdin
ERROR: 
{3,4}	{q,w,e}
\N	\N
\.

COPY domarrtest FROM stdin

Parser Error: syntax error at or near "{"
	-- fail
{3,4}	{qwerty,w,e}
\.

select * from domarrtest
ERROR: 	-- fail
{3,4}	{qwerty,w,e}
\.

select * from domarrtest

Parser Error: syntax error at or near "{"


update domarrtest set
  testint4arr[1] = testint4arr[1] + 1,
  testint4arr[3] = testint4arr[3] - 1
where testchar4arr is null
ERROR: 

update domarrtest set
  testint4arr[1] = testint4arr[1] + 1,
  testint4arr[3] = testint4arr[3] - 1
where testchar4arr is null

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?
LINE 3: update domarrtest set
               ^


select * from domarrtest where testchar4arr is null
ERROR: 

select * from domarrtest where testchar4arr is null

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?


drop table domarrtest
ERROR: 

drop table domarrtest

Catalog Error: Table with name domarrtest does not exist!
Did you mean "temp.information_schema.tables"?

drop domain domainint4arr restrict
ERROR: 
drop domain domainint4arr restrict

Parser Error: syntax error at or near "domain"

drop domain domainchar4arr restrict
ERROR: 
drop domain domainchar4arr restrict

Parser Error: syntax error at or near "domain"


create domain dia as int[]
ERROR: 

create domain dia as int[]

Parser Error: syntax error at or near "domain"

select '{1,2,3}'::dia
ERROR: 
select '{1,2,3}'::dia

Catalog Error: Type with name dia does not exist!
Did you mean "date"?

select array_dims('{1,2,3}'::dia)
ERROR: 
select array_dims('{1,2,3}'::dia)

Catalog Error: Scalar Function with name array_dims does not exist!
Did you mean "array_has"?

select pg_typeof('{1,2,3}'::dia)
ERROR: 
select pg_typeof('{1,2,3}'::dia)

Catalog Error: Type with name dia does not exist!
Did you mean "date"?

select pg_typeof('{1,2,3}'::dia || 42)
ERROR: 
select pg_typeof('{1,2,3}'::dia || 42)

Catalog Error: Type with name dia does not exist!
Did you mean "date"?
 -- should be int[] not dia
drop domain dia
ERROR:  -- should be int[] not dia
drop domain dia

Parser Error: syntax error at or near "domain"



-- Test domains over composites

create type comptype as (r float8, i float8)
ERROR: 


-- Test domains over composites

create type comptype as (r float8, i float8)

Parser Error: syntax error at or near "("

create domain dcomptype as comptype
ERROR: 
create domain dcomptype as comptype

Parser Error: syntax error at or near "domain"

create table dcomptable (d1 dcomptype unique)
ERROR: 
create table dcomptable (d1 dcomptype unique)

Catalog Error: Type with name dcomptype does not exist!
Did you mean "date"?


insert into dcomptable values (row(1,2)::dcomptype)
ERROR: 

insert into dcomptable values (row(1,2)::dcomptype)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable values (row(3,4)::comptype)
ERROR: 
insert into dcomptable values (row(3,4)::comptype)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable values (row(1,2)::dcomptype)
ERROR: 
insert into dcomptable values (row(1,2)::dcomptype)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail on uniqueness
insert into dcomptable (d1.r) values(11)
ERROR:   -- fail on uniqueness
insert into dcomptable (d1.r) values(11)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?


select * from dcomptable
ERROR: 

select * from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

select (d1).r, (d1).i, (d1).* from dcomptable
ERROR: 
select (d1).r, (d1).i, (d1).* from dcomptable

Parser Error: syntax error at or near "*"

update dcomptable set d1.r = (d1).r + 1 where (d1).i > 0
ERROR: 
update dcomptable set d1.r = (d1).r + 1 where (d1).i > 0

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set d1.r = (d1).r + 1 where...
               ^

select * from dcomptable
ERROR: 
select * from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?


alter domain dcomptype add constraint c1 check ((value).r <= (value).i)
ERROR: 

alter domain dcomptype add constraint c1 check ((value).r <= (value).i)

Parser Error: syntax error at or near "domain"

alter domain dcomptype add constraint c2 check ((value).r > (value).i)
ERROR: 
alter domain dcomptype add constraint c2 check ((value).r > (value).i)

Parser Error: syntax error at or near "domain"
  -- fail

select row(2,1)::dcomptype
ERROR:   -- fail

select row(2,1)::dcomptype

Catalog Error: Type with name dcomptype does not exist!
Did you mean "date"?
  -- fail
insert into dcomptable values (row(1,2)::comptype)
ERROR:   -- fail
insert into dcomptable values (row(1,2)::comptype)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable values (row(2,1)::comptype)
ERROR: 
insert into dcomptable values (row(2,1)::comptype)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail
insert into dcomptable (d1.r) values(99)
ERROR:   -- fail
insert into dcomptable (d1.r) values(99)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable (d1.r, d1.i) values(99, 100)
ERROR: 
insert into dcomptable (d1.r, d1.i) values(99, 100)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable (d1.r, d1.i) values(100, 99)
ERROR: 
insert into dcomptable (d1.r, d1.i) values(100, 99)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail
update dcomptable set d1.r = (d1).r + 1 where (d1).i > 0
ERROR:   -- fail
update dcomptable set d1.r = (d1).r + 1 where (d1).i > 0

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set d1.r = (d1).r ...
               ^
  -- fail
update dcomptable set d1.r = (d1).r - 1, d1.i = (d1).i + 1 where (d1).i > 0
ERROR:   -- fail
update dcomptable set d1.r = (d1).r - 1, d1.i = (d1).i + 1 where (d1).i > 0

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set d1.r = (d1).r ...
               ^

select * from dcomptable
ERROR: 
select * from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?


explain (verbose, costs off)
  update dcomptable set d1.r = (d1).r - 1, d1.i = (d1).i + 1 where (d1).i > 0
ERROR: 

explain (verbose, costs off)
  update dcomptable set d1.r = (d1).r - 1, d1.i = (d1).i + 1 where (d1).i > 0

Not implemented Error: Unimplemented explain type: verbose

create rule silly as on delete to dcomptable do instead
  update dcomptable set d1.r = (d1).r - 1, d1.i = (d1).i + 1 where (d1).i > 0
ERROR: 
create rule silly as on delete to dcomptable do instead
  update dcomptable set d1.r = (d1).r - 1, d1.i = (d1).i + 1 where (d1).i > 0

Parser Error: syntax error at or near "rule"

-- \d+ dcomptable

create function makedcomp(r float8, i float8) returns dcomptype
as 'select row(r, i)' language sql
ERROR: 
-- \d+ dcomptable

create function makedcomp(r float8, i float8) returns dcomptype
as 'select row(r, i)' language sql

Parser Error: syntax error at or near "float8"


select makedcomp(1,2)
ERROR: 

select makedcomp(1,2)

Catalog Error: Scalar Function with name makedcomp does not exist!
Did you mean "mad"?

select makedcomp(2,1)
ERROR: 
select makedcomp(2,1)

Catalog Error: Scalar Function with name makedcomp does not exist!
Did you mean "mad"?
  -- fail
select * from makedcomp(1,2) m
ERROR:   -- fail
select * from makedcomp(1,2) m

Catalog Error: Table Function with name makedcomp does not exist!
Did you mean "range"?

select m, m is not null from makedcomp(1,2) m
ERROR: 
select m, m is not null from makedcomp(1,2) m

Catalog Error: Table Function with name makedcomp does not exist!
Did you mean "range"?


drop function makedcomp(float8, float8)
ERROR: 

drop function makedcomp(float8, float8)

Parser Error: syntax error at or near "("

drop table dcomptable
ERROR: 
drop table dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

drop type comptype cascade
ERROR: 
drop type comptype cascade

Catalog Error: Type with name comptype does not exist!
Did you mean "map"?



-- check altering and dropping columns used by domain constraints
create type comptype as (r float8, i float8)
ERROR: 


-- check altering and dropping columns used by domain constraints
create type comptype as (r float8, i float8)

Parser Error: syntax error at or near "("

create domain dcomptype as comptype
ERROR: 
create domain dcomptype as comptype

Parser Error: syntax error at or near "domain"

alter domain dcomptype add constraint c1 check ((value).r > 0)
ERROR: 
alter domain dcomptype add constraint c1 check ((value).r > 0)

Parser Error: syntax error at or near "domain"

comment on constraint c1 on domain dcomptype is 'random commentary'
ERROR: 
comment on constraint c1 on domain dcomptype is 'random commentary'

Parser Error: syntax error at or near "constraint"


select row(0,1)::dcomptype
ERROR: 

select row(0,1)::dcomptype

Catalog Error: Type with name dcomptype does not exist!
Did you mean "date"?
  -- fail

alter type comptype alter attribute r type varchar
ERROR:   -- fail

alter type comptype alter attribute r type varchar

Parser Error: syntax error at or near "type"
  -- fail
alter type comptype alter attribute r type bigint
ERROR:   -- fail
alter type comptype alter attribute r type bigint

Parser Error: syntax error at or near "type"


alter type comptype drop attribute r
ERROR: 

alter type comptype drop attribute r

Parser Error: syntax error at or near "type"
  -- fail
alter type comptype drop attribute i
ERROR:   -- fail
alter type comptype drop attribute i

Parser Error: syntax error at or near "type"


select conname, obj_description(oid, 'pg_constraint') from pg_constraint
  where contypid = 'dcomptype'::regtype
ERROR: 

select conname, obj_description(oid, 'pg_constraint') from pg_constraint
  where contypid = 'dcomptype'::regtype

Catalog Error: Type with name regtype does not exist!
Did you mean "date"?
  -- check comment is still there

drop type comptype cascade
ERROR:   -- check comment is still there

drop type comptype cascade

Catalog Error: Type with name comptype does not exist!
Did you mean "map"?



-- Test domains over arrays of composite

create type comptype as (r float8, i float8)
ERROR: 


-- Test domains over arrays of composite

create type comptype as (r float8, i float8)

Parser Error: syntax error at or near "("

create domain dcomptypea as comptype[]
ERROR: 
create domain dcomptypea as comptype[]

Parser Error: syntax error at or near "domain"

create table dcomptable (d1 dcomptypea unique)
ERROR: 
create table dcomptable (d1 dcomptypea unique)

Catalog Error: Type with name dcomptypea does not exist!
Did you mean "date"?


insert into dcomptable values (array[row(1,2)]::dcomptypea)
ERROR: 

insert into dcomptable values (array[row(1,2)]::dcomptypea)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable values (array[row(3,4), row(5,6)]::comptype[])
ERROR: 
insert into dcomptable values (array[row(3,4), row(5,6)]::comptype[])

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable values (array[row(7,8)::comptype, row(9,10)::comptype])
ERROR: 
insert into dcomptable values (array[row(7,8)::comptype, row(9,10)::comptype])

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable values (array[row(1,2)]::dcomptypea)
ERROR: 
insert into dcomptable values (array[row(1,2)]::dcomptypea)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail on uniqueness
insert into dcomptable (d1[1]) values(row(9,10))
ERROR:   -- fail on uniqueness
insert into dcomptable (d1[1]) values(row(9,10))

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable (d1[1].r) values(11)
ERROR: 
insert into dcomptable (d1[1].r) values(11)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?


select * from dcomptable
ERROR: 

select * from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

select d1[2], d1[1].r, d1[1].i from dcomptable
ERROR: 
select d1[2], d1[1].r, d1[1].i from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

update dcomptable set d1[2] = row(d1[2].i, d1[2].r)
ERROR: 
update dcomptable set d1[2] = row(d1[2].i, d1[2].r)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set d1[2] = row(d1[2].i, d1...
               ^

select * from dcomptable
ERROR: 
select * from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

update dcomptable set d1[1].r = d1[1].r + 1 where d1[1].i > 0
ERROR: 
update dcomptable set d1[1].r = d1[1].r + 1 where d1[1].i > 0

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set d1[1].r = d1[1].r + 1 w...
               ^

select * from dcomptable
ERROR: 
select * from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?


alter domain dcomptypea add constraint c1 check (value[1].r <= value[1].i)
ERROR: 

alter domain dcomptypea add constraint c1 check (value[1].r <= value[1].i)

Parser Error: syntax error at or near "domain"

alter domain dcomptypea add constraint c2 check (value[1].r > value[1].i)
ERROR: 
alter domain dcomptypea add constraint c2 check (value[1].r > value[1].i)

Parser Error: syntax error at or near "domain"
  -- fail

select array[row(2,1)]::dcomptypea
ERROR:   -- fail

select array[row(2,1)]::dcomptypea

Catalog Error: Type with name dcomptypea does not exist!
Did you mean "date"?
  -- fail
insert into dcomptable values (array[row(1,2)]::comptype[])
ERROR:   -- fail
insert into dcomptable values (array[row(1,2)]::comptype[])

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable values (array[row(2,1)]::comptype[])
ERROR: 
insert into dcomptable values (array[row(2,1)]::comptype[])

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail
insert into dcomptable (d1[1].r) values(99)
ERROR:   -- fail
insert into dcomptable (d1[1].r) values(99)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable (d1[1].r, d1[1].i) values(99, 100)
ERROR: 
insert into dcomptable (d1[1].r, d1[1].i) values(99, 100)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

insert into dcomptable (d1[1].r, d1[1].i) values(100, 99)
ERROR: 
insert into dcomptable (d1[1].r, d1[1].i) values(100, 99)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail
update dcomptable set d1[1].r = d1[1].r + 1 where d1[1].i > 0
ERROR:   -- fail
update dcomptable set d1[1].r = d1[1].r + 1 where d1[1].i > 0

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set d1[1].r = d1[1...
               ^
  -- fail
update dcomptable set d1[1].r = d1[1].r - 1, d1[1].i = d1[1].i + 1
  where d1[1].i > 0
ERROR:   -- fail
update dcomptable set d1[1].r = d1[1].r - 1, d1[1].i = d1[1].i + 1
  where d1[1].i > 0

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set d1[1].r = d1[1...
               ^

select * from dcomptable
ERROR: 
select * from dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?


explain (verbose, costs off)
  update dcomptable set d1[1].r = d1[1].r - 1, d1[1].i = d1[1].i + 1
    where d1[1].i > 0
ERROR: 

explain (verbose, costs off)
  update dcomptable set d1[1].r = d1[1].r - 1, d1[1].i = d1[1].i + 1
    where d1[1].i > 0

Not implemented Error: Unimplemented explain type: verbose

create rule silly as on delete to dcomptable do instead
  update dcomptable set d1[1].r = d1[1].r - 1, d1[1].i = d1[1].i + 1
    where d1[1].i > 0
ERROR: 
create rule silly as on delete to dcomptable do instead
  update dcomptable set d1[1].r = d1[1].r - 1, d1[1].i = d1[1].i + 1
    where d1[1].i > 0

Parser Error: syntax error at or near "rule"

-- \d+ dcomptable

drop table dcomptable
ERROR: 
-- \d+ dcomptable

drop table dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

drop type comptype cascade
ERROR: 
drop type comptype cascade

Catalog Error: Type with name comptype does not exist!
Did you mean "map"?



-- Test arrays over domains

create domain posint as int check (value > 0)
ERROR: 


-- Test arrays over domains

create domain posint as int check (value > 0)

Parser Error: syntax error at or near "domain"


create table pitable (f1 posint[])
ERROR: 

create table pitable (f1 posint[])

Catalog Error: Type with name posint does not exist!
Did you mean "int"?

insert into pitable values(array[42])
ERROR: 
insert into pitable values(array[42])

Catalog Error: Table with name pitable does not exist!
Did you mean "temp.information_schema.tables"?

insert into pitable values(array[-1])
ERROR: 
insert into pitable values(array[-1])

Catalog Error: Table with name pitable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail
insert into pitable values('{0}')
ERROR:   -- fail
insert into pitable values('{0}')

Catalog Error: Table with name pitable does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail
update pitable set f1[1] = f1[1] + 1
ERROR:   -- fail
update pitable set f1[1] = f1[1] + 1

Catalog Error: Table with name pitable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update pitable set f1[1] = f1[1] + 1
               ^

update pitable set f1[1] = 0
ERROR: 
update pitable set f1[1] = 0

Catalog Error: Table with name pitable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update pitable set f1[1] = 0
               ^
  -- fail
select * from pitable
ERROR:   -- fail
select * from pitable

Catalog Error: Table with name pitable does not exist!
Did you mean "temp.information_schema.tables"?

drop table pitable
ERROR: 
drop table pitable

Catalog Error: Table with name pitable does not exist!
Did you mean "temp.information_schema.tables"?


create domain vc4 as varchar(4)
ERROR: 

create domain vc4 as varchar(4)

Parser Error: syntax error at or near "domain"

create table vc4table (f1 vc4[])
ERROR: 
create table vc4table (f1 vc4[])

Catalog Error: Type with name vc4 does not exist!
Did you mean "dec"?

insert into vc4table values(array['too long'])
ERROR: 
insert into vc4table values(array['too long'])

Catalog Error: Table with name vc4table does not exist!
Did you mean "temp.information_schema.tables"?
  -- fail
insert into vc4table values(array['too long']::vc4[])
ERROR:   -- fail
insert into vc4table values(array['too long']::vc4[])

Catalog Error: Table with name vc4table does not exist!
Did you mean "temp.information_schema.tables"?
  -- cast truncates
select * from vc4table
ERROR:   -- cast truncates
select * from vc4table

Catalog Error: Table with name vc4table does not exist!
Did you mean "temp.information_schema.tables"?

drop table vc4table
ERROR: 
drop table vc4table

Catalog Error: Table with name vc4table does not exist!
Did you mean "temp.information_schema.tables"?

drop type vc4
ERROR: 
drop type vc4

Catalog Error: Type with name vc4 does not exist!
Did you mean "dec"?


-- You can sort of fake arrays-of-arrays by putting a domain in between
create domain dposinta as posint[]
ERROR: 

-- You can sort of fake arrays-of-arrays by putting a domain in between
create domain dposinta as posint[]

Parser Error: syntax error at or near "domain"

create table dposintatable (f1 dposinta[])
ERROR: 
create table dposintatable (f1 dposinta[])

Catalog Error: Type with name dposinta does not exist!
Did you mean "int"?

insert into dposintatable values(array[array[42]])
ERROR: 
insert into dposintatable values(array[array[42]])

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?
  -- fail
insert into dposintatable values(array[array[42]::posint[]])
ERROR:   -- fail
insert into dposintatable values(array[array[42]::posint[]])

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?
 -- still fail
insert into dposintatable values(array[array[42]::dposinta])
ERROR:  -- still fail
insert into dposintatable values(array[array[42]::dposinta])

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?
 -- but this works
select f1, f1[1], (f1[1])[1] from dposintatable
ERROR:  -- but this works
select f1, f1[1], (f1[1])[1] from dposintatable

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?

select pg_typeof(f1) from dposintatable
ERROR: 
select pg_typeof(f1) from dposintatable

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?

select pg_typeof(f1[1]) from dposintatable
ERROR: 
select pg_typeof(f1[1]) from dposintatable

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?

select pg_typeof(f1[1][1]) from dposintatable
ERROR: 
select pg_typeof(f1[1][1]) from dposintatable

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?

select pg_typeof((f1[1])[1]) from dposintatable
ERROR: 
select pg_typeof((f1[1])[1]) from dposintatable

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?

update dposintatable set f1[2] = array[99]
ERROR: 
update dposintatable set f1[2] = array[99]

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?
LINE 2: update dposintatable set f1[2] = array[99]
               ^

select f1, f1[1], (f1[2])[1] from dposintatable
ERROR: 
select f1, f1[1], (f1[2])[1] from dposintatable

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?

-- it''d be nice if you could do something like this, but for now you can''t:
update dposintatable set f1[2][1] = array[97]
ERROR: 
-- it''d be nice if you could do something like this, but for now you can''t:
update dposintatable set f1[2][1] = array[97]

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?
LINE 3: update dposintatable set f1[2][1] = array[97]
               ^

-- maybe someday we can make this syntax work:
update dposintatable set (f1[2])[1] = array[98]
ERROR: 
-- maybe someday we can make this syntax work:
update dposintatable set (f1[2])[1] = array[98]

Parser Error: syntax error at or near "["


drop table dposintatable
ERROR: 

drop table dposintatable

Catalog Error: Table with name dposintatable does not exist!
Did you mean "INT2_TBL"?

drop domain posint cascade
ERROR: 
drop domain posint cascade

Parser Error: syntax error at or near "domain"



-- Test arrays over domains of composite

create type comptype as (cf1 int, cf2 int)
ERROR: 


-- Test arrays over domains of composite

create type comptype as (cf1 int, cf2 int)

Parser Error: syntax error at or near "("

create domain dcomptype as comptype check ((value).cf1 > 0)
ERROR: 
create domain dcomptype as comptype check ((value).cf1 > 0)

Parser Error: syntax error at or near "domain"


create table dcomptable (f1 dcomptype[])
ERROR: 

create table dcomptable (f1 dcomptype[])

Catalog Error: Type with name dcomptype does not exist!
Did you mean "date"?

insert into dcomptable values (null)
ERROR: 
insert into dcomptable values (null)

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

update dcomptable set f1[1].cf2 = 5
ERROR: 
update dcomptable set f1[1].cf2 = 5

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set f1[1].cf2 = 5
               ^

table dcomptable
ERROR: 
table dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

update dcomptable set f1[1].cf1 = -1
ERROR: 
update dcomptable set f1[1].cf1 = -1

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set f1[1].cf1 = -1
               ^
  -- fail
update dcomptable set f1[1].cf1 = 1
ERROR:   -- fail
update dcomptable set f1[1].cf1 = 1

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set f1[1].cf1 = 1
               ^

table dcomptable
ERROR: 
table dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

-- if there''s no constraints, a different code path is taken:
alter domain dcomptype drop constraint dcomptype_check
ERROR: 
-- if there''s no constraints, a different code path is taken:
alter domain dcomptype drop constraint dcomptype_check

Parser Error: syntax error at or near "domain"

update dcomptable set f1[1].cf1 = -1
ERROR: 
update dcomptable set f1[1].cf1 = -1

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?
LINE 2: update dcomptable set f1[1].cf1 = -1
               ^
  -- now ok
table dcomptable
ERROR:   -- now ok
table dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?


drop table dcomptable
ERROR: 

drop table dcomptable

Catalog Error: Table with name dcomptable does not exist!
Did you mean "temp.information_schema.tables"?

drop type comptype cascade
ERROR: 
drop type comptype cascade

Catalog Error: Type with name comptype does not exist!
Did you mean "map"?



-- Test not-null restrictions

create domain dnotnull varchar(15) NOT NULL
ERROR: 


-- Test not-null restrictions

create domain dnotnull varchar(15) NOT NULL

Parser Error: syntax error at or near "domain"

create domain dnull    varchar(15)
ERROR: 
create domain dnull    varchar(15)

Parser Error: syntax error at or near "domain"

create domain dcheck   varchar(15) NOT NULL CHECK (VALUE = 'a' OR VALUE = 'c' OR VALUE = 'd')
ERROR: 
create domain dcheck   varchar(15) NOT NULL CHECK (VALUE = 'a' OR VALUE = 'c' OR VALUE = 'd')

Parser Error: syntax error at or near "domain"


create table nulltest
           ( col1 dnotnull
           , col2 dnotnull NULL  -- NOT NULL in the domain cannot be overridden
           , col3 dnull    NOT NULL
           , col4 dnull
           , col5 dcheck CHECK (col5 IN ('c', 'd'))
           )
ERROR: 

create table nulltest
           ( col1 dnotnull
           , col2 dnotnull NULL  -- NOT NULL in the domain cannot be overridden
           , col3 dnull    NOT NULL
           , col4 dnull
           , col5 dcheck CHECK (col5 IN ('c', 'd'))
           )

Catalog Error: Type with name dnotnull does not exist!
Did you mean "null"?

INSERT INTO nulltest DEFAULT VALUES
ERROR: 
INSERT INTO nulltest DEFAULT VALUES

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO nulltest values ('a', 'b', 'c', 'd', 'c')
ERROR: 
INSERT INTO nulltest values ('a', 'b', 'c', 'd', 'c')

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?
  -- Good
insert into nulltest values ('a', 'b', 'c', 'd', NULL)
ERROR:   -- Good
insert into nulltest values ('a', 'b', 'c', 'd', NULL)

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?

insert into nulltest values ('a', 'b', 'c', 'd', 'a')
ERROR: 
insert into nulltest values ('a', 'b', 'c', 'd', 'a')

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO nulltest values (NULL, 'b', 'c', 'd', 'd')
ERROR: 
INSERT INTO nulltest values (NULL, 'b', 'c', 'd', 'd')

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO nulltest values ('a', NULL, 'c', 'd', 'c')
ERROR: 
INSERT INTO nulltest values ('a', NULL, 'c', 'd', 'c')

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO nulltest values ('a', 'b', NULL, 'd', 'c')
ERROR: 
INSERT INTO nulltest values ('a', 'b', NULL, 'd', 'c')

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?

INSERT INTO nulltest values ('a', 'b', 'c', NULL, 'd')
ERROR: 
INSERT INTO nulltest values ('a', 'b', 'c', NULL, 'd')

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?
 -- Good

-- Test copy
COPY nulltest FROM stdin
ERROR:  -- Good

-- Test copy
COPY nulltest FROM stdin

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?
 --fail
a	b	\N	d	d
\.

COPY nulltest FROM stdin
ERROR:  --fail
a	b	\N	d	d
\.

COPY nulltest FROM stdin

Parser Error: syntax error at or near "a"
 --fail
a	b	c	d	\N
\.

-- Last row is bad
COPY nulltest FROM stdin
ERROR:  --fail
a	b	c	d	\N
\.

-- Last row is bad
COPY nulltest FROM stdin

Parser Error: syntax error at or near "a"

a	b	c	\N	c
a	b	c	\N	d
a	b	c	\N	a
\.

select * from nulltest
ERROR: 
a	b	c	\N	c
a	b	c	\N	d
a	b	c	\N	a
\.

select * from nulltest

Parser Error: syntax error at or near "a"


-- Test out coerced (casted) constraints
SELECT cast('1' as dnotnull)
ERROR: 

-- Test out coerced (casted) constraints
SELECT cast('1' as dnotnull)

Catalog Error: Type with name dnotnull does not exist!
Did you mean "null"?

SELECT cast(NULL as dnotnull)
ERROR: 
SELECT cast(NULL as dnotnull)

Catalog Error: Type with name dnotnull does not exist!
Did you mean "null"?
 -- fail
SELECT cast(cast(NULL as dnull) as dnotnull)
ERROR:  -- fail
SELECT cast(cast(NULL as dnull) as dnotnull)

Catalog Error: Type with name dnull does not exist!
Did you mean "null"?
 -- fail
SELECT cast(col4 as dnotnull) from nulltest
ERROR:  -- fail
SELECT cast(col4 as dnotnull) from nulltest

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail

-- cleanup
drop table nulltest
ERROR:  -- fail

-- cleanup
drop table nulltest

Catalog Error: Table with name nulltest does not exist!
Did you mean "temp.information_schema.tables"?

drop domain dnotnull restrict
ERROR: 
drop domain dnotnull restrict

Parser Error: syntax error at or near "domain"

drop domain dnull restrict
ERROR: 
drop domain dnull restrict

Parser Error: syntax error at or near "domain"

drop domain dcheck restrict
ERROR: 
drop domain dcheck restrict

Parser Error: syntax error at or near "domain"



create domain ddef1 int4 DEFAULT 3
ERROR: 


create domain ddef1 int4 DEFAULT 3

Parser Error: syntax error at or near "domain"

create domain ddef2 oid DEFAULT '12'
ERROR: 
create domain ddef2 oid DEFAULT '12'

Parser Error: syntax error at or near "domain"

-- Type mixing, function returns int8
create domain ddef3 text DEFAULT 5
ERROR: 
-- Type mixing, function returns int8
create domain ddef3 text DEFAULT 5

Parser Error: syntax error at or near "domain"

create sequence ddef4_seq

create domain ddef4 int4 DEFAULT nextval('ddef4_seq')
ERROR: 
create domain ddef4 int4 DEFAULT nextval('ddef4_seq')

Parser Error: syntax error at or near "domain"

create domain ddef5 numeric(8,2) NOT NULL DEFAULT '12.12'
ERROR: 
create domain ddef5 numeric(8,2) NOT NULL DEFAULT '12.12'

Parser Error: syntax error at or near "domain"


create table defaulttest
            ( col1 ddef1
            , col2 ddef2
            , col3 ddef3
            , col4 ddef4 PRIMARY KEY
            , col5 ddef1 NOT NULL DEFAULT NULL
            , col6 ddef2 DEFAULT '88'
            , col7 ddef4 DEFAULT 8000
            , col8 ddef5
            )
ERROR: 

create table defaulttest
            ( col1 ddef1
            , col2 ddef2
            , col3 ddef3
            , col4 ddef4 PRIMARY KEY
            , col5 ddef1 NOT NULL DEFAULT NULL
            , col6 ddef2 DEFAULT '88'
            , col7 ddef4 DEFAULT 8000
            , col8 ddef5
            )

Catalog Error: Type with name ddef1 does not exist!
Did you mean "dec"?

insert into defaulttest(col4) values(0)
ERROR: 
insert into defaulttest(col4) values(0)

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fails, col5 defaults to null
alter table defaulttest alter column col5 drop default
ERROR:  -- fails, col5 defaults to null
alter table defaulttest alter column col5 drop default

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?

insert into defaulttest default values
ERROR: 
insert into defaulttest default values

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?
 -- succeeds, inserts domain default
-- We used to treat SET DEFAULT NULL as equivalent to DROP DEFAULT /* REPLACED */, wrong
alter table defaulttest alter column col5 set default null
ERROR:  -- succeeds, inserts domain default
-- We used to treat SET DEFAULT NULL as equivalent to DROP DEFAULT /* REPLACED */, wrong
alter table defaulttest alter column col5 set default null

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?

insert into defaulttest(col4) values(0)
ERROR: 
insert into defaulttest(col4) values(0)

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fails
alter table defaulttest alter column col5 drop default
ERROR:  -- fails
alter table defaulttest alter column col5 drop default

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?

insert into defaulttest default values
ERROR: 
insert into defaulttest default values

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?

insert into defaulttest default values
ERROR: 
insert into defaulttest default values

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?


-- Test defaults with copy
COPY defaulttest(col5) FROM stdin
ERROR: 

-- Test defaults with copy
COPY defaulttest(col5) FROM stdin

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?

42
\.

select * from defaulttest
ERROR: 
42
\.

select * from defaulttest

Parser Error: syntax error at or near "42"


drop table defaulttest cascade
ERROR: 

drop table defaulttest cascade

Catalog Error: Table with name defaulttest does not exist!
Did you mean "temp.information_schema.tables"?


-- Test ALTER DOMAIN .. NOT NULL
create domain dnotnulltest integer
ERROR: 

-- Test ALTER DOMAIN .. NOT NULL
create domain dnotnulltest integer

Parser Error: syntax error at or near "domain"

create table domnotnull
( col1 dnotnulltest
, col2 dnotnulltest
)
ERROR: 
create table domnotnull
( col1 dnotnulltest
, col2 dnotnulltest
)

Catalog Error: Type with name dnotnulltest does not exist!
Did you mean "double"?


insert into domnotnull default values
ERROR: 

insert into domnotnull default values

Catalog Error: Table with name domnotnull does not exist!
Did you mean "temp.information_schema.columns"?

alter domain dnotnulltest set not null
ERROR: 
alter domain dnotnulltest set not null

Parser Error: syntax error at or near "domain"
 -- fails

update domnotnull set col1 = 5
ERROR:  -- fails

update domnotnull set col1 = 5

Catalog Error: Table with name domnotnull does not exist!
Did you mean "temp.information_schema.columns"?
LINE 3: update domnotnull set col1 = 5
               ^

alter domain dnotnulltest set not null
ERROR: 
alter domain dnotnulltest set not null

Parser Error: syntax error at or near "domain"
 -- fails

update domnotnull set col2 = 6
ERROR:  -- fails

update domnotnull set col2 = 6

Catalog Error: Table with name domnotnull does not exist!
Did you mean "temp.information_schema.columns"?
LINE 3: update domnotnull set col2 = 6
               ^


alter domain dnotnulltest set not null
ERROR: 

alter domain dnotnulltest set not null

Parser Error: syntax error at or near "domain"


update domnotnull set col1 = null
ERROR: 

update domnotnull set col1 = null

Catalog Error: Table with name domnotnull does not exist!
Did you mean "temp.information_schema.columns"?
LINE 3: update domnotnull set col1 = null
               ^
 -- fails

alter domain dnotnulltest drop not null
ERROR:  -- fails

alter domain dnotnulltest drop not null

Parser Error: syntax error at or near "domain"


update domnotnull set col1 = null
ERROR: 

update domnotnull set col1 = null

Catalog Error: Table with name domnotnull does not exist!
Did you mean "temp.information_schema.columns"?
LINE 3: update domnotnull set col1 = null
               ^


drop domain dnotnulltest cascade
ERROR: 

drop domain dnotnulltest cascade

Parser Error: syntax error at or near "domain"


-- Test ALTER DOMAIN .. DEFAULT ..
create table domdeftest (col1 ddef1)
ERROR: 

-- Test ALTER DOMAIN .. DEFAULT ..
create table domdeftest (col1 ddef1)

Catalog Error: Type with name ddef1 does not exist!
Did you mean "dec"?


insert into domdeftest default values
ERROR: 

insert into domdeftest default values

Catalog Error: Table with name domdeftest does not exist!
Did you mean "temp.information_schema.tables"?

select * from domdeftest
ERROR: 
select * from domdeftest

Catalog Error: Table with name domdeftest does not exist!
Did you mean "temp.information_schema.tables"?


alter domain ddef1 set default '42'
ERROR: 

alter domain ddef1 set default '42'

Parser Error: syntax error at or near "domain"

insert into domdeftest default values
ERROR: 
insert into domdeftest default values

Catalog Error: Table with name domdeftest does not exist!
Did you mean "temp.information_schema.tables"?

select * from domdeftest
ERROR: 
select * from domdeftest

Catalog Error: Table with name domdeftest does not exist!
Did you mean "temp.information_schema.tables"?


alter domain ddef1 drop default
ERROR: 

alter domain ddef1 drop default

Parser Error: syntax error at or near "domain"

insert into domdeftest default values
ERROR: 
insert into domdeftest default values

Catalog Error: Table with name domdeftest does not exist!
Did you mean "temp.information_schema.tables"?

select * from domdeftest
ERROR: 
select * from domdeftest

Catalog Error: Table with name domdeftest does not exist!
Did you mean "temp.information_schema.tables"?


drop table domdeftest
ERROR: 

drop table domdeftest

Catalog Error: Table with name domdeftest does not exist!
Did you mean "temp.information_schema.tables"?


-- Test ALTER DOMAIN .. CONSTRAINT ..
create domain con as integer
ERROR: 

-- Test ALTER DOMAIN .. CONSTRAINT ..
create domain con as integer

Parser Error: syntax error at or near "domain"

create table domcontest (col1 con)
ERROR: 
create table domcontest (col1 con)

Catalog Error: Type with name con does not exist!
Did you mean "JSON"?


insert into domcontest values (1)
ERROR: 

insert into domcontest values (1)

Catalog Error: Table with name domcontest does not exist!
Did you mean "temp.information_schema.columns"?

insert into domcontest values (2)
ERROR: 
insert into domcontest values (2)

Catalog Error: Table with name domcontest does not exist!
Did you mean "temp.information_schema.columns"?

alter domain con add constraint t check (VALUE < 1)
ERROR: 
alter domain con add constraint t check (VALUE < 1)

Parser Error: syntax error at or near "domain"
 -- fails

alter domain con add constraint t check (VALUE < 34)
ERROR:  -- fails

alter domain con add constraint t check (VALUE < 34)

Parser Error: syntax error at or near "domain"

alter domain con add check (VALUE > 0)
ERROR: 
alter domain con add check (VALUE > 0)

Parser Error: syntax error at or near "domain"


insert into domcontest values (-5)
ERROR: 

insert into domcontest values (-5)

Catalog Error: Table with name domcontest does not exist!
Did you mean "temp.information_schema.columns"?
 -- fails
insert into domcontest values (42)
ERROR:  -- fails
insert into domcontest values (42)

Catalog Error: Table with name domcontest does not exist!
Did you mean "temp.information_schema.columns"?
 -- fails
insert into domcontest values (5)
ERROR:  -- fails
insert into domcontest values (5)

Catalog Error: Table with name domcontest does not exist!
Did you mean "temp.information_schema.columns"?


alter domain con drop constraint t
ERROR: 

alter domain con drop constraint t

Parser Error: syntax error at or near "domain"

insert into domcontest values (-5)
ERROR: 
insert into domcontest values (-5)

Catalog Error: Table with name domcontest does not exist!
Did you mean "temp.information_schema.columns"?
 --fails
insert into domcontest values (42)
ERROR:  --fails
insert into domcontest values (42)

Catalog Error: Table with name domcontest does not exist!
Did you mean "temp.information_schema.columns"?


alter domain con drop constraint nonexistent
ERROR: 

alter domain con drop constraint nonexistent

Parser Error: syntax error at or near "domain"

alter domain con drop constraint if exists nonexistent
ERROR: 
alter domain con drop constraint if exists nonexistent

Parser Error: syntax error at or near "domain"


-- not-null constraints
create domain connotnull integer
ERROR: 

-- not-null constraints
create domain connotnull integer

Parser Error: syntax error at or near "domain"

create table domconnotnulltest
( col1 connotnull
, col2 connotnull
)
ERROR: 
create table domconnotnulltest
( col1 connotnull
, col2 connotnull
)

Catalog Error: Type with name connotnull does not exist!
Did you mean "null"?


insert into domconnotnulltest default values
ERROR: 

insert into domconnotnulltest default values

Catalog Error: Table with name domconnotnulltest does not exist!
Did you mean "temp.information_schema.tables"?

alter domain connotnull add not null value
ERROR: 
alter domain connotnull add not null value

Parser Error: syntax error at or near "domain"
 -- fails

update domconnotnulltest set col1 = 5
ERROR:  -- fails

update domconnotnulltest set col1 = 5

Catalog Error: Table with name domconnotnulltest does not exist!
Did you mean "temp.information_schema.tables"?
LINE 3: update domconnotnulltest set col1 = 5
               ^

alter domain connotnull add not null value
ERROR: 
alter domain connotnull add not null value

Parser Error: syntax error at or near "domain"
 -- fails

update domconnotnulltest set col2 = 6
ERROR:  -- fails

update domconnotnulltest set col2 = 6

Catalog Error: Table with name domconnotnulltest does not exist!
Did you mean "temp.information_schema.tables"?
LINE 3: update domconnotnulltest set col2 = 6
               ^


alter domain connotnull add constraint constr1 not null value
ERROR: 

alter domain connotnull add constraint constr1 not null value

Parser Error: syntax error at or near "domain"

select count(*) from pg_constraint where contypid = 'connotnull'::regtype and contype = 'n'
ERROR: 
select count(*) from pg_constraint where contypid = 'connotnull'::regtype and contype = 'n'

Catalog Error: Type with name regtype does not exist!
Did you mean "date"?

alter domain connotnull add constraint constr1bis not null value
ERROR: 
alter domain connotnull add constraint constr1bis not null value

Parser Error: syntax error at or near "domain"
  -- redundant
select count(*) from pg_constraint where contypid = 'connotnull'::regtype and contype = 'n'
ERROR:   -- redundant
select count(*) from pg_constraint where contypid = 'connotnull'::regtype and contype = 'n'

Catalog Error: Type with name regtype does not exist!
Did you mean "date"?


update domconnotnulltest set col1 = null
ERROR: 

update domconnotnulltest set col1 = null

Catalog Error: Table with name domconnotnulltest does not exist!
Did you mean "temp.information_schema.tables"?
LINE 3: update domconnotnulltest set col1 = null
               ^
 -- fails

alter domain connotnull drop constraint constr1
ERROR:  -- fails

alter domain connotnull drop constraint constr1

Parser Error: syntax error at or near "domain"


update domconnotnulltest set col1 = null
ERROR: 

update domconnotnulltest set col1 = null

Catalog Error: Table with name domconnotnulltest does not exist!
Did you mean "temp.information_schema.tables"?
LINE 3: update domconnotnulltest set col1 = null
               ^


drop domain connotnull cascade
ERROR: 

drop domain connotnull cascade

Parser Error: syntax error at or near "domain"

drop table domconnotnulltest
ERROR: 
drop table domconnotnulltest

Catalog Error: Table with name domconnotnulltest does not exist!
Did you mean "temp.information_schema.tables"?


-- Test ALTER DOMAIN .. CONSTRAINT .. NOT VALID
create domain things AS INT
ERROR: 

-- Test ALTER DOMAIN .. CONSTRAINT .. NOT VALID
create domain things AS INT

Parser Error: syntax error at or near "domain"

CREATE TABLE thethings (stuff things)
ERROR: 
CREATE TABLE thethings (stuff things)

Catalog Error: Type with name things does not exist!
Did you mean "string"?

INSERT INTO thethings (stuff) VALUES (55)
ERROR: 
INSERT INTO thethings (stuff) VALUES (55)

Catalog Error: Table with name thethings does not exist!
Did you mean "pg_settings"?

ALTER DOMAIN things ADD CONSTRAINT meow CHECK (VALUE < 11)
ERROR: 
ALTER DOMAIN things ADD CONSTRAINT meow CHECK (VALUE < 11)

Parser Error: syntax error at or near "DOMAIN"

ALTER DOMAIN things ADD CONSTRAINT meow CHECK (VALUE < 11) NOT VALID
ERROR: 
ALTER DOMAIN things ADD CONSTRAINT meow CHECK (VALUE < 11) NOT VALID

Parser Error: syntax error at or near "DOMAIN"

ALTER DOMAIN things VALIDATE CONSTRAINT meow
ERROR: 
ALTER DOMAIN things VALIDATE CONSTRAINT meow

Parser Error: syntax error at or near "DOMAIN"

UPDATE thethings SET stuff = 10
ERROR: 
UPDATE thethings SET stuff = 10

Catalog Error: Table with name thethings does not exist!
Did you mean "pg_settings"?
LINE 2: UPDATE thethings SET stuff = 10
               ^

ALTER DOMAIN things VALIDATE CONSTRAINT meow
ERROR: 
ALTER DOMAIN things VALIDATE CONSTRAINT meow

Parser Error: syntax error at or near "DOMAIN"


-- Confirm ALTER DOMAIN with RULES.
create table domtab (col1 integer)

create domain dom as integer
ERROR: 
create domain dom as integer

Parser Error: syntax error at or near "domain"

create view domview as select cast(col1 as dom) from domtab
ERROR: 
create view domview as select cast(col1 as dom) from domtab

Catalog Error: Type with name dom does not exist!
Did you mean "dec"?

insert into domtab (col1) values (null)

insert into domtab (col1) values (5)

select * from domview
ERROR: 
select * from domview

Catalog Error: Table with name domview does not exist!
Did you mean "pg_views"?


alter domain dom set not null
ERROR: 

alter domain dom set not null

Parser Error: syntax error at or near "domain"

select * from domview
ERROR: 
select * from domview

Catalog Error: Table with name domview does not exist!
Did you mean "pg_views"?
 -- fail

alter domain dom drop not null
ERROR:  -- fail

alter domain dom drop not null

Parser Error: syntax error at or near "domain"

select * from domview
ERROR: 
select * from domview

Catalog Error: Table with name domview does not exist!
Did you mean "pg_views"?


alter domain dom add constraint domchkgt6 check(value > 6)
ERROR: 

alter domain dom add constraint domchkgt6 check(value > 6)

Parser Error: syntax error at or near "domain"

select * from domview
ERROR: 
select * from domview

Catalog Error: Table with name domview does not exist!
Did you mean "pg_views"?
 --fail

alter domain dom drop constraint domchkgt6 restrict
ERROR:  --fail

alter domain dom drop constraint domchkgt6 restrict

Parser Error: syntax error at or near "domain"

select * from domview
ERROR: 
select * from domview

Catalog Error: Table with name domview does not exist!
Did you mean "pg_views"?


-- cleanup
drop domain ddef1 restrict
ERROR: 

-- cleanup
drop domain ddef1 restrict

Parser Error: syntax error at or near "domain"

drop domain ddef2 restrict
ERROR: 
drop domain ddef2 restrict

Parser Error: syntax error at or near "domain"

drop domain ddef3 restrict
ERROR: 
drop domain ddef3 restrict

Parser Error: syntax error at or near "domain"

drop domain ddef4 restrict
ERROR: 
drop domain ddef4 restrict

Parser Error: syntax error at or near "domain"

drop domain ddef5 restrict
ERROR: 
drop domain ddef5 restrict

Parser Error: syntax error at or near "domain"

drop sequence ddef4_seq


-- Test domains over domains
create domain vchar4 varchar(4)
ERROR: 

-- Test domains over domains
create domain vchar4 varchar(4)

Parser Error: syntax error at or near "domain"

create domain dinter vchar4 check (substring(VALUE, 1, 1) = 'x')
ERROR: 
create domain dinter vchar4 check (substring(VALUE, 1, 1) = 'x')

Parser Error: syntax error at or near "domain"

create domain dtop dinter check (substring(VALUE, 2, 1) = '1')
ERROR: 
create domain dtop dinter check (substring(VALUE, 2, 1) = '1')

Parser Error: syntax error at or near "domain"


select 'x123'::dtop
ERROR: 

select 'x123'::dtop

Catalog Error: Type with name dtop does not exist!
Did you mean "date"?

select 'x1234'::dtop
ERROR: 
select 'x1234'::dtop

Catalog Error: Type with name dtop does not exist!
Did you mean "date"?
 -- explicit coercion should truncate
select 'y1234'::dtop
ERROR:  -- explicit coercion should truncate
select 'y1234'::dtop

Catalog Error: Type with name dtop does not exist!
Did you mean "date"?
 -- fail
select 'y123'::dtop
ERROR:  -- fail
select 'y123'::dtop

Catalog Error: Type with name dtop does not exist!
Did you mean "date"?
 -- fail
select 'yz23'::dtop
ERROR:  -- fail
select 'yz23'::dtop

Catalog Error: Type with name dtop does not exist!
Did you mean "date"?
 -- fail
select 'xz23'::dtop
ERROR:  -- fail
select 'xz23'::dtop

Catalog Error: Type with name dtop does not exist!
Did you mean "date"?
 -- fail

create temp table dtest(f1 dtop)
ERROR:  -- fail

create temp table dtest(f1 dtop)

Catalog Error: Type with name dtop does not exist!
Did you mean "date"?


insert into dtest values('x123')
ERROR: 

insert into dtest values('x123')

Catalog Error: Table with name dtest does not exist!
Did you mean "temp.information_schema.tables"?

insert into dtest values('x1234')
ERROR: 
insert into dtest values('x1234')

Catalog Error: Table with name dtest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail, implicit coercion
insert into dtest values('y1234')
ERROR:  -- fail, implicit coercion
insert into dtest values('y1234')

Catalog Error: Table with name dtest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail, implicit coercion
insert into dtest values('y123')
ERROR:  -- fail, implicit coercion
insert into dtest values('y123')

Catalog Error: Table with name dtest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail
insert into dtest values('yz23')
ERROR:  -- fail
insert into dtest values('yz23')

Catalog Error: Table with name dtest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail
insert into dtest values('xz23')
ERROR:  -- fail
insert into dtest values('xz23')

Catalog Error: Table with name dtest does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail

drop table dtest
ERROR:  -- fail

drop table dtest

Catalog Error: Table with name dtest does not exist!
Did you mean "temp.information_schema.tables"?

drop domain vchar4 cascade
ERROR: 
drop domain vchar4 cascade

Parser Error: syntax error at or near "domain"


-- Make sure that constraints of newly-added domain columns are
-- enforced correctly, even if there''s no default value for the new
-- column. Per bug #1433
create domain str_domain as text not null
ERROR: 

-- Make sure that constraints of newly-added domain columns are
-- enforced correctly, even if there''s no default value for the new
-- column. Per bug #1433
create domain str_domain as text not null

Parser Error: syntax error at or near "domain"


create table domain_test (a int, b int)


insert into domain_test values (1, 2)

insert into domain_test values (1, 2)


-- should fail
alter table domain_test add column c str_domain
ERROR: 

-- should fail
alter table domain_test add column c str_domain

Catalog Error: Type with name str_domain does not exist!
Did you mean "string"?


create domain str_domain2 as text check (value <> 'foo') default 'foo'
ERROR: 

create domain str_domain2 as text check (value <> 'foo') default 'foo'

Parser Error: syntax error at or near "domain"


-- should fail
alter table domain_test add column d str_domain2
ERROR: 

-- should fail
alter table domain_test add column d str_domain2

Catalog Error: Type with name str_domain2 does not exist!
Did you mean "string"?


-- Check that domain constraints on prepared statement parameters of
-- unknown type are enforced correctly.
create domain pos_int as int4 check (value > 0) not null
ERROR: 

-- Check that domain constraints on prepared statement parameters of
-- unknown type are enforced correctly.
create domain pos_int as int4 check (value > 0) not null

Parser Error: syntax error at or near "domain"

prepare s1 as select $1::pos_int = 10 as "is_ten"
ERROR: 
prepare s1 as select $1::pos_int = 10 as "is_ten"

Catalog Error: Type with name pos_int does not exist!
Did you mean "int"?


execute s1(10)
ERROR: 

execute s1(10)

Binder Error: Prepared statement "s1" does not exist

execute s1(0)
ERROR: 
execute s1(0)

Binder Error: Prepared statement "s1" does not exist
 -- should fail
execute s1(NULL)
ERROR:  -- should fail
execute s1(NULL)

Binder Error: Prepared statement "s1" does not exist
 -- should fail

-- Check that domain constraints on plpgsql function parameters, results,
-- and local variables are enforced correctly.

create function doubledecrement(p1 pos_int) returns pos_int as $$
declare v pos_int;
begin
    return p1;
end$$ language plpgsql
ERROR:  -- should fail

-- Check that domain constraints on plpgsql function parameters, results,
-- and local variables are enforced correctly.

create function doubledecrement(p1 pos_int) returns pos_int as $$
declare v pos_int;
begin
    return p1;
end$$ language plpgsql

Parser Error: syntax error at or near "pos_int"


select doubledecrement(3)
ERROR: 

select doubledecrement(3)

Catalog Error: Scalar Function with name doubledecrement does not exist!
Did you mean "count"?
 -- fail because of implicit null assignment

create or replace function doubledecrement(p1 pos_int) returns pos_int as $$
declare v pos_int := 0;
begin
    return p1;
end$$ language plpgsql
ERROR:  -- fail because of implicit null assignment

create or replace function doubledecrement(p1 pos_int) returns pos_int as $$
declare v pos_int := 0;
begin
    return p1;
end$$ language plpgsql

Parser Error: syntax error at or near "pos_int"


select doubledecrement(3)
ERROR: 

select doubledecrement(3)

Catalog Error: Scalar Function with name doubledecrement does not exist!
Did you mean "count"?
 -- fail at initialization assignment

create or replace function doubledecrement(p1 pos_int) returns pos_int as $$
declare v pos_int := 1;
begin
    v := p1 - 1;
    return v - 1;
end$$ language plpgsql
ERROR:  -- fail at initialization assignment

create or replace function doubledecrement(p1 pos_int) returns pos_int as $$
declare v pos_int := 1;
begin
    v := p1 - 1;
    return v - 1;
end$$ language plpgsql

Parser Error: syntax error at or near "pos_int"


select doubledecrement(null)
ERROR: 

select doubledecrement(null)

Catalog Error: Scalar Function with name doubledecrement does not exist!
Did you mean "count"?
 -- fail before call
select doubledecrement(0)
ERROR:  -- fail before call
select doubledecrement(0)

Catalog Error: Scalar Function with name doubledecrement does not exist!
Did you mean "count"?
 -- fail before call
select doubledecrement(1)
ERROR:  -- fail before call
select doubledecrement(1)

Catalog Error: Scalar Function with name doubledecrement does not exist!
Did you mean "count"?
 -- fail at assignment to v
select doubledecrement(2)
ERROR:  -- fail at assignment to v
select doubledecrement(2)

Catalog Error: Scalar Function with name doubledecrement does not exist!
Did you mean "count"?
 -- fail at return
select doubledecrement(3)
ERROR:  -- fail at return
select doubledecrement(3)

Catalog Error: Scalar Function with name doubledecrement does not exist!
Did you mean "count"?
 -- good

-- Check that ALTER DOMAIN tests columns of derived types

create domain posint as int4
ERROR:  -- good

-- Check that ALTER DOMAIN tests columns of derived types

create domain posint as int4

Parser Error: syntax error at or near "domain"


-- Currently, this doesn''t work for composite types, but verify it complains
create type ddtest1 as (f1 posint)
ERROR: 

-- Currently, this doesn''t work for composite types, but verify it complains
create type ddtest1 as (f1 posint)

Parser Error: syntax error at or near "("

create table ddtest2(f1 ddtest1)
ERROR: 
create table ddtest2(f1 ddtest1)

Catalog Error: Type with name ddtest1 does not exist!
Did you mean "date"?

insert into ddtest2 values(row(-1))
ERROR: 
insert into ddtest2 values(row(-1))

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

alter domain posint add constraint c1 check(value >= 0)
ERROR: 
alter domain posint add constraint c1 check(value >= 0)

Parser Error: syntax error at or near "domain"

drop table ddtest2
ERROR: 
drop table ddtest2

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?


-- Likewise for domains within arrays of composite
create table ddtest2(f1 ddtest1[])
ERROR: 

-- Likewise for domains within arrays of composite
create table ddtest2(f1 ddtest1[])

Catalog Error: Type with name ddtest1 does not exist!
Did you mean "date"?

insert into ddtest2 values('{(-1)}')
ERROR: 
insert into ddtest2 values('{(-1)}')

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

alter domain posint add constraint c1 check(value >= 0)
ERROR: 
alter domain posint add constraint c1 check(value >= 0)

Parser Error: syntax error at or near "domain"

drop table ddtest2
ERROR: 
drop table ddtest2

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?


-- Likewise for domains within domains over composite
create domain ddtest1d as ddtest1
ERROR: 

-- Likewise for domains within domains over composite
create domain ddtest1d as ddtest1

Parser Error: syntax error at or near "domain"

create table ddtest2(f1 ddtest1d)
ERROR: 
create table ddtest2(f1 ddtest1d)

Catalog Error: Type with name ddtest1d does not exist!
Did you mean "date"?

insert into ddtest2 values('(-1)')
ERROR: 
insert into ddtest2 values('(-1)')

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

alter domain posint add constraint c1 check(value >= 0)
ERROR: 
alter domain posint add constraint c1 check(value >= 0)

Parser Error: syntax error at or near "domain"

drop table ddtest2
ERROR: 
drop table ddtest2

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

drop domain ddtest1d
ERROR: 
drop domain ddtest1d

Parser Error: syntax error at or near "domain"


-- Likewise for domains within domains over array of composite
create domain ddtest1d as ddtest1[]
ERROR: 

-- Likewise for domains within domains over array of composite
create domain ddtest1d as ddtest1[]

Parser Error: syntax error at or near "domain"

create table ddtest2(f1 ddtest1d)
ERROR: 
create table ddtest2(f1 ddtest1d)

Catalog Error: Type with name ddtest1d does not exist!
Did you mean "date"?

insert into ddtest2 values('{(-1)}')
ERROR: 
insert into ddtest2 values('{(-1)}')

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

alter domain posint add constraint c1 check(value >= 0)
ERROR: 
alter domain posint add constraint c1 check(value >= 0)

Parser Error: syntax error at or near "domain"

drop table ddtest2
ERROR: 
drop table ddtest2

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

drop domain ddtest1d
ERROR: 
drop domain ddtest1d

Parser Error: syntax error at or near "domain"


-- Doesn''t work for ranges, either
create type rposint as range (subtype = posint)
ERROR: 

-- Doesn''t work for ranges, either
create type rposint as range (subtype = posint)

Parser Error: Expected an integer constant as type modifier

create table ddtest2(f1 rposint)
ERROR: 
create table ddtest2(f1 rposint)

Catalog Error: Type with name rposint does not exist!
Did you mean "int"?

insert into ddtest2 values('(-1,3]')
ERROR: 
insert into ddtest2 values('(-1,3]')

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

alter domain posint add constraint c1 check(value >= 0)
ERROR: 
alter domain posint add constraint c1 check(value >= 0)

Parser Error: syntax error at or near "domain"

drop table ddtest2
ERROR: 
drop table ddtest2

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

drop type rposint
ERROR: 
drop type rposint

Catalog Error: Type with name rposint does not exist!
Did you mean "int"?


alter domain posint add constraint c1 check(value >= 0)
ERROR: 

alter domain posint add constraint c1 check(value >= 0)

Parser Error: syntax error at or near "domain"


create domain posint2 as posint check (value % 2 = 0)
ERROR: 

create domain posint2 as posint check (value % 2 = 0)

Parser Error: syntax error at or near "domain"

create table ddtest2(f1 posint2)
ERROR: 
create table ddtest2(f1 posint2)

Catalog Error: Type with name posint2 does not exist!
Did you mean "int2"?

insert into ddtest2 values(11)
ERROR: 
insert into ddtest2 values(11)

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail
insert into ddtest2 values(-2)
ERROR:  -- fail
insert into ddtest2 values(-2)

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?
 -- fail
insert into ddtest2 values(2)
ERROR:  -- fail
insert into ddtest2 values(2)

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?


alter domain posint add constraint c2 check(value >= 10)
ERROR: 

alter domain posint add constraint c2 check(value >= 10)

Parser Error: syntax error at or near "domain"
 -- fail
alter domain posint add constraint c2 check(value > 0)
ERROR:  -- fail
alter domain posint add constraint c2 check(value > 0)

Parser Error: syntax error at or near "domain"
 -- OK

drop table ddtest2
ERROR:  -- OK

drop table ddtest2

Catalog Error: Table with name ddtest2 does not exist!
Did you mean "temp.information_schema.tables"?

drop type ddtest1
ERROR: 
drop type ddtest1

Catalog Error: Type with name ddtest1 does not exist!
Did you mean "date"?

drop domain posint cascade
ERROR: 
drop domain posint cascade

Parser Error: syntax error at or near "domain"


--
-- Check enforcement of domain-related typmod in plpgsql (bug #5717)
--

create or replace function array_elem_check(numeric) returns numeric as $$
declare
  x numeric(4,2)[1];
begin
  x[1] := $1;
  return x[1];
end$$ language plpgsql
ERROR: 

--
-- Check enforcement of domain-related typmod in plpgsql (bug #5717)
--

create or replace function array_elem_check(numeric) returns numeric as $$
declare
  x numeric(4,2)[1];
begin
  x[1] := $1;
  return x[1];
end$$ language plpgsql

Parser Error: syntax error at or near "returns"


select array_elem_check(121.00)
ERROR: 

select array_elem_check(121.00)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?

select array_elem_check(1.23456)
ERROR: 
select array_elem_check(1.23456)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?


create domain mynums as numeric(4,2)[1]
ERROR: 

create domain mynums as numeric(4,2)[1]

Parser Error: syntax error at or near "domain"


create or replace function array_elem_check(numeric) returns numeric as $$
declare
  x mynums;
begin
  x[1] := $1;
  return x[1];
end$$ language plpgsql
ERROR: 

create or replace function array_elem_check(numeric) returns numeric as $$
declare
  x mynums;
begin
  x[1] := $1;
  return x[1];
end$$ language plpgsql

Parser Error: syntax error at or near "returns"


select array_elem_check(121.00)
ERROR: 

select array_elem_check(121.00)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?

select array_elem_check(1.23456)
ERROR: 
select array_elem_check(1.23456)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?


create domain mynums2 as mynums
ERROR: 

create domain mynums2 as mynums

Parser Error: syntax error at or near "domain"


create or replace function array_elem_check(numeric) returns numeric as $$
declare
  x mynums2;
begin
  x[1] := $1;
  return x[1];
end$$ language plpgsql
ERROR: 

create or replace function array_elem_check(numeric) returns numeric as $$
declare
  x mynums2;
begin
  x[1] := $1;
  return x[1];
end$$ language plpgsql

Parser Error: syntax error at or near "returns"


select array_elem_check(121.00)
ERROR: 

select array_elem_check(121.00)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?

select array_elem_check(1.23456)
ERROR: 
select array_elem_check(1.23456)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?


drop function array_elem_check(numeric)
ERROR: 

drop function array_elem_check(numeric)

Parser Error: syntax error at or near "("


--
-- Check enforcement of array-level domain constraints
--

create domain orderedpair as int[2] check (value[1] < value[2])
ERROR: 

--
-- Check enforcement of array-level domain constraints
--

create domain orderedpair as int[2] check (value[1] < value[2])

Parser Error: syntax error at or near "domain"


select array[1,2]::orderedpair
ERROR: 

select array[1,2]::orderedpair

Catalog Error: Type with name orderedpair does not exist!
Did you mean "real"?

select array[2,1]::orderedpair
ERROR: 
select array[2,1]::orderedpair

Catalog Error: Type with name orderedpair does not exist!
Did you mean "real"?
  -- fail

create temp table op (f1 orderedpair)
ERROR:   -- fail

create temp table op (f1 orderedpair)

Catalog Error: Type with name orderedpair does not exist!
Did you mean "real"?

insert into op values (array[1,2])
ERROR: 
insert into op values (array[1,2])

Catalog Error: Table with name op does not exist!
Did you mean "pg_am"?

insert into op values (array[2,1])
ERROR: 
insert into op values (array[2,1])

Catalog Error: Table with name op does not exist!
Did you mean "pg_am"?
  -- fail

update op set f1[2] = 3
ERROR:   -- fail

update op set f1[2] = 3

Catalog Error: Table with name op does not exist!
Did you mean "pg_am"?
LINE 3: update op set f1[2] = 3
               ^

update op set f1[2] = 0
ERROR: 
update op set f1[2] = 0

Catalog Error: Table with name op does not exist!
Did you mean "pg_am"?
LINE 2: update op set f1[2] = 0
               ^
  -- fail
select * from op
ERROR:   -- fail
select * from op

Catalog Error: Table with name op does not exist!
Did you mean "pg_am"?


create or replace function array_elem_check(int) returns int as $$
declare
  x orderedpair := '{1,2}';
begin
  x[2] := $1;
  return x[2];
end$$ language plpgsql
ERROR: 

create or replace function array_elem_check(int) returns int as $$
declare
  x orderedpair := '{1,2}';
begin
  x[2] := $1;
  return x[2];
end$$ language plpgsql

Parser Error: syntax error at or near "returns"


select array_elem_check(3)
ERROR: 

select array_elem_check(3)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?

select array_elem_check(-1)
ERROR: 
select array_elem_check(-1)

Catalog Error: Scalar Function with name array_elem_check does not exist!
Did you mean "array_select"?


drop function array_elem_check(int)
ERROR: 

drop function array_elem_check(int)

Parser Error: syntax error at or near "("


--
-- Check enforcement of changing constraints in plpgsql
--

create domain di as int
ERROR: 

--
-- Check enforcement of changing constraints in plpgsql
--

create domain di as int

Parser Error: syntax error at or near "domain"


create function dom_check(int) returns di as $$
declare d di;
begin
  d := $1::di;
  return d;
end
$$ language plpgsql immutable
ERROR: 

create function dom_check(int) returns di as $$
declare d di;
begin
  d := $1::di;
  return d;
end
$$ language plpgsql immutable

Parser Error: syntax error at or near "returns"


select dom_check(0)
ERROR: 

select dom_check(0)

Catalog Error: Scalar Function with name dom_check does not exist!
Did you mean "from_hex"?


alter domain di add constraint pos check (value > 0)
ERROR: 

alter domain di add constraint pos check (value > 0)

Parser Error: syntax error at or near "domain"


select dom_check(0)
ERROR: 

select dom_check(0)

Catalog Error: Scalar Function with name dom_check does not exist!
Did you mean "from_hex"?
 -- fail

alter domain di drop constraint pos
ERROR:  -- fail

alter domain di drop constraint pos

Parser Error: syntax error at or near "domain"


select dom_check(0)
ERROR: 

select dom_check(0)

Catalog Error: Scalar Function with name dom_check does not exist!
Did you mean "from_hex"?


-- implicit cast during assignment is a separate code path, test that too

create or replace function dom_check(int) returns di as $$
declare d di;
begin
  d := $1;
  return d;
end
$$ language plpgsql immutable
ERROR: 

-- implicit cast during assignment is a separate code path, test that too

create or replace function dom_check(int) returns di as $$
declare d di;
begin
  d := $1;
  return d;
end
$$ language plpgsql immutable

Parser Error: syntax error at or near "returns"


select dom_check(0)
ERROR: 

select dom_check(0)

Catalog Error: Scalar Function with name dom_check does not exist!
Did you mean "from_hex"?


alter domain di add constraint pos check (value > 0)
ERROR: 

alter domain di add constraint pos check (value > 0)

Parser Error: syntax error at or near "domain"


select dom_check(0)
ERROR: 

select dom_check(0)

Catalog Error: Scalar Function with name dom_check does not exist!
Did you mean "from_hex"?
 -- fail

alter domain di drop constraint pos
ERROR:  -- fail

alter domain di drop constraint pos

Parser Error: syntax error at or near "domain"


select dom_check(0)
ERROR: 

select dom_check(0)

Catalog Error: Scalar Function with name dom_check does not exist!
Did you mean "from_hex"?


drop function dom_check(int)
ERROR: 

drop function dom_check(int)

Parser Error: syntax error at or near "("


drop domain di
ERROR: 

drop domain di

Parser Error: syntax error at or near "domain"


--
-- Check use of a (non-inline-able) SQL function in a domain constraint /* REPLACED */,
-- this has caused issues in the past
--

create function sql_is_distinct_from(anyelement, anyelement)
returns boolean language sql
as 'select $1 is distinct from $2 limit 1'
ERROR: 

--
-- Check use of a (non-inline-able) SQL function in a domain constraint /* REPLACED */,
-- this has caused issues in the past
--

create function sql_is_distinct_from(anyelement, anyelement)
returns boolean language sql
as 'select $1 is distinct from $2 limit 1'

Parser Error: syntax error at or near "returns"


create domain inotnull int
  check (sql_is_distinct_from(value, null))
ERROR: 

create domain inotnull int
  check (sql_is_distinct_from(value, null))

Parser Error: syntax error at or near "domain"


select 1::inotnull
ERROR: 

select 1::inotnull

Catalog Error: Type with name inotnull does not exist!
Did you mean "null"?

select null::inotnull
ERROR: 
select null::inotnull

Catalog Error: Type with name inotnull does not exist!
Did you mean "null"?


create table dom_table (x inotnull)
ERROR: 

create table dom_table (x inotnull)

Catalog Error: Type with name inotnull does not exist!
Did you mean "null"?

insert into dom_table values ('1')
ERROR: 
insert into dom_table values ('1')

Catalog Error: Table with name dom_table does not exist!
Did you mean "domtab"?

insert into dom_table values (1)
ERROR: 
insert into dom_table values (1)

Catalog Error: Table with name dom_table does not exist!
Did you mean "domtab"?

insert into dom_table values (null)
ERROR: 
insert into dom_table values (null)

Catalog Error: Table with name dom_table does not exist!
Did you mean "domtab"?


drop table dom_table
ERROR: 

drop table dom_table

Catalog Error: Table with name dom_table does not exist!
Did you mean "domtab"?

drop domain inotnull
ERROR: 
drop domain inotnull

Parser Error: syntax error at or near "domain"

drop function sql_is_distinct_from(anyelement, anyelement)
ERROR: 
drop function sql_is_distinct_from(anyelement, anyelement)

Parser Error: syntax error at or near "("


--
-- Renaming
--

create domain testdomain1 as int
ERROR: 

--
-- Renaming
--

create domain testdomain1 as int

Parser Error: syntax error at or near "domain"

alter domain testdomain1 rename to testdomain2
ERROR: 
alter domain testdomain1 rename to testdomain2

Parser Error: syntax error at or near "domain"

alter type testdomain2 rename to testdomain3
ERROR: 
alter type testdomain2 rename to testdomain3

Parser Error: syntax error at or near "type"
  -- alter type also works
drop domain testdomain3
ERROR:   -- alter type also works
drop domain testdomain3

Parser Error: syntax error at or near "domain"



--
-- Renaming domain constraints
--

create domain testdomain1 as int constraint unsigned check (value > 0)
ERROR: 


--
-- Renaming domain constraints
--

create domain testdomain1 as int constraint unsigned check (value > 0)

Parser Error: syntax error at or near "domain"

alter domain testdomain1 rename constraint unsigned to unsigned_foo
ERROR: 
alter domain testdomain1 rename constraint unsigned to unsigned_foo

Parser Error: syntax error at or near "domain"

alter domain testdomain1 drop constraint unsigned_foo
ERROR: 
alter domain testdomain1 drop constraint unsigned_foo

Parser Error: syntax error at or near "domain"

drop domain testdomain1
ERROR: 
drop domain testdomain1

Parser Error: syntax error at or near "domain"



--
-- Information schema
--

SELECT * FROM information_schema.column_domain_usage
  WHERE domain_name IN ('con', 'dom', 'pos_int', 'things')
  ORDER BY domain_name
ERROR: 


--
-- Information schema
--

SELECT * FROM information_schema.column_domain_usage
  WHERE domain_name IN ('con', 'dom', 'pos_int', 'things')
  ORDER BY domain_name

Catalog Error: Table with name column_domain_usage does not exist!
Did you mean "key_column_usage"?


SELECT * FROM information_schema.domain_constraints
  WHERE domain_name IN ('con', 'dom', 'pos_int', 'things')
  ORDER BY constraint_name
ERROR: 

SELECT * FROM information_schema.domain_constraints
  WHERE domain_name IN ('con', 'dom', 'pos_int', 'things')
  ORDER BY constraint_name

Catalog Error: Table with name domain_constraints does not exist!
Did you mean "table_constraints"?


SELECT * FROM information_schema.domains
  WHERE domain_name IN ('con', 'dom', 'pos_int', 'things')
  ORDER BY domain_name
ERROR: 

SELECT * FROM information_schema.domains
  WHERE domain_name IN ('con', 'dom', 'pos_int', 'things')
  ORDER BY domain_name

Catalog Error: Table with name domains does not exist!
Did you mean "memory.domain_test"?


SELECT * FROM information_schema.check_constraints
  WHERE (constraint_schema, constraint_name)
        IN (SELECT constraint_schema, constraint_name
            FROM information_schema.domain_constraints
            WHERE domain_name IN ('con', 'dom', 'pos_int', 'things'))
  ORDER BY constraint_name
ERROR: 

SELECT * FROM information_schema.check_constraints
  WHERE (constraint_schema, constraint_name)
        IN (SELECT constraint_schema, constraint_name
            FROM information_schema.domain_constraints
            WHERE domain_name IN ('con', 'dom', 'pos_int', 'things'))
  ORDER BY constraint_name

Catalog Error: Table with name check_constraints does not exist!
Did you mean "main.duckdb_constraints"?


