-- sanity check of system catalog
SELECT attrelid, attname, attidentity FROM pg_attribute WHERE attidentity NOT IN ('', 'a', 'd')
RESULT: 
	[]



CREATE TABLE itest1 (a int generated by default as identity, b text)
ERROR: 


CREATE TABLE itest1 (a int generated by default as identity, b text)

Not implemented Error: Constraint not implemented!

CREATE TABLE itest2 (a bigint generated always as identity, b text)
ERROR: 
CREATE TABLE itest2 (a bigint generated always as identity, b text)

Not implemented Error: Constraint not implemented!

CREATE TABLE itest3 (a smallint generated by default as identity (start with 7 increment by 5), b text)
ERROR: 
CREATE TABLE itest3 (a smallint generated by default as identity (start with 7 increment by 5), b text)

Not implemented Error: Constraint not implemented!

ALTER TABLE itest3 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest3 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
  -- error

SELECT table_name, column_name, column_default, is_nullable, is_identity, identity_generation, identity_start, identity_increment, identity_maximum, identity_minimum, identity_cycle FROM information_schema.columns WHERE table_name LIKE 'itest_' ORDER BY 1, 2
RESULT: 
	[]


-- internal sequences should not be shown here
SELECT sequence_name FROM information_schema.sequences WHERE sequence_name LIKE 'itest%'
ERROR: 

-- internal sequences should not be shown here
SELECT sequence_name FROM information_schema.sequences WHERE sequence_name LIKE 'itest%'

Catalog Error: Table with name sequences does not exist!
Did you mean "temp.pg_catalog.pg_sequences"?


SELECT pg_get_serial_sequence('itest1', 'a')
ERROR: 

SELECT pg_get_serial_sequence('itest1', 'a')

Catalog Error: Scalar Function with name pg_get_serial_sequence does not exist!
Did you mean "pg_get_expr"?


-- \d itest1_a_seq

CREATE TABLE itest4 (a int, b text)

ALTER TABLE itest4 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest4 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
  -- error, requires NOT NULL
ALTER TABLE itest4 ALTER COLUMN a SET NOT NULL

ALTER TABLE itest4 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest4 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
  -- ok
ALTER TABLE itest4 ALTER COLUMN a DROP NOT NULL
  -- error, disallowed
ALTER TABLE itest4 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR:   -- error, disallowed
ALTER TABLE itest4 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
  -- error, already set
ALTER TABLE itest4 ALTER COLUMN b ADD GENERATED ALWAYS AS IDENTITY
ERROR:   -- error, already set
ALTER TABLE itest4 ALTER COLUMN b ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
  -- error, wrong data type

-- for later
ALTER TABLE itest4 ALTER COLUMN b SET DEFAULT ''


-- invalid column type
CREATE TABLE itest_err_1 (a text generated by default as identity)
ERROR: 

-- invalid column type
CREATE TABLE itest_err_1 (a text generated by default as identity)

Not implemented Error: Constraint not implemented!


-- duplicate identity
CREATE TABLE itest_err_2 (a int generated always as identity generated by default as identity)
ERROR: 

-- duplicate identity
CREATE TABLE itest_err_2 (a int generated always as identity generated by default as identity)

Parser Error: syntax error at or near "generated"


-- cannot have default and identity
CREATE TABLE itest_err_3 (a int default 5 generated by default as identity)
ERROR: 

-- cannot have default and identity
CREATE TABLE itest_err_3 (a int default 5 generated by default as identity)

Parser Error: syntax error at or near "generated"


-- cannot combine serial and identity
CREATE TABLE itest_err_4 (a serial generated by default as identity)
ERROR: 

-- cannot combine serial and identity
CREATE TABLE itest_err_4 (a serial generated by default as identity)

Not implemented Error: Constraint not implemented!


INSERT INTO itest1 DEFAULT VALUES
ERROR: 

INSERT INTO itest1 DEFAULT VALUES

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?

INSERT INTO itest1 DEFAULT VALUES
ERROR: 
INSERT INTO itest1 DEFAULT VALUES

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?

INSERT INTO itest2 DEFAULT VALUES
ERROR: 
INSERT INTO itest2 DEFAULT VALUES

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?

INSERT INTO itest2 DEFAULT VALUES
ERROR: 
INSERT INTO itest2 DEFAULT VALUES

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?

INSERT INTO itest3 DEFAULT VALUES
ERROR: 
INSERT INTO itest3 DEFAULT VALUES

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest4"?

INSERT INTO itest3 DEFAULT VALUES
ERROR: 
INSERT INTO itest3 DEFAULT VALUES

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest4"?

INSERT INTO itest4 DEFAULT VALUES

INSERT INTO itest4 DEFAULT VALUES


SELECT * FROM itest1
ERROR: 

SELECT * FROM itest1

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?

SELECT * FROM itest2
ERROR: 
SELECT * FROM itest2

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?

SELECT * FROM itest3
ERROR: 
SELECT * FROM itest3

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest4"?

SELECT * FROM itest4
RESULT: 
	[(None, ''), (None, '')]



-- VALUES RTEs

CREATE TABLE itest5 (a int generated always as identity, b text)
ERROR: 


-- VALUES RTEs

CREATE TABLE itest5 (a int generated always as identity, b text)

Not implemented Error: Constraint not implemented!

INSERT INTO itest5 VALUES (1, 'a')
ERROR: 
INSERT INTO itest5 VALUES (1, 'a')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?
  -- error
INSERT INTO itest5 VALUES (DEFAULT, 'a')
ERROR:   -- error
INSERT INTO itest5 VALUES (DEFAULT, 'a')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?
  -- ok
INSERT INTO itest5 VALUES (2, 'b'), (3, 'c')
ERROR:   -- ok
INSERT INTO itest5 VALUES (2, 'b'), (3, 'c')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?
  -- error
INSERT INTO itest5 VALUES (DEFAULT, 'b'), (3, 'c')
ERROR:   -- error
INSERT INTO itest5 VALUES (DEFAULT, 'b'), (3, 'c')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?
  -- error
INSERT INTO itest5 VALUES (2, 'b'), (DEFAULT, 'c')
ERROR:   -- error
INSERT INTO itest5 VALUES (2, 'b'), (DEFAULT, 'c')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?
  -- error
INSERT INTO itest5 VALUES (DEFAULT, 'b'), (DEFAULT, 'c')
ERROR:   -- error
INSERT INTO itest5 VALUES (DEFAULT, 'b'), (DEFAULT, 'c')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?
  -- ok

INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (-1, 'aa')
ERROR:   -- ok

INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (-1, 'aa')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (-2, 'bb'), (-3, 'cc')
ERROR: 
INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (-2, 'bb'), (-3, 'cc')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (DEFAULT, 'dd'), (-4, 'ee')
ERROR: 
INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (DEFAULT, 'dd'), (-4, 'ee')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (-5, 'ff'), (DEFAULT, 'gg')
ERROR: 
INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (-5, 'ff'), (DEFAULT, 'gg')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (DEFAULT, 'hh'), (DEFAULT, 'ii')
ERROR: 
INSERT INTO itest5 OVERRIDING SYSTEM VALUE VALUES (DEFAULT, 'hh'), (DEFAULT, 'ii')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?


INSERT INTO itest5 OVERRIDING USER VALUE VALUES (-1, 'aaa')
ERROR: 

INSERT INTO itest5 OVERRIDING USER VALUE VALUES (-1, 'aaa')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING USER VALUE VALUES (-2, 'bbb'), (-3, 'ccc')
ERROR: 
INSERT INTO itest5 OVERRIDING USER VALUE VALUES (-2, 'bbb'), (-3, 'ccc')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING USER VALUE VALUES (DEFAULT, 'ddd'), (-4, 'eee')
ERROR: 
INSERT INTO itest5 OVERRIDING USER VALUE VALUES (DEFAULT, 'ddd'), (-4, 'eee')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING USER VALUE VALUES (-5, 'fff'), (DEFAULT, 'ggg')
ERROR: 
INSERT INTO itest5 OVERRIDING USER VALUE VALUES (-5, 'fff'), (DEFAULT, 'ggg')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

INSERT INTO itest5 OVERRIDING USER VALUE VALUES (DEFAULT, 'hhh'), (DEFAULT, 'iii')
ERROR: 
INSERT INTO itest5 OVERRIDING USER VALUE VALUES (DEFAULT, 'hhh'), (DEFAULT, 'iii')

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?


SELECT * FROM itest5
ERROR: 

SELECT * FROM itest5

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?

DROP TABLE itest5
ERROR: 
DROP TABLE itest5

Catalog Error: Table with name itest5 does not exist!
Did you mean "itest4"?


INSERT INTO itest3 VALUES (DEFAULT, 'a')
ERROR: 

INSERT INTO itest3 VALUES (DEFAULT, 'a')

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest4"?

INSERT INTO itest3 VALUES (DEFAULT, 'b'), (DEFAULT, 'c')
ERROR: 
INSERT INTO itest3 VALUES (DEFAULT, 'b'), (DEFAULT, 'c')

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest4"?


SELECT * FROM itest3
ERROR: 

SELECT * FROM itest3

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest4"?



-- OVERRIDING tests

-- GENERATED BY DEFAULT

-- This inserts the row as presented:
INSERT INTO itest1 VALUES (10, 'xyz')
ERROR: 


-- OVERRIDING tests

-- GENERATED BY DEFAULT

-- This inserts the row as presented:
INSERT INTO itest1 VALUES (10, 'xyz')

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?

-- With GENERATED BY DEFAULT, OVERRIDING SYSTEM VALUE is not allowed
-- by the standard, but we allow it as a no-op, since it is of use if
-- there are multiple identity columns in a table, which is also an
-- extension.
INSERT INTO itest1 OVERRIDING SYSTEM VALUE VALUES (20, 'xyz')
ERROR: 
-- With GENERATED BY DEFAULT, OVERRIDING SYSTEM VALUE is not allowed
-- by the standard, but we allow it as a no-op, since it is of use if
-- there are multiple identity columns in a table, which is also an
-- extension.
INSERT INTO itest1 OVERRIDING SYSTEM VALUE VALUES (20, 'xyz')

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?

-- This ignores the 30 and uses the sequence value instead:
INSERT INTO itest1 OVERRIDING USER VALUE VALUES (30, 'xyz')
ERROR: 
-- This ignores the 30 and uses the sequence value instead:
INSERT INTO itest1 OVERRIDING USER VALUE VALUES (30, 'xyz')

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?


SELECT * FROM itest1
ERROR: 

SELECT * FROM itest1

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?


-- GENERATED ALWAYS

-- This is an error:
INSERT INTO itest2 VALUES (10, 'xyz')
ERROR: 

-- GENERATED ALWAYS

-- This is an error:
INSERT INTO itest2 VALUES (10, 'xyz')

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?

-- This inserts the row as presented:
INSERT INTO itest2 OVERRIDING SYSTEM VALUE VALUES (20, 'xyz')
ERROR: 
-- This inserts the row as presented:
INSERT INTO itest2 OVERRIDING SYSTEM VALUE VALUES (20, 'xyz')

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?

-- This ignores the 30 and uses the sequence value instead:
INSERT INTO itest2 OVERRIDING USER VALUE VALUES (30, 'xyz')
ERROR: 
-- This ignores the 30 and uses the sequence value instead:
INSERT INTO itest2 OVERRIDING USER VALUE VALUES (30, 'xyz')

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?


SELECT * FROM itest2
ERROR: 

SELECT * FROM itest2

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?



-- UPDATE tests

-- GENERATED BY DEFAULT is not restricted.
UPDATE itest1 SET a = 101 WHERE a = 1
ERROR: 


-- UPDATE tests

-- GENERATED BY DEFAULT is not restricted.
UPDATE itest1 SET a = 101 WHERE a = 1

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?
LINE 7: UPDATE itest1 SET a = 101 WHERE a = 1
               ^

UPDATE itest1 SET a = DEFAULT WHERE a = 2
ERROR: 
UPDATE itest1 SET a = DEFAULT WHERE a = 2

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?
LINE 2: UPDATE itest1 SET a = DEFAULT WHERE a = 2
               ^

SELECT * FROM itest1
ERROR: 
SELECT * FROM itest1

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest4"?


-- GENERATED ALWAYS allows only DEFAULT.
UPDATE itest2 SET a = 101 WHERE a = 1
ERROR: 

-- GENERATED ALWAYS allows only DEFAULT.
UPDATE itest2 SET a = 101 WHERE a = 1

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?
LINE 4: UPDATE itest2 SET a = 101 WHERE a = 1
               ^
  -- error
UPDATE itest2 SET a = DEFAULT WHERE a = 2
ERROR:   -- error
UPDATE itest2 SET a = DEFAULT WHERE a = 2

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?
LINE 2: UPDATE itest2 SET a = DEFAULT WHERE a = 2
               ^
  -- ok
SELECT * FROM itest2
ERROR:   -- ok
SELECT * FROM itest2

Catalog Error: Table with name itest2 does not exist!
Did you mean "itest4"?



-- COPY tests

CREATE TABLE itest9 (a int GENERATED ALWAYS AS IDENTITY, b text, c bigint)
ERROR: 


-- COPY tests

CREATE TABLE itest9 (a int GENERATED ALWAYS AS IDENTITY, b text, c bigint)

Not implemented Error: Constraint not implemented!


COPY itest9 FROM stdin
ERROR: 

COPY itest9 FROM stdin

Catalog Error: Table with name itest9 does not exist!
Did you mean "itest4"?

100	foo	200
101	bar	201
\.

COPY itest9 (b, c) FROM stdin
ERROR: 
100	foo	200
101	bar	201
\.

COPY itest9 (b, c) FROM stdin

Parser Error: syntax error at or near "100"

foo2	202
bar2	203
\.

SELECT * FROM itest9 ORDER BY c
ERROR: 
foo2	202
bar2	203
\.

SELECT * FROM itest9 ORDER BY c

Parser Error: syntax error at or near "foo2"



-- DROP IDENTITY tests

ALTER TABLE itest4 ALTER COLUMN a DROP IDENTITY
ERROR: 


-- DROP IDENTITY tests

ALTER TABLE itest4 ALTER COLUMN a DROP IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE itest4 ALTER COLUMN a DROP IDENTITY
ERROR: 
ALTER TABLE itest4 ALTER COLUMN a DROP IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
  -- error
ALTER TABLE itest4 ALTER COLUMN a DROP IDENTITY IF EXISTS
ERROR:   -- error
ALTER TABLE itest4 ALTER COLUMN a DROP IDENTITY IF EXISTS

Not implemented Error: No support for that ALTER TABLE option yet!
  -- noop

INSERT INTO itest4 DEFAULT VALUES
  -- fails because NOT NULL is not dropped
ALTER TABLE itest4 ALTER COLUMN a DROP NOT NULL

INSERT INTO itest4 DEFAULT VALUES

SELECT * FROM itest4
RESULT: 
	[(None, ''), (None, ''), (None, ''), (None, '')]


-- check that sequence is removed
SELECT sequence_name FROM itest4_a_seq
ERROR: 

-- check that sequence is removed
SELECT sequence_name FROM itest4_a_seq

Catalog Error: Table with name itest4_a_seq does not exist!
Did you mean "itest4"?



-- test views

CREATE TABLE itest10 (a int generated by default as identity, b text)
ERROR: 


-- test views

CREATE TABLE itest10 (a int generated by default as identity, b text)

Not implemented Error: Constraint not implemented!

CREATE TABLE itest11 (a int generated always as identity, b text)
ERROR: 
CREATE TABLE itest11 (a int generated always as identity, b text)

Not implemented Error: Constraint not implemented!


CREATE VIEW itestv10 AS SELECT * FROM itest10
ERROR: 

CREATE VIEW itestv10 AS SELECT * FROM itest10

Catalog Error: Table with name itest10 does not exist!
Did you mean "itest4"?
LINE 3: CREATE VIEW itestv10 AS SELECT * FROM itest10
                                              ^

CREATE VIEW itestv11 AS SELECT * FROM itest11
ERROR: 
CREATE VIEW itestv11 AS SELECT * FROM itest11

Catalog Error: Table with name itest11 does not exist!
Did you mean "itest4"?
LINE 2: CREATE VIEW itestv11 AS SELECT * FROM itest11
                                              ^


INSERT INTO itestv10 DEFAULT VALUES
ERROR: 

INSERT INTO itestv10 DEFAULT VALUES

Catalog Error: Table with name itestv10 does not exist!
Did you mean "itest4"?

INSERT INTO itestv10 DEFAULT VALUES
ERROR: 
INSERT INTO itestv10 DEFAULT VALUES

Catalog Error: Table with name itestv10 does not exist!
Did you mean "itest4"?


INSERT INTO itestv11 DEFAULT VALUES
ERROR: 

INSERT INTO itestv11 DEFAULT VALUES

Catalog Error: Table with name itestv11 does not exist!
Did you mean "itest4"?

INSERT INTO itestv11 DEFAULT VALUES
ERROR: 
INSERT INTO itestv11 DEFAULT VALUES

Catalog Error: Table with name itestv11 does not exist!
Did you mean "itest4"?


SELECT * FROM itestv10
ERROR: 

SELECT * FROM itestv10

Catalog Error: Table with name itestv10 does not exist!
Did you mean "itest4"?

SELECT * FROM itestv11
ERROR: 
SELECT * FROM itestv11

Catalog Error: Table with name itestv11 does not exist!
Did you mean "itest4"?


INSERT INTO itestv10 VALUES (10, 'xyz')
ERROR: 

INSERT INTO itestv10 VALUES (10, 'xyz')

Catalog Error: Table with name itestv10 does not exist!
Did you mean "itest4"?

INSERT INTO itestv10 OVERRIDING USER VALUE VALUES (11, 'xyz')
ERROR: 
INSERT INTO itestv10 OVERRIDING USER VALUE VALUES (11, 'xyz')

Catalog Error: Table with name itestv10 does not exist!
Did you mean "itest4"?


SELECT * FROM itestv10
ERROR: 

SELECT * FROM itestv10

Catalog Error: Table with name itestv10 does not exist!
Did you mean "itest4"?


INSERT INTO itestv11 VALUES (10, 'xyz')
ERROR: 

INSERT INTO itestv11 VALUES (10, 'xyz')

Catalog Error: Table with name itestv11 does not exist!
Did you mean "itest4"?

INSERT INTO itestv11 OVERRIDING SYSTEM VALUE VALUES (11, 'xyz')
ERROR: 
INSERT INTO itestv11 OVERRIDING SYSTEM VALUE VALUES (11, 'xyz')

Catalog Error: Table with name itestv11 does not exist!
Did you mean "itest4"?


SELECT * FROM itestv11
ERROR: 

SELECT * FROM itestv11

Catalog Error: Table with name itestv11 does not exist!
Did you mean "itest4"?


DROP VIEW itestv10, itestv11
ERROR: 

DROP VIEW itestv10, itestv11

Not implemented Error: Can only drop one object at a time



-- ADD COLUMN

CREATE TABLE itest13 (a int)

-- add column to empty table
ALTER TABLE itest13 ADD COLUMN b int GENERATED BY DEFAULT AS IDENTITY
ERROR: 
-- add column to empty table
ALTER TABLE itest13 ADD COLUMN b int GENERATED BY DEFAULT AS IDENTITY

Parser Error: Adding generated columns after table creation is not supported yet

INSERT INTO itest13 VALUES (1), (2), (3)

-- add column to populated table
ALTER TABLE itest13 ADD COLUMN c int GENERATED BY DEFAULT AS IDENTITY
ERROR: 
-- add column to populated table
ALTER TABLE itest13 ADD COLUMN c int GENERATED BY DEFAULT AS IDENTITY

Parser Error: Adding generated columns after table creation is not supported yet

SELECT * FROM itest13
RESULT: 
	[(1,), (2,), (3,)]



-- various ALTER COLUMN tests

-- fail, not allowed for identity columns
ALTER TABLE itest1 ALTER COLUMN a SET DEFAULT 1
ERROR: 


-- various ALTER COLUMN tests

-- fail, not allowed for identity columns
ALTER TABLE itest1 ALTER COLUMN a SET DEFAULT 1

Catalog Error: Table with name itest1 does not exist!
Did you mean "itest13"?


-- fail, not allowed, already has a default
CREATE TABLE itest5 (a serial, b text)
ERROR: 

-- fail, not allowed, already has a default
CREATE TABLE itest5 (a serial, b text)

Catalog Error: Type with name serial does not exist!
Did you mean "real"?

ALTER TABLE itest5 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest5 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!


ALTER TABLE itest3 ALTER COLUMN a TYPE int
ERROR: 

ALTER TABLE itest3 ALTER COLUMN a TYPE int

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest13"?

SELECT seqtypid::regtype FROM pg_sequence WHERE seqrelid = 'itest3_a_seq'::regclass
ERROR: 
SELECT seqtypid::regtype FROM pg_sequence WHERE seqrelid = 'itest3_a_seq'::regclass

Catalog Error: Type with name regclass does not exist!
Did you mean "real"?

-- \d itest3

ALTER TABLE itest3 ALTER COLUMN a TYPE text
ERROR: 
-- \d itest3

ALTER TABLE itest3 ALTER COLUMN a TYPE text

Catalog Error: Table with name itest3 does not exist!
Did you mean "itest13"?
  -- error

-- check that unlogged propagates to sequence
CREATE UNLOGGED TABLE itest17 (a int NOT NULL, b text)

ALTER TABLE itest17 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest17 ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE itest17 ADD COLUMN c int GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest17 ADD COLUMN c int GENERATED ALWAYS AS IDENTITY

Parser Error: Adding generated columns after table creation is not supported yet

-- \d itest17
-- \d itest17_a_seq
-- \d itest17_c_seq
CREATE TABLE itest18 (a int NOT NULL, b text)

ALTER TABLE itest18 SET UNLOGGED, ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest18 SET UNLOGGED, ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Parser Error: Only one ALTER command per statement is supported

-- \d itest18
-- \d itest18_a_seq
ALTER TABLE itest18 SET LOGGED
ERROR: 
-- \d itest18
-- \d itest18_a_seq
ALTER TABLE itest18 SET LOGGED

Not implemented Error: No support for that ALTER TABLE option yet!

-- \d itest18
-- \d itest18_a_seq
ALTER TABLE itest18 SET UNLOGGED
ERROR: 
-- \d itest18
-- \d itest18_a_seq
ALTER TABLE itest18 SET UNLOGGED

Not implemented Error: No support for that ALTER TABLE option yet!

-- \d itest18
-- \d itest18_a_seq

-- kinda silly to change property in the same command, but it should work
ALTER TABLE itest3
  ADD COLUMN c int GENERATED BY DEFAULT AS IDENTITY,
  ALTER COLUMN c SET GENERATED ALWAYS
ERROR: 
-- \d itest18
-- \d itest18_a_seq

-- kinda silly to change property in the same command, but it should work
ALTER TABLE itest3
  ADD COLUMN c int GENERATED BY DEFAULT AS IDENTITY,
  ALTER COLUMN c SET GENERATED ALWAYS

Parser Error: Only one ALTER command per statement is supported

-- \d itest3


-- ALTER COLUMN ... SET

CREATE TABLE itest6 (a int GENERATED ALWAYS AS IDENTITY, b text)
ERROR: 
-- \d itest3


-- ALTER COLUMN ... SET

CREATE TABLE itest6 (a int GENERATED ALWAYS AS IDENTITY, b text)

Not implemented Error: Constraint not implemented!

INSERT INTO itest6 DEFAULT VALUES
ERROR: 
INSERT INTO itest6 DEFAULT VALUES

Catalog Error: Table with name itest6 does not exist!
Did you mean "itest4"?


ALTER TABLE itest6 ALTER COLUMN a SET GENERATED BY DEFAULT SET INCREMENT BY 2 SET START WITH 100 RESTART
ERROR: 

ALTER TABLE itest6 ALTER COLUMN a SET GENERATED BY DEFAULT SET INCREMENT BY 2 SET START WITH 100 RESTART

Not implemented Error: No support for that ALTER TABLE option yet!

INSERT INTO itest6 DEFAULT VALUES
ERROR: 
INSERT INTO itest6 DEFAULT VALUES

Catalog Error: Table with name itest6 does not exist!
Did you mean "itest4"?

INSERT INTO itest6 DEFAULT VALUES
ERROR: 
INSERT INTO itest6 DEFAULT VALUES

Catalog Error: Table with name itest6 does not exist!
Did you mean "itest4"?

SELECT * FROM itest6
ERROR: 
SELECT * FROM itest6

Catalog Error: Table with name itest6 does not exist!
Did you mean "itest4"?


SELECT table_name, column_name, is_identity, identity_generation FROM information_schema.columns WHERE table_name = 'itest6' ORDER BY 1, 2
RESULT: 
	[]


ALTER TABLE itest6 ALTER COLUMN b SET INCREMENT BY 2
ERROR: 

ALTER TABLE itest6 ALTER COLUMN b SET INCREMENT BY 2

Not implemented Error: No support for that ALTER TABLE option yet!
  -- fail, not identity


-- prohibited direct modification of sequence

ALTER SEQUENCE itest6_a_seq OWNED BY NONE
ERROR:   -- fail, not identity


-- prohibited direct modification of sequence

ALTER SEQUENCE itest6_a_seq OWNED BY NONE

Catalog Error: Sequence with name itest6_a_seq does not exist!



-- inheritance

CREATE TABLE itest7 (a int GENERATED ALWAYS AS IDENTITY)
ERROR: 


-- inheritance

CREATE TABLE itest7 (a int GENERATED ALWAYS AS IDENTITY)

Not implemented Error: Constraint not implemented!

INSERT INTO itest7 DEFAULT VALUES
ERROR: 
INSERT INTO itest7 DEFAULT VALUES

Catalog Error: Table with name itest7 does not exist!
Did you mean "itest17"?

SELECT * FROM itest7
ERROR: 
SELECT * FROM itest7

Catalog Error: Table with name itest7 does not exist!
Did you mean "itest17"?


-- identity property is not inherited
CREATE TABLE itest7a (b text) INHERITS (itest7)
ERROR: 

-- identity property is not inherited
CREATE TABLE itest7a (b text) INHERITS (itest7)

Parser Error: syntax error at or near "INHERITS"


-- make column identity in child table
CREATE TABLE itest7b (a int)

CREATE TABLE itest7c (a int GENERATED ALWAYS AS IDENTITY) INHERITS (itest7b)
ERROR: 
CREATE TABLE itest7c (a int GENERATED ALWAYS AS IDENTITY) INHERITS (itest7b)

Parser Error: syntax error at or near "INHERITS"

INSERT INTO itest7c DEFAULT VALUES
ERROR: 
INSERT INTO itest7c DEFAULT VALUES

Catalog Error: Table with name itest7c does not exist!
Did you mean "itest17"?

SELECT * FROM itest7c
ERROR: 
SELECT * FROM itest7c

Catalog Error: Table with name itest7c does not exist!
Did you mean "itest17"?


CREATE TABLE itest7d (a int not null)

CREATE TABLE itest7e () INHERITS (itest7d)
ERROR: 
CREATE TABLE itest7e () INHERITS (itest7d)

Parser Error: syntax error at or near "INHERITS"

ALTER TABLE itest7d ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest7d ALTER COLUMN a ADD GENERATED ALWAYS AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE itest7d ADD COLUMN b int GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE itest7d ADD COLUMN b int GENERATED ALWAYS AS IDENTITY

Parser Error: Adding generated columns after table creation is not supported yet
  -- error

SELECT table_name, column_name, is_nullable, is_identity, identity_generation FROM information_schema.columns WHERE table_name LIKE 'itest7%' ORDER BY 1, 2
RESULT: 
	[('itest7b', 'a', 'YES', None, None), ('itest7d', 'a', 'NO', None, None)]


-- These ALTER TABLE variants will not recurse.
ALTER TABLE itest7 ALTER COLUMN a SET GENERATED BY DEFAULT
ERROR: 

-- These ALTER TABLE variants will not recurse.
ALTER TABLE itest7 ALTER COLUMN a SET GENERATED BY DEFAULT

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE itest7 ALTER COLUMN a RESTART
ERROR: 
ALTER TABLE itest7 ALTER COLUMN a RESTART

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE itest7 ALTER COLUMN a DROP IDENTITY
ERROR: 
ALTER TABLE itest7 ALTER COLUMN a DROP IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!


-- privileges
CREATE USER regress_identity_user1
ERROR: 

-- privileges
CREATE USER regress_identity_user1

Parser Error: syntax error at or near "USER"

CREATE TABLE itest8 (a int GENERATED ALWAYS AS IDENTITY, b text)
ERROR: 
CREATE TABLE itest8 (a int GENERATED ALWAYS AS IDENTITY, b text)

Not implemented Error: Constraint not implemented!

GRANT SELECT, INSERT ON itest8 TO regress_identity_user1
ERROR: 
GRANT SELECT, INSERT ON itest8 TO regress_identity_user1

Parser Error: syntax error at or near "GRANT"

SET ROLE regress_identity_user1
ERROR: 
SET ROLE regress_identity_user1

Parser Error: syntax error at or near "regress_identity_user1"

INSERT INTO itest8 DEFAULT VALUES
ERROR: 
INSERT INTO itest8 DEFAULT VALUES

Catalog Error: Table with name itest8 does not exist!
Did you mean "itest18"?

SELECT * FROM itest8
ERROR: 
SELECT * FROM itest8

Catalog Error: Table with name itest8 does not exist!
Did you mean "itest18"?

RESET ROLE
ERROR: 
RESET ROLE

Catalog Error: unrecognized configuration parameter "ROLE"

Did you mean: "threads", "Calendar", "profile_output", "errors_as_json", "home_directory"

DROP TABLE itest8
ERROR: 
DROP TABLE itest8

Catalog Error: Table with name itest8 does not exist!
Did you mean "itest18"?

DROP USER regress_identity_user1
ERROR: 
DROP USER regress_identity_user1

Parser Error: syntax error at or near "USER"


-- multiple steps in ALTER TABLE
CREATE TABLE itest8 (f1 int)


ALTER TABLE itest8
  ADD COLUMN f2 int NOT NULL,
  ALTER COLUMN f2 ADD GENERATED ALWAYS AS IDENTITY
ERROR: 

ALTER TABLE itest8
  ADD COLUMN f2 int NOT NULL,
  ALTER COLUMN f2 ADD GENERATED ALWAYS AS IDENTITY

Parser Error: Only one ALTER command per statement is supported


ALTER TABLE itest8
  ADD COLUMN f3 int NOT NULL,
  ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY,
  ALTER COLUMN f3 SET GENERATED BY DEFAULT SET INCREMENT 10
ERROR: 

ALTER TABLE itest8
  ADD COLUMN f3 int NOT NULL,
  ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY,
  ALTER COLUMN f3 SET GENERATED BY DEFAULT SET INCREMENT 10

Parser Error: Only one ALTER command per statement is supported


ALTER TABLE itest8
  ADD COLUMN f4 int


ALTER TABLE itest8
  ALTER COLUMN f4 SET NOT NULL,
  ALTER COLUMN f4 ADD GENERATED ALWAYS AS IDENTITY,
  ALTER COLUMN f4 SET DATA TYPE bigint
ERROR: 

ALTER TABLE itest8
  ALTER COLUMN f4 SET NOT NULL,
  ALTER COLUMN f4 ADD GENERATED ALWAYS AS IDENTITY,
  ALTER COLUMN f4 SET DATA TYPE bigint

Parser Error: Only one ALTER command per statement is supported


ALTER TABLE itest8
  ADD COLUMN f5 int GENERATED ALWAYS AS IDENTITY
ERROR: 

ALTER TABLE itest8
  ADD COLUMN f5 int GENERATED ALWAYS AS IDENTITY

Parser Error: Adding generated columns after table creation is not supported yet


ALTER TABLE itest8
  ALTER COLUMN f5 DROP IDENTITY,
  ALTER COLUMN f5 DROP NOT NULL,
  ALTER COLUMN f5 SET DATA TYPE bigint
ERROR: 

ALTER TABLE itest8
  ALTER COLUMN f5 DROP IDENTITY,
  ALTER COLUMN f5 DROP NOT NULL,
  ALTER COLUMN f5 SET DATA TYPE bigint

Parser Error: Only one ALTER command per statement is supported


INSERT INTO itest8 VALUES(0), (1)
ERROR: 

INSERT INTO itest8 VALUES(0), (1)

Binder Error: table itest8 has 2 columns but 1 values were supplied


-- This does not work when the table isn''t empty.  That''s intentional,
-- since ADD GENERATED should only affect later insertions:
ALTER TABLE itest8
  ADD COLUMN f22 int NOT NULL,
  ALTER COLUMN f22 ADD GENERATED ALWAYS AS IDENTITY
ERROR: 

-- This does not work when the table isn''t empty.  That''s intentional,
-- since ADD GENERATED should only affect later insertions:
ALTER TABLE itest8
  ADD COLUMN f22 int NOT NULL,
  ALTER COLUMN f22 ADD GENERATED ALWAYS AS IDENTITY

Parser Error: Only one ALTER command per statement is supported


TABLE itest8
RESULT: 
	[]

-- \d+ itest8
-- \d itest8_f2_seq
-- \d itest8_f3_seq
-- \d itest8_f4_seq
-- \d itest8_f5_seq
DROP TABLE itest8



-- typed tables (currently not supported)

CREATE TYPE itest_type AS (f1 integer, f2 text, f3 bigint)
ERROR: 


-- typed tables (currently not supported)

CREATE TYPE itest_type AS (f1 integer, f2 text, f3 bigint)

Parser Error: syntax error at or near "("

CREATE TABLE itest12 OF itest_type (f1 WITH OPTIONS GENERATED ALWAYS AS IDENTITY)
ERROR: 
CREATE TABLE itest12 OF itest_type (f1 WITH OPTIONS GENERATED ALWAYS AS IDENTITY)

Parser Error: syntax error at or near "OF"
 -- error
DROP TYPE itest_type CASCADE
ERROR:  -- error
DROP TYPE itest_type CASCADE

Catalog Error: Type with name itest_type does not exist!
Did you mean "list"?



-- table partitions

-- partitions inherit identity column and share sequence
CREATE TABLE pitest1 (f1 date NOT NULL, f2 text, f3 bigint generated always as identity) PARTITION BY RANGE (f1)
ERROR: 


-- table partitions

-- partitions inherit identity column and share sequence
CREATE TABLE pitest1 (f1 date NOT NULL, f2 text, f3 bigint generated always as identity) PARTITION BY RANGE (f1)

Parser Error: syntax error at or near "PARTITION"

-- new partition
CREATE TABLE pitest1_p1 PARTITION OF pitest1 FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')
ERROR: 
-- new partition
CREATE TABLE pitest1_p1 PARTITION OF pitest1 FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')

Parser Error: syntax error at or near "PARTITION"

INSERT into pitest1(f1, f2) VALUES ('2016-07-2', 'from pitest1')
ERROR: 
INSERT into pitest1(f1, f2) VALUES ('2016-07-2', 'from pitest1')

Catalog Error: Table with name pitest1 does not exist!
Did you mean "itest13"?

INSERT into pitest1_p1 (f1, f2) VALUES ('2016-07-3', 'from pitest1_p1')
ERROR: 
INSERT into pitest1_p1 (f1, f2) VALUES ('2016-07-3', 'from pitest1_p1')

Catalog Error: Table with name pitest1_p1 does not exist!
Did you mean "itest13"?

-- attached partition
CREATE TABLE pitest1_p2 (f1 date NOT NULL, f2 text, f3 bigint)

INSERT INTO pitest1_p2 VALUES ('2016-08-2', 'before attaching', 100)

ALTER TABLE pitest1 ATTACH PARTITION pitest1_p2 FOR VALUES FROM ('2016-08-01') TO ('2016-09-01')
ERROR: 
ALTER TABLE pitest1 ATTACH PARTITION pitest1_p2 FOR VALUES FROM ('2016-08-01') TO ('2016-09-01')

Parser Error: syntax error at or near "ATTACH"
 -- requires NOT NULL constraint
ALTER TABLE pitest1_p2 ALTER COLUMN f3 SET NOT NULL

ALTER TABLE pitest1 ATTACH PARTITION pitest1_p2 FOR VALUES FROM ('2016-08-01') TO ('2016-09-01')
ERROR: 
ALTER TABLE pitest1 ATTACH PARTITION pitest1_p2 FOR VALUES FROM ('2016-08-01') TO ('2016-09-01')

Parser Error: syntax error at or near "ATTACH"

INSERT INTO pitest1_p2 (f1, f2) VALUES ('2016-08-3', 'from pitest1_p2')
ERROR: 
INSERT INTO pitest1_p2 (f1, f2) VALUES ('2016-08-3', 'from pitest1_p2')

Constraint Error: NOT NULL constraint failed: pitest1_p2.f3

INSERT INTO pitest1 (f1, f2) VALUES ('2016-08-4', 'from pitest1')
ERROR: 
INSERT INTO pitest1 (f1, f2) VALUES ('2016-08-4', 'from pitest1')

Catalog Error: Table with name pitest1 does not exist!
Did you mean "itest13"?

SELECT tableoid::regclass, f1, f2, f3 FROM pitest1
ERROR: 
SELECT tableoid::regclass, f1, f2, f3 FROM pitest1

Catalog Error: Table with name pitest1 does not exist!
Did you mean "itest13"?


-- add identity column
CREATE TABLE pitest2 (f1 date NOT NULL, f2 text) PARTITION BY RANGE (f1)
ERROR: 

-- add identity column
CREATE TABLE pitest2 (f1 date NOT NULL, f2 text) PARTITION BY RANGE (f1)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE pitest2_p1 PARTITION OF pitest2 FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')
ERROR: 
CREATE TABLE pitest2_p1 PARTITION OF pitest2 FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE pitest2_p2 PARTITION OF pitest2 FOR VALUES FROM ('2016-08-01') TO ('2016-09-01')
ERROR: 
CREATE TABLE pitest2_p2 PARTITION OF pitest2 FOR VALUES FROM ('2016-08-01') TO ('2016-09-01')

Parser Error: syntax error at or near "PARTITION"

INSERT into pitest2(f1, f2) VALUES ('2016-07-2', 'from pitest2')
ERROR: 
INSERT into pitest2(f1, f2) VALUES ('2016-07-2', 'from pitest2')

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

INSERT INTO pitest2 (f1, f2) VALUES ('2016-08-2', 'from pitest2')
ERROR: 
INSERT INTO pitest2 (f1, f2) VALUES ('2016-08-2', 'from pitest2')

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

ALTER TABLE pitest2 ADD COLUMN f3 int GENERATED ALWAYS AS IDENTITY
ERROR: 
ALTER TABLE pitest2 ADD COLUMN f3 int GENERATED ALWAYS AS IDENTITY

Parser Error: Adding generated columns after table creation is not supported yet

INSERT into pitest2_p1 (f1, f2) VALUES ('2016-07-3', 'from pitest2_p1')
ERROR: 
INSERT into pitest2_p1 (f1, f2) VALUES ('2016-07-3', 'from pitest2_p1')

Catalog Error: Table with name pitest2_p1 does not exist!
Did you mean "pitest1_p2"?

INSERT INTO pitest2_p2 (f1, f2) VALUES ('2016-08-3', 'from pitest2_p2')
ERROR: 
INSERT INTO pitest2_p2 (f1, f2) VALUES ('2016-08-3', 'from pitest2_p2')

Catalog Error: Table with name pitest2_p2 does not exist!
Did you mean "pitest1_p2"?

INSERT into pitest2(f1, f2) VALUES ('2016-07-4', 'from pitest2')
ERROR: 
INSERT into pitest2(f1, f2) VALUES ('2016-07-4', 'from pitest2')

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

INSERT INTO pitest2 (f1, f2) VALUES ('2016-08-4', 'from pitest2')
ERROR: 
INSERT INTO pitest2 (f1, f2) VALUES ('2016-08-4', 'from pitest2')

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

SELECT tableoid::regclass, f1, f2, f3 FROM pitest2
ERROR: 
SELECT tableoid::regclass, f1, f2, f3 FROM pitest2

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?


-- SET identity column
ALTER TABLE pitest2_p1 ALTER COLUMN f3 SET GENERATED BY DEFAULT
ERROR: 

-- SET identity column
ALTER TABLE pitest2_p1 ALTER COLUMN f3 SET GENERATED BY DEFAULT

Not implemented Error: No support for that ALTER TABLE option yet!
 -- fails
ALTER TABLE pitest2_p1 ALTER COLUMN f3 SET INCREMENT BY 2
ERROR:  -- fails
ALTER TABLE pitest2_p1 ALTER COLUMN f3 SET INCREMENT BY 2

Not implemented Error: No support for that ALTER TABLE option yet!
 -- fails
ALTER TABLE ONLY pitest2 ALTER COLUMN f3 SET GENERATED BY DEFAULT SET INCREMENT BY 2 SET START WITH 1000 RESTART
ERROR:  -- fails
ALTER TABLE ONLY pitest2 ALTER COLUMN f3 SET GENERATED BY DEFAULT SET INCREMENT BY 2 SET START WITH 1000 RESTART

Not implemented Error: No support for that ALTER TABLE option yet!
 -- fails
ALTER TABLE pitest2 ALTER COLUMN f3 SET GENERATED BY DEFAULT SET INCREMENT BY 2 SET START WITH 1000 RESTART
ERROR:  -- fails
ALTER TABLE pitest2 ALTER COLUMN f3 SET GENERATED BY DEFAULT SET INCREMENT BY 2 SET START WITH 1000 RESTART

Not implemented Error: No support for that ALTER TABLE option yet!

INSERT into pitest2(f1, f2, f3) VALUES ('2016-07-5', 'from pitest2', 200)
ERROR: 
INSERT into pitest2(f1, f2, f3) VALUES ('2016-07-5', 'from pitest2', 200)

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

INSERT INTO pitest2(f1, f2) VALUES ('2016-08-5', 'from pitest2')
ERROR: 
INSERT INTO pitest2(f1, f2) VALUES ('2016-08-5', 'from pitest2')

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

INSERT into pitest2_p1 (f1, f2) VALUES ('2016-07-6', 'from pitest2_p1')
ERROR: 
INSERT into pitest2_p1 (f1, f2) VALUES ('2016-07-6', 'from pitest2_p1')

Catalog Error: Table with name pitest2_p1 does not exist!
Did you mean "pitest1_p2"?

INSERT INTO pitest2_p2 (f1, f2, f3) VALUES ('2016-08-6', 'from pitest2_p2', 300)
ERROR: 
INSERT INTO pitest2_p2 (f1, f2, f3) VALUES ('2016-08-6', 'from pitest2_p2', 300)

Catalog Error: Table with name pitest2_p2 does not exist!
Did you mean "pitest1_p2"?

SELECT tableoid::regclass, f1, f2, f3 FROM pitest2
ERROR: 
SELECT tableoid::regclass, f1, f2, f3 FROM pitest2

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?


-- detaching a partition removes identity property
ALTER TABLE pitest2 DETACH PARTITION pitest2_p1
ERROR: 

-- detaching a partition removes identity property
ALTER TABLE pitest2 DETACH PARTITION pitest2_p1

Parser Error: syntax error at or near "DETACH"

INSERT into pitest2(f1, f2) VALUES ('2016-08-7', 'from pitest2')
ERROR: 
INSERT into pitest2(f1, f2) VALUES ('2016-08-7', 'from pitest2')

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

INSERT into pitest2_p1 (f1, f2) VALUES ('2016-07-7', 'from pitest2_p1')
ERROR: 
INSERT into pitest2_p1 (f1, f2) VALUES ('2016-07-7', 'from pitest2_p1')

Catalog Error: Table with name pitest2_p1 does not exist!
Did you mean "pitest1_p2"?
 -- error
INSERT into pitest2_p1 (f1, f2, f3) VALUES ('2016-07-7', 'from pitest2_p1', 2000)
ERROR:  -- error
INSERT into pitest2_p1 (f1, f2, f3) VALUES ('2016-07-7', 'from pitest2_p1', 2000)

Catalog Error: Table with name pitest2_p1 does not exist!
Did you mean "pitest1_p2"?

SELECT tableoid::regclass, f1, f2, f3 FROM pitest2
ERROR: 
SELECT tableoid::regclass, f1, f2, f3 FROM pitest2

Catalog Error: Table with name pitest2 does not exist!
Did you mean "itest4"?

SELECT tableoid::regclass, f1, f2, f3 FROM pitest2_p1
ERROR: 
SELECT tableoid::regclass, f1, f2, f3 FROM pitest2_p1

Catalog Error: Table with name pitest2_p1 does not exist!
Did you mean "pitest1_p2"?


DROP TABLE pitest2_p1
ERROR: 

DROP TABLE pitest2_p1

Catalog Error: Table with name pitest2_p1 does not exist!
Did you mean "pitest1_p2"?


-- changing a regular column to identity column in a partitioned table
CREATE TABLE pitest3 (f1 date NOT NULL, f2 text, f3 int) PARTITION BY RANGE (f1)
ERROR: 

-- changing a regular column to identity column in a partitioned table
CREATE TABLE pitest3 (f1 date NOT NULL, f2 text, f3 int) PARTITION BY RANGE (f1)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE pitest3_p1 PARTITION OF pitest3 FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')
ERROR: 
CREATE TABLE pitest3_p1 PARTITION OF pitest3 FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')

Parser Error: syntax error at or near "PARTITION"

INSERT into pitest3 VALUES ('2016-07-2', 'from pitest3', 1)
ERROR: 
INSERT into pitest3 VALUES ('2016-07-2', 'from pitest3', 1)

Catalog Error: Table with name pitest3 does not exist!
Did you mean "itest13"?

INSERT into pitest3_p1 VALUES ('2016-07-3', 'from pitest3_p1', 2)
ERROR: 
INSERT into pitest3_p1 VALUES ('2016-07-3', 'from pitest3_p1', 2)

Catalog Error: Table with name pitest3_p1 does not exist!
Did you mean "pitest1_p2"?

-- fails, changing only a partition not allowed
ALTER TABLE pitest3_p1
            ALTER COLUMN f3 SET NOT NULL,
            ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY (START WITH 3)
ERROR: 
-- fails, changing only a partition not allowed
ALTER TABLE pitest3_p1
            ALTER COLUMN f3 SET NOT NULL,
            ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY (START WITH 3)

Parser Error: Only one ALTER command per statement is supported

-- fails, changing only the partitioned table not allowed
ALTER TABLE ONLY pitest3
            ALTER COLUMN f3 SET NOT NULL,
            ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY (START WITH 3)
ERROR: 
-- fails, changing only the partitioned table not allowed
ALTER TABLE ONLY pitest3
            ALTER COLUMN f3 SET NOT NULL,
            ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY (START WITH 3)

Parser Error: Only one ALTER command per statement is supported

ALTER TABLE pitest3
            ALTER COLUMN f3 SET NOT NULL,
            ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY (START WITH 3)
ERROR: 
ALTER TABLE pitest3
            ALTER COLUMN f3 SET NOT NULL,
            ALTER COLUMN f3 ADD GENERATED ALWAYS AS IDENTITY (START WITH 3)

Parser Error: Only one ALTER command per statement is supported

INSERT into pitest3(f1, f2) VALUES ('2016-07-4', 'from pitest3')
ERROR: 
INSERT into pitest3(f1, f2) VALUES ('2016-07-4', 'from pitest3')

Catalog Error: Table with name pitest3 does not exist!
Did you mean "itest13"?

INSERT into pitest3_p1 (f1, f2) VALUES ('2016-07-5', 'from pitest3_p1')
ERROR: 
INSERT into pitest3_p1 (f1, f2) VALUES ('2016-07-5', 'from pitest3_p1')

Catalog Error: Table with name pitest3_p1 does not exist!
Did you mean "pitest1_p2"?

SELECT tableoid::regclass, f1, f2, f3 FROM pitest3
ERROR: 
SELECT tableoid::regclass, f1, f2, f3 FROM pitest3

Catalog Error: Table with name pitest3 does not exist!
Did you mean "itest13"?


-- changing an identity column to a non-identity column in a partitioned table
ALTER TABLE pitest3_p1 ALTER COLUMN f3 DROP IDENTITY
ERROR: 

-- changing an identity column to a non-identity column in a partitioned table
ALTER TABLE pitest3_p1 ALTER COLUMN f3 DROP IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
 -- fails
ALTER TABLE ONLY pitest3 ALTER COLUMN f3 DROP IDENTITY
ERROR:  -- fails
ALTER TABLE ONLY pitest3 ALTER COLUMN f3 DROP IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!
 -- fails
ALTER TABLE pitest3 ALTER COLUMN f3 DROP IDENTITY
ERROR:  -- fails
ALTER TABLE pitest3 ALTER COLUMN f3 DROP IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!

INSERT into pitest3(f1, f2) VALUES ('2016-07-4', 'from pitest3')
ERROR: 
INSERT into pitest3(f1, f2) VALUES ('2016-07-4', 'from pitest3')

Catalog Error: Table with name pitest3 does not exist!
Did you mean "itest13"?
 -- fails
INSERT into pitest3_p1 (f1, f2) VALUES ('2016-07-5', 'from pitest3_p1')
ERROR:  -- fails
INSERT into pitest3_p1 (f1, f2) VALUES ('2016-07-5', 'from pitest3_p1')

Catalog Error: Table with name pitest3_p1 does not exist!
Did you mean "pitest1_p2"?
 -- fails
INSERT into pitest3(f1, f2, f3) VALUES ('2016-07-6', 'from pitest3', 5)
ERROR:  -- fails
INSERT into pitest3(f1, f2, f3) VALUES ('2016-07-6', 'from pitest3', 5)

Catalog Error: Table with name pitest3 does not exist!
Did you mean "itest13"?

INSERT into pitest3_p1 (f1, f2, f3) VALUES ('2016-07-7', 'from pitest3_p1', 6)
ERROR: 
INSERT into pitest3_p1 (f1, f2, f3) VALUES ('2016-07-7', 'from pitest3_p1', 6)

Catalog Error: Table with name pitest3_p1 does not exist!
Did you mean "pitest1_p2"?

SELECT tableoid::regclass, f1, f2, f3 FROM pitest3
ERROR: 
SELECT tableoid::regclass, f1, f2, f3 FROM pitest3

Catalog Error: Table with name pitest3 does not exist!
Did you mean "itest13"?


-- Changing NOT NULL constraint of identity columns is not allowed
ALTER TABLE pitest1_p1 ALTER COLUMN f3 DROP NOT NULL
ERROR: 

-- Changing NOT NULL constraint of identity columns is not allowed
ALTER TABLE pitest1_p1 ALTER COLUMN f3 DROP NOT NULL

Catalog Error: Table with name pitest1_p1 does not exist!
Did you mean "pitest1_p2"?

ALTER TABLE pitest1 ALTER COLUMN f3 DROP NOT NULL
ERROR: 
ALTER TABLE pitest1 ALTER COLUMN f3 DROP NOT NULL

Catalog Error: Table with name pitest1 does not exist!
Did you mean "itest13"?

-- Identity columns have their own default
ALTER TABLE pitest1_p2 ALTER COLUMN f3 SET DEFAULT 10000

ALTER TABLE pitest1 ALTER COLUMN f3 SET DEFAULT 10000
ERROR: 
ALTER TABLE pitest1 ALTER COLUMN f3 SET DEFAULT 10000

Catalog Error: Table with name pitest1 does not exist!
Did you mean "itest13"?

-- Adding identity to an identity column is not allowed
ALTER TABLE pitest1_p2 ALTER COLUMN f3 ADD GENERATED BY DEFAULT AS IDENTITY
ERROR: 
-- Adding identity to an identity column is not allowed
ALTER TABLE pitest1_p2 ALTER COLUMN f3 ADD GENERATED BY DEFAULT AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE pitest1 ALTER COLUMN f3 ADD GENERATED BY DEFAULT AS IDENTITY
ERROR: 
ALTER TABLE pitest1 ALTER COLUMN f3 ADD GENERATED BY DEFAULT AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!


-- partitions with their own identity columns are not allowed, even if the
-- partitioned table does not have an identity column.
CREATE TABLE pitest1_pfail PARTITION OF pitest1 (
    f3 WITH OPTIONS GENERATED ALWAYS AS IDENTITY
) FOR VALUES FROM ('2016-11-01') TO ('2016-12-01')
ERROR: 

-- partitions with their own identity columns are not allowed, even if the
-- partitioned table does not have an identity column.
CREATE TABLE pitest1_pfail PARTITION OF pitest1 (
    f3 WITH OPTIONS GENERATED ALWAYS AS IDENTITY
) FOR VALUES FROM ('2016-11-01') TO ('2016-12-01')

Parser Error: syntax error at or near "PARTITION"


CREATE TABLE pitest_pfail PARTITION OF pitest3 (
    f3 WITH OPTIONS GENERATED ALWAYS AS IDENTITY
) FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')
ERROR: 

CREATE TABLE pitest_pfail PARTITION OF pitest3 (
    f3 WITH OPTIONS GENERATED ALWAYS AS IDENTITY
) FOR VALUES FROM ('2016-07-01') TO ('2016-08-01')

Parser Error: syntax error at or near "PARTITION"


CREATE TABLE pitest1_pfail (f1 date NOT NULL, f2 text, f3 bigint GENERATED ALWAYS AS IDENTITY)
ERROR: 

CREATE TABLE pitest1_pfail (f1 date NOT NULL, f2 text, f3 bigint GENERATED ALWAYS AS IDENTITY)

Not implemented Error: Constraint not implemented!

ALTER TABLE pitest1 ATTACH PARTITION pitest1_pfail FOR VALUES FROM ('2016-11-01') TO ('2016-12-01')
ERROR: 
ALTER TABLE pitest1 ATTACH PARTITION pitest1_pfail FOR VALUES FROM ('2016-11-01') TO ('2016-12-01')

Parser Error: syntax error at or near "ATTACH"

ALTER TABLE pitest3 ATTACH PARTITION pitest1_pfail FOR VALUES FROM ('2016-11-01') TO ('2016-12-01')
ERROR: 
ALTER TABLE pitest3 ATTACH PARTITION pitest1_pfail FOR VALUES FROM ('2016-11-01') TO ('2016-12-01')

Parser Error: syntax error at or near "ATTACH"


DROP TABLE pitest1_pfail
ERROR: 

DROP TABLE pitest1_pfail

Catalog Error: Table with name pitest1_pfail does not exist!
Did you mean "pitest1_p2"?

DROP TABLE pitest3
ERROR: 
DROP TABLE pitest3

Catalog Error: Table with name pitest3 does not exist!
Did you mean "itest13"?


-- test that sequence of half-dropped serial column is properly ignored

CREATE TABLE itest14 (id serial)
ERROR: 

-- test that sequence of half-dropped serial column is properly ignored

CREATE TABLE itest14 (id serial)

Catalog Error: Type with name serial does not exist!
Did you mean "real"?

ALTER TABLE itest14 ALTER id DROP DEFAULT
ERROR: 
ALTER TABLE itest14 ALTER id DROP DEFAULT

Catalog Error: Table with name itest14 does not exist!
Did you mean "itest4"?

ALTER TABLE itest14 ALTER id ADD GENERATED BY DEFAULT AS IDENTITY
ERROR: 
ALTER TABLE itest14 ALTER id ADD GENERATED BY DEFAULT AS IDENTITY

Not implemented Error: No support for that ALTER TABLE option yet!

INSERT INTO itest14 (id) VALUES (DEFAULT)
ERROR: 
INSERT INTO itest14 (id) VALUES (DEFAULT)

Catalog Error: Table with name itest14 does not exist!
Did you mean "itest4"?


-- Identity columns must be NOT NULL (cf bug #16913)

CREATE TABLE itest15 (id integer GENERATED ALWAYS AS IDENTITY NULL)
ERROR: 

-- Identity columns must be NOT NULL (cf bug #16913)

CREATE TABLE itest15 (id integer GENERATED ALWAYS AS IDENTITY NULL)

Not implemented Error: Constraint not implemented!
 -- fail
CREATE TABLE itest15 (id integer NULL GENERATED ALWAYS AS IDENTITY)
ERROR:  -- fail
CREATE TABLE itest15 (id integer NULL GENERATED ALWAYS AS IDENTITY)

Parser Error: syntax error at or near "GENERATED"
 -- fail
CREATE TABLE itest15 (id integer GENERATED ALWAYS AS IDENTITY NOT NULL)
ERROR:  -- fail
CREATE TABLE itest15 (id integer GENERATED ALWAYS AS IDENTITY NOT NULL)

Not implemented Error: Constraint not implemented!

DROP TABLE itest15
ERROR: 
DROP TABLE itest15

Catalog Error: Table with name itest15 does not exist!
Did you mean "itest13"?

CREATE TABLE itest15 (id integer NOT NULL GENERATED ALWAYS AS IDENTITY)
ERROR: 
CREATE TABLE itest15 (id integer NOT NULL GENERATED ALWAYS AS IDENTITY)

Parser Error: syntax error at or near "GENERATED"

DROP TABLE itest15
ERROR: 
DROP TABLE itest15

Catalog Error: Table with name itest15 does not exist!
Did you mean "itest13"?


-- MERGE tests
CREATE TABLE itest15 (a int GENERATED ALWAYS AS IDENTITY, b text)
ERROR: 

-- MERGE tests
CREATE TABLE itest15 (a int GENERATED ALWAYS AS IDENTITY, b text)

Not implemented Error: Constraint not implemented!

CREATE TABLE itest16 (a int GENERATED BY DEFAULT AS IDENTITY, b text)
ERROR: 
CREATE TABLE itest16 (a int GENERATED BY DEFAULT AS IDENTITY, b text)

Not implemented Error: Constraint not implemented!


MERGE INTO itest15 t
USING (SELECT 10 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) VALUES (s.s_a, s.s_b)
ERROR: 

MERGE INTO itest15 t
USING (SELECT 10 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) VALUES (s.s_a, s.s_b)

Parser Error: syntax error at or near "MERGE"


-- Used to fail, but now it works and ignores the user supplied value
MERGE INTO itest15 t
USING (SELECT 20 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING USER VALUE VALUES (s.s_a, s.s_b)
ERROR: 

-- Used to fail, but now it works and ignores the user supplied value
MERGE INTO itest15 t
USING (SELECT 20 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING USER VALUE VALUES (s.s_a, s.s_b)

Parser Error: syntax error at or near "MERGE"


MERGE INTO itest15 t
USING (SELECT 30 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING SYSTEM VALUE VALUES (s.s_a, s.s_b)
ERROR: 

MERGE INTO itest15 t
USING (SELECT 30 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING SYSTEM VALUE VALUES (s.s_a, s.s_b)

Parser Error: syntax error at or near "MERGE"


MERGE INTO itest16 t
USING (SELECT 10 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) VALUES (s.s_a, s.s_b)
ERROR: 

MERGE INTO itest16 t
USING (SELECT 10 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) VALUES (s.s_a, s.s_b)

Parser Error: syntax error at or near "MERGE"


MERGE INTO itest16 t
USING (SELECT 20 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING USER VALUE VALUES (s.s_a, s.s_b)
ERROR: 

MERGE INTO itest16 t
USING (SELECT 20 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING USER VALUE VALUES (s.s_a, s.s_b)

Parser Error: syntax error at or near "MERGE"


MERGE INTO itest16 t
USING (SELECT 30 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING SYSTEM VALUE VALUES (s.s_a, s.s_b)
ERROR: 

MERGE INTO itest16 t
USING (SELECT 30 AS s_a, 'inserted by merge' AS s_b) s
ON t.a = s.s_a
WHEN NOT MATCHED THEN
	INSERT (a, b) OVERRIDING SYSTEM VALUE VALUES (s.s_a, s.s_b)

Parser Error: syntax error at or near "MERGE"


SELECT * FROM itest15
ERROR: 

SELECT * FROM itest15

Catalog Error: Table with name itest15 does not exist!
Did you mean "itest13"?

SELECT * FROM itest16
ERROR: 
SELECT * FROM itest16

Catalog Error: Table with name itest16 does not exist!
Did you mean "itest13"?

DROP TABLE itest15
ERROR: 
DROP TABLE itest15

Catalog Error: Table with name itest15 does not exist!
Did you mean "itest13"?

DROP TABLE itest16
ERROR: 
DROP TABLE itest16

Catalog Error: Table with name itest16 does not exist!
Did you mean "itest13"?


