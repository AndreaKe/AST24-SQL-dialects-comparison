--
-- Verify system catalog foreign key relationships
--
DO $doblock$
declare
  fk record
ERROR: --
-- Verify system catalog foreign key relationships
--
DO $doblock$
declare
  fk record

Parser Error: syntax error at or near "DO"

  nkeys integer
ERROR: 
  nkeys integer

Parser Error: syntax error at or near "nkeys"

  cmd text
ERROR: 
  cmd text

Parser Error: syntax error at or near "cmd"

  err record
ERROR: 
  err record

Parser Error: syntax error at or near "err"

begin
  for fk in select * from pg_get_catalog_foreign_keys()
  loop
    raise notice 'checking % % => % %',
      fk.fktable, fk.fkcols, fk.pktable, fk.pkcols
ERROR: 
begin
  for fk in select * from pg_get_catalog_foreign_keys()
  loop
    raise notice 'checking % % => % %',
      fk.fktable, fk.fkcols, fk.pktable, fk.pkcols

Parser Error: syntax error at or near "for"

    nkeys := array_length(fk.fkcols, 1)
ERROR: 
    nkeys := array_length(fk.fkcols, 1)

Parser Error: syntax error at or near "nkeys"

    cmd := 'SELECT ctid'
ERROR: 
    cmd := 'SELECT ctid'

Parser Error: syntax error at or near "cmd"

    for i in 1 .. nkeys loop
      cmd := cmd || ', ' || quote_ident(fk.fkcols[i])
ERROR: 
    for i in 1 .. nkeys loop
      cmd := cmd || ', ' || quote_ident(fk.fkcols[i])

Parser Error: syntax error at or near "for"

    end loop
ERROR: 
    end loop

Parser Error: syntax error at or near "loop"

    if fk.is_array then
      cmd := cmd || ' FROM (SELECT ctid'
ERROR: 
    if fk.is_array then
      cmd := cmd || ' FROM (SELECT ctid'

Parser Error: syntax error at or near "if"

      for i in 1 .. nkeys-1 loop
        cmd := cmd || ', ' || quote_ident(fk.fkcols[i])
ERROR: 
      for i in 1 .. nkeys-1 loop
        cmd := cmd || ', ' || quote_ident(fk.fkcols[i])

Parser Error: syntax error at or near "for"

      end loop
ERROR: 
      end loop

Parser Error: syntax error at or near "loop"

      cmd := cmd || ', unnest(' || quote_ident(fk.fkcols[nkeys])
ERROR: 
      cmd := cmd || ', unnest(' || quote_ident(fk.fkcols[nkeys])

Parser Error: syntax error at or near "cmd"

      cmd := cmd || ') as ' || quote_ident(fk.fkcols[nkeys])
ERROR: 
      cmd := cmd || ') as ' || quote_ident(fk.fkcols[nkeys])

Parser Error: syntax error at or near "cmd"

      cmd := cmd || ' FROM ' || fk.fktable::text || ') fk WHERE '
ERROR: 
      cmd := cmd || ' FROM ' || fk.fktable::text || ') fk WHERE '

Parser Error: syntax error at or near "cmd"

    else
      cmd := cmd || ' FROM ' || fk.fktable::text || ' fk WHERE '
ERROR: 
    else
      cmd := cmd || ' FROM ' || fk.fktable::text || ' fk WHERE '

Parser Error: syntax error at or near "else"

    end if
ERROR: 
    end if

Parser Error: syntax error at or near "if"

    if fk.is_opt then
      for i in 1 .. nkeys loop
        cmd := cmd || quote_ident(fk.fkcols[i]) || ' != 0 AND '
ERROR: 
    if fk.is_opt then
      for i in 1 .. nkeys loop
        cmd := cmd || quote_ident(fk.fkcols[i]) || ' != 0 AND '

Parser Error: syntax error at or near "if"

      end loop
ERROR: 
      end loop

Parser Error: syntax error at or near "loop"

    end if
ERROR: 
    end if

Parser Error: syntax error at or near "if"

    cmd := cmd || 'NOT EXISTS(SELECT 1 FROM ' || fk.pktable::text || ' pk WHERE '
ERROR: 
    cmd := cmd || 'NOT EXISTS(SELECT 1 FROM ' || fk.pktable::text || ' pk WHERE '

Parser Error: syntax error at or near "cmd"

    for i in 1 .. nkeys loop
      if i > 1 then cmd := cmd || ' AND '
ERROR: 
    for i in 1 .. nkeys loop
      if i > 1 then cmd := cmd || ' AND '

Parser Error: syntax error at or near "for"
 end if
ERROR:  end if

Parser Error: syntax error at or near "if"

      cmd := cmd || 'pk.' || quote_ident(fk.pkcols[i])
ERROR: 
      cmd := cmd || 'pk.' || quote_ident(fk.pkcols[i])

Parser Error: syntax error at or near "cmd"

      cmd := cmd || ' = fk.' || quote_ident(fk.fkcols[i])
ERROR: 
      cmd := cmd || ' = fk.' || quote_ident(fk.fkcols[i])

Parser Error: syntax error at or near "cmd"

    end loop
ERROR: 
    end loop

Parser Error: syntax error at or near "loop"

    cmd := cmd || ')'
ERROR: 
    cmd := cmd || ')'

Parser Error: syntax error at or near "cmd"

    -- raise notice ''cmd = %'', cmd /* REPLACED */,
    for err in execute cmd loop
      raise warning 'FK VIOLATION IN %(%): %', fk.fktable, fk.fkcols, err
ERROR: 
    -- raise notice ''cmd = %'', cmd /* REPLACED */,
    for err in execute cmd loop
      raise warning 'FK VIOLATION IN %(%): %', fk.fktable, fk.fkcols, err

Parser Error: syntax error at or near "for"

    end loop
ERROR: 
    end loop

Parser Error: syntax error at or near "loop"

  end loop
ERROR: 
  end loop

Parser Error: syntax error at or near "loop"

end
$doblock$
ERROR: 
end
$doblock$

Parser Error: unterminated dollar-quoted string at or near "$doblock$
"


