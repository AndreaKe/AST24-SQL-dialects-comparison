
-----------
QUERY:
--
-- RULES
-- From Jan/* REPLACED */''s original setup_ruletest.sql and run_ruletest.sql
-- - thomas 1998-09-13
--

--
-- Tables and rules for the view test
--
create table rtest_t1 (a int4, b int4);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_t2 (a int4, b int4);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_t3 (a int4, b int4);
RESULT:
	mySQL: []

-----------
QUERY:


create view rtest_v1 as select * from rtest_t1;
RESULT:
	mySQL: []

-----------
QUERY:

create rule rtest_v1_ins as on insert to rtest_v1 do instead
	insert into rtest_t1 values (new.a, new.b);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_v1_ins as on insert to rtest_v1 do instead\n\tinsert into rtest_t1 valu' at line 1")

-----------
QUERY:

create rule rtest_v1_upd as on update to rtest_v1 do instead
	update rtest_t1 set a = new.a, b = new.b
	where a = old.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_v1_upd as on update to rtest_v1 do instead\n\tupdate rtest_t1 set a = n' at line 1")

-----------
QUERY:

create rule rtest_v1_del as on delete to rtest_v1 do instead
	delete from rtest_t1 where a = old.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_v1_del as on delete to rtest_v1 do instead\n\tdelete from rtest_t1 wher' at line 1")

-----------
QUERY:

-- Test comments
COMMENT ON RULE rtest_v1_bad ON rtest_v1 IS 'bad rule';
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'COMMENT ON RULE rtest_v1_bad ON rtest_v1 IS 'bad rule'' at line 2")

-----------
QUERY:

COMMENT ON RULE rtest_v1_del ON rtest_v1 IS 'delete rule';
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'COMMENT ON RULE rtest_v1_del ON rtest_v1 IS 'delete rule'' at line 1")

-----------
QUERY:

COMMENT ON RULE rtest_v1_del ON rtest_v1 IS NULL;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'COMMENT ON RULE rtest_v1_del ON rtest_v1 IS NULL' at line 1")

-----------
QUERY:

--
-- Tables and rules for the constraint update/delete test
--
-- Note:
-- 	Now that we have multiple action rule support, we check
-- 	both possible syntaxes to define them (The last action
--  can but must not have a semicolon at the end).
--
create table rtest_system (sysname text, sysdesc text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_interface (sysname text, ifname text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_person (pname text, pdesc text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_admin (pname text, sysname text);
RESULT:
	mySQL: []

-----------
QUERY:


create rule rtest_sys_upd as on update to rtest_system do also (
	update rtest_interface set sysname = new.sysname
		where sysname = old.sysname;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_sys_upd as on update to rtest_system do also (\n\tupdate rtest_interfac' at line 1")

-----------
QUERY:

	update rtest_admin set sysname = new.sysname
		where sysname = old.sysname
	);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')' at line 3")

-----------
QUERY:


create rule rtest_sys_del as on delete to rtest_system do also (
	delete from rtest_interface where sysname = old.sysname;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_sys_del as on delete to rtest_system do also (\n\tdelete from rtest_int' at line 1")

-----------
QUERY:

	delete from rtest_admin where sysname = old.sysname;
RESULT:
	mySQL: ERROR - (1054, "Unknown column 'old.sysname' in 'where clause'")

-----------
QUERY:

	);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')' at line 1")

-----------
QUERY:


create rule rtest_pers_upd as on update to rtest_person do also
	update rtest_admin set pname = new.pname where pname = old.pname;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_pers_upd as on update to rtest_person do also\n\tupdate rtest_admin set' at line 1")

-----------
QUERY:


create rule rtest_pers_del as on delete to rtest_person do also
	delete from rtest_admin where pname = old.pname;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_pers_del as on delete to rtest_person do also\n\tdelete from rtest_admi' at line 1")

-----------
QUERY:


--
-- Tables and rules for the logging test
--
create table rtest_emp (ename char(20), salary numeric);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_emplog (ename char(20), who name, action char(10), newsal numeric, oldsal numeric);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'name, action char(10), newsal numeric, oldsal numeric)' at line 1")

-----------
QUERY:

create table rtest_empmass (ename char(20), salary numeric);
RESULT:
	mySQL: []

-----------
QUERY:


create rule rtest_emp_ins as on insert to rtest_emp do
	insert into rtest_emplog values (new.ename, current_user,
			'hired', new.salary, '0.00');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_emp_ins as on insert to rtest_emp do\n\tinsert into rtest_emplog values' at line 1")

-----------
QUERY:


create rule rtest_emp_upd as on update to rtest_emp where new.salary != old.salary do
	insert into rtest_emplog values (new.ename, current_user,
			'honored', new.salary, old.salary);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_emp_upd as on update to rtest_emp where new.salary != old.salary do\n\t' at line 1")

-----------
QUERY:


create rule rtest_emp_del as on delete to rtest_emp do
	insert into rtest_emplog values (old.ename, current_user,
			'fired', '0.00', old.salary);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_emp_del as on delete to rtest_emp do\n\tinsert into rtest_emplog values' at line 1")

-----------
QUERY:


--
-- Tables and rules for the multiple cascaded qualified instead
-- rule test
--
create table rtest_t4 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_t5 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_t6 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_t7 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_t8 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_t9 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:


create rule rtest_t4_ins1 as on insert to rtest_t4
		where new.a >= 10 and new.a < 20 do instead
	insert into rtest_t5 values (new.a, new.b);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_t4_ins1 as on insert to rtest_t4\n\t\twhere new.a >= 10 and new.a < 20 d' at line 1")

-----------
QUERY:


create rule rtest_t4_ins2 as on insert to rtest_t4
		where new.a >= 20 and new.a < 30 do
	insert into rtest_t6 values (new.a, new.b);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_t4_ins2 as on insert to rtest_t4\n\t\twhere new.a >= 20 and new.a < 30 d' at line 1")

-----------
QUERY:


create rule rtest_t5_ins as on insert to rtest_t5
		where new.a > 15 do
	insert into rtest_t7 values (new.a, new.b);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_t5_ins as on insert to rtest_t5\n\t\twhere new.a > 15 do\n\tinsert into rt' at line 1")

-----------
QUERY:


create rule rtest_t6_ins as on insert to rtest_t6
		where new.a > 25 do instead
	insert into rtest_t8 values (new.a, new.b);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_t6_ins as on insert to rtest_t6\n\t\twhere new.a > 25 do instead\n\tinsert' at line 1")

-----------
QUERY:


--
-- Tables and rules for the rule fire order test
--
-- As of PG 7.3, the rules should fire in order by name, regardless
-- of INSTEAD attributes or creation order.
--
create table rtest_order1 (a int4);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_order2 (a int4, b int4, c text);
RESULT:
	mySQL: []

-----------
QUERY:


create sequence rtest_seq;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'sequence rtest_seq' at line 1")

-----------
QUERY:


create rule rtest_order_r3 as on insert to rtest_order1 do instead
	insert into rtest_order2 values (new.a, nextval('rtest_seq'),
		'rule 3 - this should run 3rd');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_order_r3 as on insert to rtest_order1 do instead\n\tinsert into rtest_o' at line 1")

-----------
QUERY:


create rule rtest_order_r4 as on insert to rtest_order1
		where a < 100 do instead
	insert into rtest_order2 values (new.a, nextval('rtest_seq'),
		'rule 4 - this should run 4th');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_order_r4 as on insert to rtest_order1\n\t\twhere a < 100 do instead\n\tins' at line 1")

-----------
QUERY:


create rule rtest_order_r2 as on insert to rtest_order1 do
	insert into rtest_order2 values (new.a, nextval('rtest_seq'),
		'rule 2 - this should run 2nd');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_order_r2 as on insert to rtest_order1 do\n\tinsert into rtest_order2 va' at line 1")

-----------
QUERY:


create rule rtest_order_r1 as on insert to rtest_order1 do instead
	insert into rtest_order2 values (new.a, nextval('rtest_seq'),
		'rule 1 - this should run 1st');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_order_r1 as on insert to rtest_order1 do instead\n\tinsert into rtest_o' at line 1")

-----------
QUERY:


--
-- Tables and rules for the instead nothing test
--
create table rtest_nothn1 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_nothn2 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_nothn3 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_nothn4 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:


create rule rtest_nothn_r1 as on insert to rtest_nothn1
	where new.a >= 10 and new.a < 20 do instead nothing;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_nothn_r1 as on insert to rtest_nothn1\n\twhere new.a >= 10 and new.a < ' at line 1")

-----------
QUERY:


create rule rtest_nothn_r2 as on insert to rtest_nothn1
	where new.a >= 30 and new.a < 40 do instead nothing;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_nothn_r2 as on insert to rtest_nothn1\n\twhere new.a >= 30 and new.a < ' at line 1")

-----------
QUERY:


create rule rtest_nothn_r3 as on insert to rtest_nothn2
	where new.a >= 100 do instead
	insert into rtest_nothn3 values (new.a, new.b);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_nothn_r3 as on insert to rtest_nothn2\n\twhere new.a >= 100 do instead\n' at line 1")

-----------
QUERY:


create rule rtest_nothn_r4 as on insert to rtest_nothn2
	do instead nothing;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rtest_nothn_r4 as on insert to rtest_nothn2\n\tdo instead nothing' at line 1")

-----------
QUERY:


--
-- Tests on a view that is select * of a table
-- and has insert/update/delete instead rules to
-- behave close like the real table.
--

--
-- We need test date later
--
insert into rtest_t2 values (1, 21);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t2 values (2, 22);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t2 values (3, 23);
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_t3 values (1, 31);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t3 values (2, 32);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t3 values (3, 33);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t3 values (4, 34);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t3 values (5, 35);
RESULT:
	mySQL: []

-----------
QUERY:


-- insert values
insert into rtest_v1 values (1, 11);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_v1 values (2, 12);
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 11), (2, 12))

-----------
QUERY:


-- delete with constant expression
delete from rtest_v1 where a = 1;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((2, 12),)

-----------
QUERY:

insert into rtest_v1 values (1, 11);
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_v1 where b = 12;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 11),)

-----------
QUERY:

insert into rtest_v1 values (2, 12);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_v1 values (2, 13);
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 11), (2, 12), (2, 13))

-----------
QUERY:

** Remember the delete rule on rtest_v1: It says
** DO INSTEAD DELETE FROM rtest_t1 WHERE a = old.a
** So this time both rows with a = 2 must get deleted
\p
\r
delete from rtest_v1 where b = 12;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '** Remember the delete rule on rtest_v1: It says\n** DO INSTEAD DELETE FROM rtest' at line 1")

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 11), (2, 12), (2, 13))

-----------
QUERY:

delete from rtest_v1;
RESULT:
	mySQL: []

-----------
QUERY:


-- insert select
insert into rtest_v1 select * from rtest_t2;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 21), (2, 22), (3, 23))

-----------
QUERY:

delete from rtest_v1;
RESULT:
	mySQL: []

-----------
QUERY:


-- same with swapped targetlist
insert into rtest_v1 (b, a) select b, a from rtest_t2;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 21), (2, 22), (3, 23))

-----------
QUERY:


-- now with only one target attribute
insert into rtest_v1 (a) select a from rtest_t3;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 21), (2, 22), (3, 23), (1, None), (2, None), (3, None), (4, None), (5, None))

-----------
QUERY:

select * from rtest_v1 where b isnull;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'isnull' at line 1")

-----------
QUERY:


-- let attribute a differ (must be done on rtest_t1 - see above)
update rtest_t1 set a = a + 10 where b isnull;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'isnull' at line 2")

-----------
QUERY:

delete from rtest_v1 where b isnull;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'isnull' at line 1")

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 21), (2, 22), (3, 23), (1, None), (2, None), (3, None), (4, None), (5, None))

-----------
QUERY:


-- now updates with constant expression
update rtest_v1 set b = 42 where a = 2;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 21), (2, 42), (3, 23), (1, None), (2, 42), (3, None), (4, None), (5, None))

-----------
QUERY:

update rtest_v1 set b = 99 where b = 42;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 21), (2, 99), (3, 23), (1, None), (2, 99), (3, None), (4, None), (5, None))

-----------
QUERY:

update rtest_v1 set b = 88 where b < 50;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 88), (2, 99), (3, 88), (1, None), (2, 99), (3, None), (4, None), (5, None))

-----------
QUERY:

delete from rtest_v1;
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_v1 select rtest_t2.a, rtest_t3.b
    from rtest_t2, rtest_t3
    where rtest_t2.a = rtest_t3.a;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 31), (2, 32), (3, 33))

-----------
QUERY:


-- updates in a mergejoin
update rtest_v1 set b = rtest_t2.b from rtest_t2 where rtest_v1.a = rtest_t2.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from rtest_t2 where rtest_v1.a = rtest_t2.a' at line 2")

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 31), (2, 32), (3, 33))

-----------
QUERY:

insert into rtest_v1 select * from rtest_t3;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((1, 31), (2, 32), (3, 33), (1, 31), (2, 32), (3, 33), (4, 34), (5, 35))

-----------
QUERY:

update rtest_t1 set a = a + 10 where b > 30;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((11, 31), (12, 32), (13, 33), (11, 31), (12, 32), (13, 33), (14, 34), (15, 35))

-----------
QUERY:

update rtest_v1 set a = rtest_t3.a + 20 from rtest_t3 where rtest_v1.b = rtest_t3.b;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from rtest_t3 where rtest_v1.b = rtest_t3.b' at line 1")

-----------
QUERY:

select * from rtest_v1;
RESULT:
	mySQL: ((11, 31), (12, 32), (13, 33), (11, 31), (12, 32), (13, 33), (14, 34), (15, 35))

-----------
QUERY:


--
-- Test for constraint updates/deletes
--
insert into rtest_system values ('orion', 'Linux Jan Wieck');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_system values ('notjw', 'WinNT Jan Wieck (notebook)');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_system values ('neptun', 'Fileserver');
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_interface values ('orion', 'eth0');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_interface values ('orion', 'eth1');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_interface values ('notjw', 'eth0');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_interface values ('neptun', 'eth0');
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_person values ('jw', 'Jan Wieck');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_person values ('bm', 'Bruce Momjian');
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_admin values ('jw', 'orion');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_admin values ('jw', 'notjw');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_admin values ('bm', 'neptun');
RESULT:
	mySQL: []

-----------
QUERY:


update rtest_system set sysname = 'pluto' where sysname = 'neptun';
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_interface;
RESULT:
	mySQL: (('orion', 'eth0'), ('orion', 'eth1'), ('notjw', 'eth0'), ('neptun', 'eth0'))

-----------
QUERY:

select * from rtest_admin;
RESULT:
	mySQL: (('jw', 'orion'), ('jw', 'notjw'), ('bm', 'neptun'))

-----------
QUERY:


update rtest_person set pname = 'jwieck' where pdesc = 'Jan Wieck';
RESULT:
	mySQL: []

-----------
QUERY:


-- Note: use ORDER BY here to ensure consistent output across all systems.
-- The above UPDATE affects two rows with equal keys, so they could be
-- updated in either order depending on the whim of the local qsort().

select * from rtest_admin order by pname, sysname;
RESULT:
	mySQL: (('bm', 'neptun'), ('jw', 'notjw'), ('jw', 'orion'))

-----------
QUERY:


delete from rtest_system where sysname = 'orion';
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_interface;
RESULT:
	mySQL: (('orion', 'eth0'), ('orion', 'eth1'), ('notjw', 'eth0'), ('neptun', 'eth0'))

-----------
QUERY:

select * from rtest_admin;
RESULT:
	mySQL: (('jw', 'orion'), ('jw', 'notjw'), ('bm', 'neptun'))

-----------
QUERY:


--
-- Rule qualification test
--
insert into rtest_emp values ('wiecc', '5000.00');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_emp values ('gates', '80000.00');
RESULT:
	mySQL: []

-----------
QUERY:

update rtest_emp set ename = 'wiecx' where ename = 'wiecc';
RESULT:
	mySQL: []

-----------
QUERY:

update rtest_emp set ename = 'wieck', salary = '6000.00' where ename = 'wiecx';
RESULT:
	mySQL: []

-----------
QUERY:

update rtest_emp set salary = '7000.00' where ename = 'wieck';
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_emp where ename = 'gates';
RESULT:
	mySQL: []

-----------
QUERY:


select ename, who = current_user as "matches user", action, newsal, oldsal from rtest_emplog order by ename, action, newsal;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.rtest_emplog' doesn't exist")

-----------
QUERY:

insert into rtest_empmass values ('meyer', '4000.00');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_empmass values ('maier', '5000.00');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_empmass values ('mayr', '6000.00');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_emp select * from rtest_empmass;
RESULT:
	mySQL: []

-----------
QUERY:

select ename, who = current_user as "matches user", action, newsal, oldsal from rtest_emplog order by ename, action, newsal;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.rtest_emplog' doesn't exist")

-----------
QUERY:

update rtest_empmass set salary = salary + '1000.00';
RESULT:
	mySQL: []

-----------
QUERY:

update rtest_emp set salary = rtest_empmass.salary from rtest_empmass where rtest_emp.ename = rtest_empmass.ename;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'from rtest_empmass where rtest_emp.ename = rtest_empmass.ename' at line 1")

-----------
QUERY:

select ename, who = current_user as "matches user", action, newsal, oldsal from rtest_emplog order by ename, action, newsal;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.rtest_emplog' doesn't exist")

-----------
QUERY:

delete from rtest_emp using rtest_empmass where rtest_emp.ename = rtest_empmass.ename;
RESULT:
	mySQL: ERROR - (1109, "Unknown table 'rtest_emp' in MULTI DELETE")

-----------
QUERY:

select ename, who = current_user as "matches user", action, newsal, oldsal from rtest_emplog order by ename, action, newsal;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.rtest_emplog' doesn't exist")

-----------
QUERY:


--
-- Multiple cascaded qualified instead rule test
--
insert into rtest_t4 values (1, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (2, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (10, 'Record should go to rtest_t5');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (15, 'Record should go to rtest_t5');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (19, 'Record should go to rtest_t5 and t7');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (20, 'Record should go to rtest_t4 and t6');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (26, 'Record should go to rtest_t4 and t8');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (28, 'Record should go to rtest_t4 and t8');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (30, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t4 values (40, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_t4;
RESULT:
	mySQL: ((1, 'Record should go to rtest_t4'), (2, 'Record should go to rtest_t4'), (10, 'Record should go to rtest_t5'), (15, 'Record should go to rtest_t5'), (19, 'Record should go to rtest_t5 and t7'), (20, 'Record should go to rtest_t4 and t6'), (26, 'Record should go to rtest_t4 and t8'), (28, 'Record should go to rtest_t4 and t8'), (30, 'Record should go to rtest_t4'), (40, 'Record should go to rtest_t4'))

-----------
QUERY:

select * from rtest_t5;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t6;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t7;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t8;
RESULT:
	mySQL: ()

-----------
QUERY:


delete from rtest_t4;
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_t5;
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_t6;
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_t7;
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_t8;
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_t9 values (1, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (2, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (10, 'Record should go to rtest_t5');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (15, 'Record should go to rtest_t5');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (19, 'Record should go to rtest_t5 and t7');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (20, 'Record should go to rtest_t4 and t6');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (26, 'Record should go to rtest_t4 and t8');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (28, 'Record should go to rtest_t4 and t8');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (30, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_t9 values (40, 'Record should go to rtest_t4');
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_t4 select * from rtest_t9 where a < 20;
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_t4;
RESULT:
	mySQL: ((1, 'Record should go to rtest_t4'), (2, 'Record should go to rtest_t4'), (10, 'Record should go to rtest_t5'), (15, 'Record should go to rtest_t5'), (19, 'Record should go to rtest_t5 and t7'))

-----------
QUERY:

select * from rtest_t5;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t6;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t7;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t8;
RESULT:
	mySQL: ()

-----------
QUERY:


insert into rtest_t4 select * from rtest_t9 where b ~ 'and t8';
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '~ 'and t8'' at line 1")

-----------
QUERY:


select * from rtest_t4;
RESULT:
	mySQL: ((1, 'Record should go to rtest_t4'), (2, 'Record should go to rtest_t4'), (10, 'Record should go to rtest_t5'), (15, 'Record should go to rtest_t5'), (19, 'Record should go to rtest_t5 and t7'))

-----------
QUERY:

select * from rtest_t5;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t6;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t7;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t8;
RESULT:
	mySQL: ()

-----------
QUERY:


insert into rtest_t4 select a + 1, b from rtest_t9 where a in (20, 30, 40);
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_t4;
RESULT:
	mySQL: ((1, 'Record should go to rtest_t4'), (2, 'Record should go to rtest_t4'), (10, 'Record should go to rtest_t5'), (15, 'Record should go to rtest_t5'), (19, 'Record should go to rtest_t5 and t7'), (21, 'Record should go to rtest_t4 and t6'), (31, 'Record should go to rtest_t4'), (41, 'Record should go to rtest_t4'))

-----------
QUERY:

select * from rtest_t5;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t6;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t7;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_t8;
RESULT:
	mySQL: ()

-----------
QUERY:


--
-- Check that the ordering of rules fired is correct
--
insert into rtest_order1 values (1);
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_order2;
RESULT:
	mySQL: ()

-----------
QUERY:


--
-- Check if instead nothing w/without qualification works
--
insert into rtest_nothn1 values (1, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (2, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (10, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (19, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (20, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (29, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (30, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (39, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (40, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (50, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn1 values (60, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_nothn1;
RESULT:
	mySQL: ((1, 'want this'), (2, 'want this'), (10, "don't want this"), (19, "don't want this"), (20, 'want this'), (29, 'want this'), (30, "don't want this"), (39, "don't want this"), (40, 'want this'), (50, 'want this'), (60, 'want this'))

-----------
QUERY:


insert into rtest_nothn2 values (10, 'too small');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn2 values (50, 'too small');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn2 values (100, 'OK');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn2 values (200, 'OK');
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_nothn2;
RESULT:
	mySQL: ((10, 'too small'), (50, 'too small'), (100, 'OK'), (200, 'OK'))

-----------
QUERY:

select * from rtest_nothn3;
RESULT:
	mySQL: ()

-----------
QUERY:


delete from rtest_nothn1;
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_nothn2;
RESULT:
	mySQL: []

-----------
QUERY:

delete from rtest_nothn3;
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_nothn4 values (1, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (2, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (10, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (19, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (20, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (29, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (30, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (39, 'don''t want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (40, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (50, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (60, 'want this');
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_nothn1 select * from rtest_nothn4;
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_nothn1;
RESULT:
	mySQL: ((1, 'want this'), (2, 'want this'), (10, "don't want this"), (19, "don't want this"), (20, 'want this'), (29, 'want this'), (30, "don't want this"), (39, "don't want this"), (40, 'want this'), (50, 'want this'), (60, 'want this'))

-----------
QUERY:


delete from rtest_nothn4;
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_nothn4 values (10, 'too small');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (50, 'too small');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (100, 'OK');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_nothn4 values (200, 'OK');
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_nothn2 select * from rtest_nothn4;
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_nothn2;
RESULT:
	mySQL: ((10, 'too small'), (50, 'too small'), (100, 'OK'), (200, 'OK'))

-----------
QUERY:

select * from rtest_nothn3;
RESULT:
	mySQL: ()

-----------
QUERY:


create table rtest_view1 (a int4, b text, v bool);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_view2 (a int4);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_view3 (a int4, b text);
RESULT:
	mySQL: []

-----------
QUERY:

create table rtest_view4 (a int4, b text, c int4);
RESULT:
	mySQL: []

-----------
QUERY:

create view rtest_vview1 as select a, b from rtest_view1 X
	where 0 < (select count(*) from rtest_view2 Y where Y.a = X.a);
RESULT:
	mySQL: []

-----------
QUERY:

create view rtest_vview2 as select a, b from rtest_view1 where v;
RESULT:
	mySQL: []

-----------
QUERY:

create view rtest_vview3 as select a, b from rtest_vview2 X
	where 0 < (select count(*) from rtest_view2 Y where Y.a = X.a);
RESULT:
	mySQL: []

-----------
QUERY:

create view rtest_vview4 as select X.a, X.b, count(Y.a) as refcount
	from rtest_view1 X, rtest_view2 Y
	where X.a = Y.a
	group by X.a, X.b;
RESULT:
	mySQL: []

-----------
QUERY:

create function rtest_viewfunc1(int4) returns int4 as
	'select count(*)::int4 from rtest_view2 where a = $1'
	language sql;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'int4) returns int4 as\n\t'select count(*)::int4 from rtest_view2 where a = $1'\n\tla' at line 1")

-----------
QUERY:

create view rtest_vview5 as select a, b, rtest_viewfunc1(a) as refcount
	from rtest_view1;
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.rtest_viewfunc1 does not exist')

-----------
QUERY:


insert into rtest_view1 values (1, 'item 1', 't');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 't' for column 'v' at row 1")

-----------
QUERY:

insert into rtest_view1 values (2, 'item 2', 't');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 't' for column 'v' at row 1")

-----------
QUERY:

insert into rtest_view1 values (3, 'item 3', 't');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 't' for column 'v' at row 1")

-----------
QUERY:

insert into rtest_view1 values (4, 'item 4', 'f');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 'f' for column 'v' at row 1")

-----------
QUERY:

insert into rtest_view1 values (5, 'item 5', 't');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 't' for column 'v' at row 1")

-----------
QUERY:

insert into rtest_view1 values (6, 'item 6', 'f');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 'f' for column 'v' at row 1")

-----------
QUERY:

insert into rtest_view1 values (7, 'item 7', 't');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 't' for column 'v' at row 1")

-----------
QUERY:

insert into rtest_view1 values (8, 'item 8', 't');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 't' for column 'v' at row 1")

-----------
QUERY:


insert into rtest_view2 values (2);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_view2 values (2);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_view2 values (4);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_view2 values (5);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_view2 values (7);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_view2 values (7);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_view2 values (7);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_view2 values (7);
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_vview1;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_vview2;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_vview3;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_vview4 order by a, b;
RESULT:
	mySQL: ()

-----------
QUERY:

select * from rtest_vview5;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.rtest_vview5' doesn't exist")

-----------
QUERY:


insert into rtest_view3 select * from rtest_vview1 where a < 7;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_view3;
RESULT:
	mySQL: ()

-----------
QUERY:

delete from rtest_view3;
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_view3 select * from rtest_vview2 where a != 5 and b !~ '2';
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '!~ '2'' at line 1")

-----------
QUERY:

select * from rtest_view3;
RESULT:
	mySQL: ()

-----------
QUERY:

delete from rtest_view3;
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_view3 select * from rtest_vview3;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_view3;
RESULT:
	mySQL: ()

-----------
QUERY:

delete from rtest_view3;
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_view4 select * from rtest_vview4 where 3 > refcount;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rtest_view4 order by a, b;
RESULT:
	mySQL: ()

-----------
QUERY:

delete from rtest_view4;
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_view4 select * from rtest_vview5 where a > 2 and refcount = 0;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.rtest_vview5' doesn't exist")

-----------
QUERY:

select * from rtest_view4;
RESULT:
	mySQL: ()

-----------
QUERY:

delete from rtest_view4;
RESULT:
	mySQL: []

-----------
QUERY:

--
-- Test for computations in views
--
create table rtest_comp (
	part	text,
	unit	char(4),
	size	float
);
RESULT:
	mySQL: []

-----------
QUERY:



create table rtest_unitfact (
	unit	char(4),
	factor	float
);
RESULT:
	mySQL: []

-----------
QUERY:


create view rtest_vcomp as
	select X.part, (X.size * Y.factor) as size_in_cm
			from rtest_comp X, rtest_unitfact Y
			where X.unit = Y.unit;
RESULT:
	mySQL: []

-----------
QUERY:



insert into rtest_unitfact values ('m', 100.0);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_unitfact values ('cm', 1.0);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_unitfact values ('inch', 2.54);
RESULT:
	mySQL: []

-----------
QUERY:


insert into rtest_comp values ('p1', 'm', 5.0);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_comp values ('p2', 'm', 3.0);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_comp values ('p3', 'cm', 5.0);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_comp values ('p4', 'cm', 15.0);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_comp values ('p5', 'inch', 7.0);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rtest_comp values ('p6', 'inch', 4.4);
RESULT:
	mySQL: []

-----------
QUERY:


select * from rtest_vcomp order by part;
RESULT:
	mySQL: (('p1', 500.0), ('p2', 300.0), ('p3', 5.0), ('p4', 15.0), ('p5', 17.77999973297119), ('p6', 11.176000074386593))

-----------
QUERY:


select * from rtest_vcomp where size_in_cm > 10.0 order by size_in_cm using >;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'using >' at line 1")

-----------
QUERY:


--
-- In addition run the (slightly modified) queries from the
-- programmers manual section on the rule system.
--
CREATE TABLE shoe_data (
	shoename   char(10),      -- primary key
	sh_avail   integer,       -- available # of pairs
	slcolor    char(10),      -- preferred shoelace color
	slminlen   float,         -- minimum shoelace length
	slmaxlen   float,         -- maximum shoelace length
	slunit     char(8)        -- length unit
);
RESULT:
	mySQL: []

-----------
QUERY:


CREATE TABLE shoelace_data (
	sl_name    char(10),      -- primary key
	sl_avail   integer,       -- available # of pairs
	sl_color   char(10),      -- shoelace color
	sl_len     float,         -- shoelace length
	sl_unit    char(8)        -- length unit
);
RESULT:
	mySQL: []

-----------
QUERY:


CREATE TABLE unit (
	un_name    char(8),       -- the primary key
	un_fact    float          -- factor to transform to cm
);
RESULT:
	mySQL: []

-----------
QUERY:


CREATE VIEW shoe AS
	SELECT sh.shoename,
		   sh.sh_avail,
		   sh.slcolor,
		   sh.slminlen,
		   sh.slminlen * un.un_fact AS slminlen_cm,
		   sh.slmaxlen,
		   sh.slmaxlen * un.un_fact AS slmaxlen_cm,
		   sh.slunit
	  FROM shoe_data sh, unit un
	 WHERE sh.slunit = un.un_name;
RESULT:
	mySQL: []

-----------
QUERY:


CREATE VIEW shoelace AS
	SELECT s.sl_name,
		   s.sl_avail,
		   s.sl_color,
		   s.sl_len,
		   s.sl_unit,
		   s.sl_len * u.un_fact AS sl_len_cm
	  FROM shoelace_data s, unit u
	 WHERE s.sl_unit = u.un_name;
RESULT:
	mySQL: []

-----------
QUERY:


CREATE VIEW shoe_ready AS
	SELECT rsh.shoename,
		   rsh.sh_avail,
		   rsl.sl_name,
		   rsl.sl_avail,
		   int4smaller(rsh.sh_avail, rsl.sl_avail) AS total_avail
	  FROM shoe rsh, shoelace rsl
	 WHERE rsl.sl_color = rsh.slcolor
	   AND rsl.sl_len_cm >= rsh.slminlen_cm
	   AND rsl.sl_len_cm <= rsh.slmaxlen_cm;
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.int4smaller does not exist')

-----------
QUERY:


INSERT INTO unit VALUES ('cm', 1.0);
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO unit VALUES ('m', 100.0);
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO unit VALUES ('inch', 2.54);
RESULT:
	mySQL: []

-----------
QUERY:


INSERT INTO shoe_data VALUES ('sh1', 2, 'black', 70.0, 90.0, 'cm');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoe_data VALUES ('sh2', 0, 'black', 30.0, 40.0, 'inch');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoe_data VALUES ('sh3', 4, 'brown', 50.0, 65.0, 'cm');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoe_data VALUES ('sh4', 3, 'brown', 40.0, 50.0, 'inch');
RESULT:
	mySQL: []

-----------
QUERY:


INSERT INTO shoelace_data VALUES ('sl1', 5, 'black', 80.0, 'cm');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_data VALUES ('sl2', 6, 'black', 100.0, 'cm');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_data VALUES ('sl3', 0, 'black', 35.0 , 'inch');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_data VALUES ('sl4', 8, 'black', 40.0 , 'inch');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_data VALUES ('sl5', 4, 'brown', 1.0 , 'm');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_data VALUES ('sl6', 0, 'brown', 0.9 , 'm');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_data VALUES ('sl7', 7, 'brown', 60 , 'cm');
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_data VALUES ('sl8', 1, 'brown', 40 , 'inch');
RESULT:
	mySQL: []

-----------
QUERY:


-- SELECTs in doc
SELECT * FROM shoelace ORDER BY sl_name;
RESULT:
	mySQL: (('sl1', 5, 'black', 80.0, 'cm', 80.0), ('sl2', 6, 'black', 100.0, 'cm', 100.0), ('sl3', 0, 'black', 35.0, 'inch', 88.89999866485596), ('sl4', 8, 'black', 40.0, 'inch', 101.5999984741211), ('sl5', 4, 'brown', 1.0, 'm', 100.0), ('sl6', 0, 'brown', 0.9, 'm', 89.99999761581421), ('sl7', 7, 'brown', 60.0, 'cm', 60.0), ('sl8', 1, 'brown', 40.0, 'inch', 101.5999984741211))

-----------
QUERY:

SELECT * FROM shoe_ready WHERE total_avail >= 2 ORDER BY 1;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.shoe_ready' doesn't exist")

-----------
QUERY:


    CREATE TABLE shoelace_log (
        sl_name    char(10),      -- shoelace changed
        sl_avail   integer,       -- new available value
        log_who    name,          -- who did it
        log_when   timestamp      -- when
    );
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'name,          -- who did it\n        log_when   timestamp      -- when\n    )' at line 4")

-----------
QUERY:


-- Want /* REPLACED */''log_who/* REPLACED */'' to be CURRENT_USER,
-- but that is non-portable for the regression test
-- - thomas 1999-02-21

    CREATE RULE log_shoelace AS ON UPDATE TO shoelace_data
        WHERE NEW.sl_avail != OLD.sl_avail
        DO INSERT INTO shoelace_log VALUES (
                                        NEW.sl_name,
                                        NEW.sl_avail,
                                        'Al Bundy',
                                        'epoch'
                                    );
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE log_shoelace AS ON UPDATE TO shoelace_data\n        WHERE NEW.sl_avail != OL' at line 5")

-----------
QUERY:


UPDATE shoelace_data SET sl_avail = 6 WHERE  sl_name = 'sl7';
RESULT:
	mySQL: []

-----------
QUERY:


SELECT * FROM shoelace_log;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.shoelace_log' doesn't exist")

-----------
QUERY:


    CREATE RULE shoelace_ins AS ON INSERT TO shoelace
        DO INSTEAD
        INSERT INTO shoelace_data VALUES (
               NEW.sl_name,
               NEW.sl_avail,
               NEW.sl_color,
               NEW.sl_len,
               NEW.sl_unit);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE shoelace_ins AS ON INSERT TO shoelace\n        DO INSTEAD\n        INSERT INT' at line 1")

-----------
QUERY:


    CREATE RULE shoelace_upd AS ON UPDATE TO shoelace
        DO INSTEAD
        UPDATE shoelace_data SET
               sl_name = NEW.sl_name,
               sl_avail = NEW.sl_avail,
               sl_color = NEW.sl_color,
               sl_len = NEW.sl_len,
               sl_unit = NEW.sl_unit
         WHERE sl_name = OLD.sl_name;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE shoelace_upd AS ON UPDATE TO shoelace\n        DO INSTEAD\n        UPDATE sho' at line 1")

-----------
QUERY:


    CREATE RULE shoelace_del AS ON DELETE TO shoelace
        DO INSTEAD
        DELETE FROM shoelace_data
         WHERE sl_name = OLD.sl_name;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE shoelace_del AS ON DELETE TO shoelace\n        DO INSTEAD\n        DELETE FRO' at line 1")

-----------
QUERY:


    CREATE TABLE shoelace_arrive (
        arr_name    char(10),
        arr_quant   integer
    );
RESULT:
	mySQL: []

-----------
QUERY:


    CREATE TABLE shoelace_ok (
        ok_name     char(10),
        ok_quant    integer
    );
RESULT:
	mySQL: []

-----------
QUERY:


    CREATE RULE shoelace_ok_ins AS ON INSERT TO shoelace_ok
        DO INSTEAD
        UPDATE shoelace SET
               sl_avail = sl_avail + NEW.ok_quant
         WHERE sl_name = NEW.ok_name;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE shoelace_ok_ins AS ON INSERT TO shoelace_ok\n        DO INSTEAD\n        UPDA' at line 1")

-----------
QUERY:


INSERT INTO shoelace_arrive VALUES ('sl3', 10);
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_arrive VALUES ('sl6', 20);
RESULT:
	mySQL: []

-----------
QUERY:

INSERT INTO shoelace_arrive VALUES ('sl8', 20);
RESULT:
	mySQL: []

-----------
QUERY:


SELECT * FROM shoelace ORDER BY sl_name;
RESULT:
	mySQL: (('sl1', 5, 'black', 80.0, 'cm', 80.0), ('sl2', 6, 'black', 100.0, 'cm', 100.0), ('sl3', 0, 'black', 35.0, 'inch', 88.89999866485596), ('sl4', 8, 'black', 40.0, 'inch', 101.5999984741211), ('sl5', 4, 'brown', 1.0, 'm', 100.0), ('sl6', 0, 'brown', 0.9, 'm', 89.99999761581421), ('sl7', 6, 'brown', 60.0, 'cm', 60.0), ('sl8', 1, 'brown', 40.0, 'inch', 101.5999984741211))

-----------
QUERY:


insert into shoelace_ok select * from shoelace_arrive;
RESULT:
	mySQL: []

-----------
QUERY:


SELECT * FROM shoelace ORDER BY sl_name;
RESULT:
	mySQL: (('sl1', 5, 'black', 80.0, 'cm', 80.0), ('sl2', 6, 'black', 100.0, 'cm', 100.0), ('sl3', 0, 'black', 35.0, 'inch', 88.89999866485596), ('sl4', 8, 'black', 40.0, 'inch', 101.5999984741211), ('sl5', 4, 'brown', 1.0, 'm', 100.0), ('sl6', 0, 'brown', 0.9, 'm', 89.99999761581421), ('sl7', 6, 'brown', 60.0, 'cm', 60.0), ('sl8', 1, 'brown', 40.0, 'inch', 101.5999984741211))

-----------
QUERY:


SELECT * FROM shoelace_log ORDER BY sl_name;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.shoelace_log' doesn't exist")

-----------
QUERY:


    CREATE VIEW shoelace_obsolete AS
	SELECT * FROM shoelace WHERE NOT EXISTS
	    (SELECT shoename FROM shoe WHERE slcolor = sl_color);
RESULT:
	mySQL: []

-----------
QUERY:


    CREATE VIEW shoelace_candelete AS
	SELECT * FROM shoelace_obsolete WHERE sl_avail = 0;
RESULT:
	mySQL: []

-----------
QUERY:


insert into shoelace values ('sl9', 0, 'pink', 35.0, 'inch', 0.0);
RESULT:
	mySQL: ERROR - (1394, "Can not insert into join view 'test.shoelace' without fields list")

-----------
QUERY:

insert into shoelace values ('sl10', 1000, 'magenta', 40.0, 'inch', 0.0);
RESULT:
	mySQL: ERROR - (1394, "Can not insert into join view 'test.shoelace' without fields list")

-----------
QUERY:

-- Unsupported (even though a similar updatable view construct is)
insert into shoelace values ('sl10', 1000, 'magenta', 40.0, 'inch', 0.0)
  on conflict do nothing;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'conflict do nothing' at line 3")

-----------
QUERY:


SELECT * FROM shoelace_obsolete ORDER BY sl_len_cm;
RESULT:
	mySQL: ()

-----------
QUERY:

SELECT * FROM shoelace_candelete;
RESULT:
	mySQL: ()

-----------
QUERY:


DELETE FROM shoelace WHERE EXISTS
    (SELECT * FROM shoelace_candelete
             WHERE sl_name = shoelace.sl_name);
RESULT:
	mySQL: ERROR - (1395, "Can not delete from join view 'test.shoelace'")

-----------
QUERY:


SELECT * FROM shoelace ORDER BY sl_name;
RESULT:
	mySQL: (('sl1', 5, 'black', 80.0, 'cm', 80.0), ('sl2', 6, 'black', 100.0, 'cm', 100.0), ('sl3', 0, 'black', 35.0, 'inch', 88.89999866485596), ('sl4', 8, 'black', 40.0, 'inch', 101.5999984741211), ('sl5', 4, 'brown', 1.0, 'm', 100.0), ('sl6', 0, 'brown', 0.9, 'm', 89.99999761581421), ('sl7', 6, 'brown', 60.0, 'cm', 60.0), ('sl8', 1, 'brown', 40.0, 'inch', 101.5999984741211))

-----------
QUERY:


SELECT * FROM shoe ORDER BY shoename;
RESULT:
	mySQL: (('sh1', 2, 'black', 70.0, 70.0, 90.0, 90.0, 'cm'), ('sh2', 0, 'black', 30.0, 76.19999885559082, 40.0, 101.5999984741211, 'inch'), ('sh3', 4, 'brown', 50.0, 50.0, 65.0, 65.0, 'cm'), ('sh4', 3, 'brown', 40.0, 101.5999984741211, 50.0, 126.99999809265137, 'inch'))

-----------
QUERY:

SELECT count(*) FROM shoe;
RESULT:
	mySQL: ((4,),)

-----------
QUERY:



--
-- Simple test of qualified ON INSERT ... this did not work in 7.0 ...
--
create table rules_foo (f1 int);
RESULT:
	mySQL: []

-----------
QUERY:

create table rules_foo2 (f1 int);
RESULT:
	mySQL: []

-----------
QUERY:


create rule rules_foorule as on insert to rules_foo where f1 < 100
do instead nothing;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rules_foorule as on insert to rules_foo where f1 < 100\ndo instead nothing' at line 1")

-----------
QUERY:


insert into rules_foo values(1);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rules_foo values(1001);
RESULT:
	mySQL: []

-----------
QUERY:

select * from rules_foo;
RESULT:
	mySQL: ((1,), (1001,))

-----------
QUERY:


drop rule rules_foorule on rules_foo;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rules_foorule on rules_foo' at line 1")

-----------
QUERY:


-- this should fail because f1 is not exposed for unqualified reference:
create rule rules_foorule as on insert to rules_foo where f1 < 100
do instead insert into rules_foo2 values (f1);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rules_foorule as on insert to rules_foo where f1 < 100\ndo instead insert in' at line 2")

-----------
QUERY:

-- this is the correct way:
create rule rules_foorule as on insert to rules_foo where f1 < 100
do instead insert into rules_foo2 values (new.f1);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rules_foorule as on insert to rules_foo where f1 < 100\ndo instead insert in' at line 2")

-----------
QUERY:


insert into rules_foo values(2);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rules_foo values(100);
RESULT:
	mySQL: []

-----------
QUERY:


select * from rules_foo;
RESULT:
	mySQL: ((1,), (1001,), (2,), (100,))

-----------
QUERY:

select * from rules_foo2;
RESULT:
	mySQL: ()

-----------
QUERY:


drop rule rules_foorule on rules_foo;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rules_foorule on rules_foo' at line 1")

-----------
QUERY:

drop table rules_foo;
RESULT:
	mySQL: []

-----------
QUERY:

drop table rules_foo2;
RESULT:
	mySQL: []

-----------
QUERY:



--
-- Test rules containing INSERT ... SELECT, which is a very ugly special
-- case as of 7.1.  Example is based on bug report from Joel Burton.
--
create table pparent (pid int, txt text);
RESULT:
	mySQL: []

-----------
QUERY:

insert into pparent values (1,'parent1');
RESULT:
	mySQL: []

-----------
QUERY:

insert into pparent values (2,'parent2');
RESULT:
	mySQL: []

-----------
QUERY:


create table cchild (pid int, descrip text);
RESULT:
	mySQL: []

-----------
QUERY:

insert into cchild values (1,'descrip1');
RESULT:
	mySQL: []

-----------
QUERY:


create view vview as
  select pparent.pid, txt, descrip from
    pparent left join cchild using (pid);
RESULT:
	mySQL: []

-----------
QUERY:


create rule rrule as
  on update to vview do instead
(
  insert into cchild (pid, descrip)
    select old.pid, new.descrip where old.descrip isnull;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rrule as\n  on update to vview do instead\n(\n  insert into cchild (pid, descr' at line 1")

-----------
QUERY:

  update cchild set descrip = new.descrip where cchild.pid = old.pid;
RESULT:
	mySQL: ERROR - (1054, "Unknown column 'old.pid' in 'where clause'")

-----------
QUERY:

);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')' at line 1")

-----------
QUERY:


select * from vview;
RESULT:
	mySQL: ((1, 'parent1', 'descrip1'), (2, 'parent2', None))

-----------
QUERY:

update vview set descrip='test1' where pid=1;
RESULT:
	mySQL: ERROR - (1288, 'The target table vview of the UPDATE is not updatable')

-----------
QUERY:

select * from vview;
RESULT:
	mySQL: ((1, 'parent1', 'descrip1'), (2, 'parent2', None))

-----------
QUERY:

update vview set descrip='test2' where pid=2;
RESULT:
	mySQL: ERROR - (1288, 'The target table vview of the UPDATE is not updatable')

-----------
QUERY:

select * from vview;
RESULT:
	mySQL: ((1, 'parent1', 'descrip1'), (2, 'parent2', None))

-----------
QUERY:

update vview set descrip='test3' where pid=3;
RESULT:
	mySQL: ERROR - (1288, 'The target table vview of the UPDATE is not updatable')

-----------
QUERY:

select * from vview;
RESULT:
	mySQL: ((1, 'parent1', 'descrip1'), (2, 'parent2', None))

-----------
QUERY:

select * from cchild;
RESULT:
	mySQL: ((1, 'descrip1'),)

-----------
QUERY:


drop rule rrule on vview;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rrule on vview' at line 1")

-----------
QUERY:

drop view vview;
RESULT:
	mySQL: []

-----------
QUERY:

drop table pparent;
RESULT:
	mySQL: []

-----------
QUERY:

drop table cchild;
RESULT:
	mySQL: []

-----------
QUERY:



--
-- Check that ruleutils are working
--

-- temporarily disable fancy output, so view changes create less diff noise
\a\t

SELECT viewname, definition FROM pg_views
WHERE schemaname = 'pg_catalog'
ORDER BY viewname;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\\a\\t\n\nSELECT viewname, definition FROM pg_views\nWHERE schemaname = 'pg_catalog'\n' at line 6")

-----------
QUERY:


SELECT tablename, rulename, definition FROM pg_rules
WHERE schemaname = 'pg_catalog'
ORDER BY tablename, rulename;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.pg_rules' doesn't exist")

-----------
QUERY:


-- restore normal output mode
\a\t

--
-- CREATE OR REPLACE RULE
--

CREATE TABLE ruletest_tbl (a int, b int);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\\a\\t\n\n--\n-- CREATE OR REPLACE RULE\n--\n\nCREATE TABLE ruletest_tbl (a int, b int)' at line 2")

-----------
QUERY:

CREATE TABLE ruletest_tbl2 (a int, b int);
RESULT:
	mySQL: []

-----------
QUERY:


CREATE OR REPLACE RULE myrule AS ON INSERT TO ruletest_tbl
	DO INSTEAD INSERT INTO ruletest_tbl2 VALUES (10, 10);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE myrule AS ON INSERT TO ruletest_tbl\n\tDO INSTEAD INSERT INTO ruletest_tbl2 V' at line 1")

-----------
QUERY:


INSERT INTO ruletest_tbl VALUES (99, 99);
RESULT:
	mySQL: ERROR - (1146, "Table 'test.ruletest_tbl' doesn't exist")

-----------
QUERY:


CREATE OR REPLACE RULE myrule AS ON INSERT TO ruletest_tbl
	DO INSTEAD INSERT INTO ruletest_tbl2 VALUES (1000, 1000);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE myrule AS ON INSERT TO ruletest_tbl\n\tDO INSTEAD INSERT INTO ruletest_tbl2 V' at line 1")

-----------
QUERY:


INSERT INTO ruletest_tbl VALUES (99, 99);
RESULT:
	mySQL: ERROR - (1146, "Table 'test.ruletest_tbl' doesn't exist")

-----------
QUERY:


SELECT * FROM ruletest_tbl2;
RESULT:
	mySQL: ()

-----------
QUERY:


-- Check that rewrite rules splitting one INSERT into multiple
-- conditional statements does not disable FK checking.
create table rule_and_refint_t1 (
	id1a integer,
	id1b integer,

	primary key (id1a, id1b)
);
RESULT:
	mySQL: []

-----------
QUERY:


create table rule_and_refint_t2 (
	id2a integer,
	id2c integer,

	primary key (id2a, id2c)
);
RESULT:
	mySQL: []

-----------
QUERY:


create table rule_and_refint_t3 (
	id3a integer,
	id3b integer,
	id3c integer,
	data text,

	primary key (id3a, id3b, id3c),

	foreign key (id3a, id3b) references rule_and_refint_t1 (id1a, id1b),
	foreign key (id3a, id3c) references rule_and_refint_t2 (id2a, id2c)
);
RESULT:
	mySQL: []

-----------
QUERY:



insert into rule_and_refint_t1 values (1, 11);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t1 values (1, 12);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t1 values (2, 21);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t1 values (2, 22);
RESULT:
	mySQL: []

-----------
QUERY:


insert into rule_and_refint_t2 values (1, 11);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t2 values (1, 12);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t2 values (2, 21);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t2 values (2, 22);
RESULT:
	mySQL: []

-----------
QUERY:


insert into rule_and_refint_t3 values (1, 11, 11, 'row1');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t3 values (1, 11, 12, 'row2');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t3 values (1, 12, 11, 'row3');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t3 values (1, 12, 12, 'row4');
RESULT:
	mySQL: []

-----------
QUERY:

insert into rule_and_refint_t3 values (1, 11, 13, 'row5');
RESULT:
	mySQL: ERROR - (1452, 'Cannot add or update a child row: a foreign key constraint fails (`test`.`rule_and_refint_t3`, CONSTRAINT `rule_and_refint_t3_ibfk_2` FOREIGN KEY (`id3a`, `id3c`) REFERENCES `rule_and_refint_t2` (`id2a`, `id2c`))')

-----------
QUERY:

insert into rule_and_refint_t3 values (1, 13, 11, 'row6');
RESULT:
	mySQL: ERROR - (1452, 'Cannot add or update a child row: a foreign key constraint fails (`test`.`rule_and_refint_t3`, CONSTRAINT `rule_and_refint_t3_ibfk_1` FOREIGN KEY (`id3a`, `id3b`) REFERENCES `rule_and_refint_t1` (`id1a`, `id1b`))')

-----------
QUERY:

-- Ordinary table
insert into rule_and_refint_t3 values (1, 13, 11, 'row6')
  on conflict do nothing;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'conflict do nothing' at line 3")

-----------
QUERY:

-- rule not fired, so fk violation
insert into rule_and_refint_t3 values (1, 13, 11, 'row6')
  on conflict (id3a, id3b, id3c) do update
  set id3b = excluded.id3b;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'conflict (id3a, id3b, id3c) do update\n  set id3b = excluded.id3b' at line 3")

-----------
QUERY:

-- rule fired, so unsupported
insert into shoelace values ('sl9', 0, 'pink', 35.0, 'inch', 0.0)
  on conflict (sl_name) do update
  set sl_avail = excluded.sl_avail;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'conflict (sl_name) do update\n  set sl_avail = excluded.sl_avail' at line 3")

-----------
QUERY:


create rule rule_and_refint_t3_ins as on insert to rule_and_refint_t3
	where (exists (select 1 from rule_and_refint_t3
			where (((rule_and_refint_t3.id3a = new.id3a)
			and (rule_and_refint_t3.id3b = new.id3b))
			and (rule_and_refint_t3.id3c = new.id3c))))
	do instead update rule_and_refint_t3 set data = new.data
	where (((rule_and_refint_t3.id3a = new.id3a)
	and (rule_and_refint_t3.id3b = new.id3b))
	and (rule_and_refint_t3.id3c = new.id3c));
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rule_and_refint_t3_ins as on insert to rule_and_refint_t3\n\twhere (exists (s' at line 1")

-----------
QUERY:


insert into rule_and_refint_t3 values (1, 11, 13, 'row7');
RESULT:
	mySQL: ERROR - (1452, 'Cannot add or update a child row: a foreign key constraint fails (`test`.`rule_and_refint_t3`, CONSTRAINT `rule_and_refint_t3_ibfk_2` FOREIGN KEY (`id3a`, `id3c`) REFERENCES `rule_and_refint_t2` (`id2a`, `id2c`))')

-----------
QUERY:

insert into rule_and_refint_t3 values (1, 13, 11, 'row8');
RESULT:
	mySQL: ERROR - (1452, 'Cannot add or update a child row: a foreign key constraint fails (`test`.`rule_and_refint_t3`, CONSTRAINT `rule_and_refint_t3_ibfk_1` FOREIGN KEY (`id3a`, `id3b`) REFERENCES `rule_and_refint_t1` (`id1a`, `id1b`))')

-----------
QUERY:


--
-- disallow dropping a view/* REPLACED */''s rule (bug #5072)
--

create view rules_fooview as select 'rules_foo'::text;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '::text' at line 5")

-----------
QUERY:

drop rule "_RETURN" on rules_fooview;
RESULT:
	mySQL: ERROR - (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'rule "_RETURN" on rules_fooview\' at line 1')

-----------
QUERY:

drop view rules_fooview;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rules_fooview'")

-----------
QUERY:


--
-- We used to allow converting a table to a view by creating a /* REPLACED */''_RETURN/* REPLACED */''
-- rule for it, but no more.
--

create table rules_fooview (x int, y text);
RESULT:
	mySQL: []

-----------
QUERY:

create rule "_RETURN" as on select to rules_fooview do instead
  select 1 as x, 'aaa'::text as y;
RESULT:
	mySQL: ERROR - (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'rule "_RETURN" as on select to rules_fooview do instead\n  select 1 as x, \'aaa\'::\' at line 1')

-----------
QUERY:

drop table rules_fooview;
RESULT:
	mySQL: []

-----------
QUERY:


-- likewise, converting a partitioned table or partition to view is not allowed
create table rules_fooview (x int, y text) partition by list (x);
RESULT:
	mySQL: ERROR - (1492, 'For LIST partitions each partition must be defined')

-----------
QUERY:

create rule "_RETURN" as on select to rules_fooview do instead
  select 1 as x, 'aaa'::text as y;
RESULT:
	mySQL: ERROR - (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'rule "_RETURN" as on select to rules_fooview do instead\n  select 1 as x, \'aaa\'::\' at line 1')

-----------
QUERY:


create table rules_fooview_part partition of rules_fooview for values in (1);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'of rules_fooview for values in (1)' at line 1")

-----------
QUERY:

create rule "_RETURN" as on select to rules_fooview_part do instead
  select 1 as x, 'aaa'::text as y;
RESULT:
	mySQL: ERROR - (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'rule "_RETURN" as on select to rules_fooview_part do instead\n  select 1 as x, \'a\' at line 1')

-----------
QUERY:


drop table rules_fooview;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rules_fooview'")

-----------
QUERY:


--
-- check for planner problems with complex inherited UPDATES
--

create table id (id serial primary key, name text);
RESULT:
	mySQL: []

-----------
QUERY:

-- currently, must respecify PKEY for each inherited subtable
create table test_1 (id integer primary key) inherits (id);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'inherits (id)' at line 2")

-----------
QUERY:

create table test_2 (id integer primary key) inherits (id);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'inherits (id)' at line 1")

-----------
QUERY:

create table test_3 (id integer primary key) inherits (id);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'inherits (id)' at line 1")

-----------
QUERY:


insert into test_1 (name) values ('Test 1');
RESULT:
	mySQL: ERROR - (1146, "Table 'test.test_1' doesn't exist")

-----------
QUERY:

insert into test_1 (name) values ('Test 2');
RESULT:
	mySQL: ERROR - (1146, "Table 'test.test_1' doesn't exist")

-----------
QUERY:

insert into test_2 (name) values ('Test 3');
RESULT:
	mySQL: ERROR - (1146, "Table 'test.test_2' doesn't exist")

-----------
QUERY:

insert into test_2 (name) values ('Test 4');
RESULT:
	mySQL: ERROR - (1146, "Table 'test.test_2' doesn't exist")

-----------
QUERY:

insert into test_3 (name) values ('Test 5');
RESULT:
	mySQL: ERROR - (1146, "Table 'test.test_3' doesn't exist")

-----------
QUERY:

insert into test_3 (name) values ('Test 6');
RESULT:
	mySQL: ERROR - (1146, "Table 'test.test_3' doesn't exist")

-----------
QUERY:


create view id_ordered as select * from id order by id;
RESULT:
	mySQL: []

-----------
QUERY:


create rule update_id_ordered as on update to id_ordered
	do instead update id set name = new.name where id = old.id;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule update_id_ordered as on update to id_ordered\n\tdo instead update id set name' at line 1")

-----------
QUERY:


select * from id_ordered;
RESULT:
	mySQL: ()

-----------
QUERY:

update id_ordered set name = 'update 2' where id = 2;
RESULT:
	mySQL: []

-----------
QUERY:

update id_ordered set name = 'update 4' where id = 4;
RESULT:
	mySQL: []

-----------
QUERY:

update id_ordered set name = 'update 5' where id = 5;
RESULT:
	mySQL: []

-----------
QUERY:

select * from id_ordered;
RESULT:
	mySQL: ()

-----------
QUERY:


drop table id cascade;
RESULT:
	mySQL: []

-----------
QUERY:


--
-- check corner case where an entirely-dummy subplan is created by
-- constraint exclusion
--

create temp table t1 (a integer primary key);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'temp table t1 (a integer primary key)' at line 6")

-----------
QUERY:


create temp table t1_1 (check (a >= 0 and a < 10)) inherits (t1);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'temp table t1_1 (check (a >= 0 and a < 10)) inherits (t1)' at line 1")

-----------
QUERY:

create temp table t1_2 (check (a >= 10 and a < 20)) inherits (t1);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'temp table t1_2 (check (a >= 10 and a < 20)) inherits (t1)' at line 1")

-----------
QUERY:


create rule t1_ins_1 as on insert to t1
	where new.a >= 0 and new.a < 10
	do instead
	insert into t1_1 values (new.a);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule t1_ins_1 as on insert to t1\n\twhere new.a >= 0 and new.a < 10\n\tdo instead\n\ti' at line 1")

-----------
QUERY:

create rule t1_ins_2 as on insert to t1
	where new.a >= 10 and new.a < 20
	do instead
	insert into t1_2 values (new.a);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule t1_ins_2 as on insert to t1\n\twhere new.a >= 10 and new.a < 20\n\tdo instead\n\t' at line 1")

-----------
QUERY:


create rule t1_upd_1 as on update to t1
	where old.a >= 0 and old.a < 10
	do instead
	update t1_1 set a = new.a where a = old.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule t1_upd_1 as on update to t1\n\twhere old.a >= 0 and old.a < 10\n\tdo instead\n\tu' at line 1")

-----------
QUERY:

create rule t1_upd_2 as on update to t1
	where old.a >= 10 and old.a < 20
	do instead
	update t1_2 set a = new.a where a = old.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule t1_upd_2 as on update to t1\n\twhere old.a >= 10 and old.a < 20\n\tdo instead\n\t' at line 1")

-----------
QUERY:


set constraint_exclusion = on;
RESULT:
	mySQL: ERROR - (1193, "Unknown system variable 'constraint_exclusion'")

-----------
QUERY:


insert into t1 select * from generate_series(5,19,1) g;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(5,19,1) g' at line 1")

-----------
QUERY:

update t1 set a = 4 where a = 5;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.t1' doesn't exist")

-----------
QUERY:


select * from only t1;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.only' doesn't exist")

-----------
QUERY:

select * from only t1_1;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.only' doesn't exist")

-----------
QUERY:

select * from only t1_2;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.only' doesn't exist")

-----------
QUERY:


reset constraint_exclusion;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'constraint_exclusion' at line 1")

-----------
QUERY:


-- test FOR UPDATE in rules

create table rules_base(f1 int, f2 int);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rules_base values(1,2), (11,12);
RESULT:
	mySQL: []

-----------
QUERY:

create rule r1 as on update to rules_base do instead
  select * from rules_base where f1 = 1 for update;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r1 as on update to rules_base do instead\n  select * from rules_base where f' at line 1")

-----------
QUERY:

update rules_base set f2 = f2 + 1;
RESULT:
	mySQL: []

-----------
QUERY:

create or replace rule r1 as on update to rules_base do instead
  select * from rules_base where f1 = 11 for update of rules_base;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r1 as on update to rules_base do instead\n  select * from rules_base where f' at line 1")

-----------
QUERY:

update rules_base set f2 = f2 + 1;
RESULT:
	mySQL: []

-----------
QUERY:

create or replace rule r1 as on update to rules_base do instead
  select * from rules_base where f1 = 11 for update of old;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r1 as on update to rules_base do instead\n  select * from rules_base where f' at line 1")

-----------
QUERY:
 -- error
drop table rules_base;
RESULT:
	mySQL: []

-----------
QUERY:


-- test various flavors of pg_get_viewdef()

select pg_get_viewdef('shoe'::regclass) as unpretty;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '::regclass) as unpretty' at line 3")

-----------
QUERY:

select pg_get_viewdef('shoe'::regclass,true) as pretty;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '::regclass,true) as pretty' at line 1")

-----------
QUERY:

select pg_get_viewdef('shoe'::regclass,0) as prettier;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '::regclass,0) as prettier' at line 1")

-----------
QUERY:


--
-- check multi-row VALUES in rules
--

create table rules_src(f1 int, f2 int default 0);
RESULT:
	mySQL: []

-----------
QUERY:

create table rules_log(f1 int, f2 int, tag text, id serial);
RESULT:
	mySQL: []

-----------
QUERY:

insert into rules_src values(1,2), (11,12);
RESULT:
	mySQL: []

-----------
QUERY:

create rule r1 as on update to rules_src do also
  insert into rules_log values(old.*, 'old', default), (new.*, 'new', default);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r1 as on update to rules_src do also\n  insert into rules_log values(old.*, ' at line 1")

-----------
QUERY:

update rules_src set f2 = f2 + 1;
RESULT:
	mySQL: []

-----------
QUERY:

update rules_src set f2 = f2 * 10;
RESULT:
	mySQL: []

-----------
QUERY:

select * from rules_src;
RESULT:
	mySQL: ((1, 30), (11, 130))

-----------
QUERY:

select * from rules_log;
RESULT:
	mySQL: ()

-----------
QUERY:

create rule r2 as on update to rules_src do also
  values(old.*, 'old'), (new.*, 'new');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r2 as on update to rules_src do also\n  values(old.*, 'old'), (new.*, 'new')' at line 1")

-----------
QUERY:

update rules_src set f2 = f2 / 10;
RESULT:
	mySQL: []

-----------
QUERY:

create rule r3 as on insert to rules_src do also
  insert into rules_log values(null, null, '-', default), (new.*, 'new', default);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r3 as on insert to rules_src do also\n  insert into rules_log values(null, n' at line 1")

-----------
QUERY:

insert into rules_src values(22,23), (33,default);
RESULT:
	mySQL: []

-----------
QUERY:

select * from rules_src;
RESULT:
	mySQL: ((1, 3), (11, 13), (22, 23), (33, 0))

-----------
QUERY:

select * from rules_log;
RESULT:
	mySQL: ()

-----------
QUERY:

create rule r4 as on delete to rules_src do notify rules_src_deletion;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r4 as on delete to rules_src do notify rules_src_deletion' at line 1")

-----------
QUERY:


--
-- Ensure an aliased target relation for insert is correctly deparsed.
--
create rule r5 as on insert to rules_src do instead insert into rules_log AS trgt SELECT NEW.* RETURNING trgt.f1, trgt.f2;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r5 as on insert to rules_src do instead insert into rules_log AS trgt SELEC' at line 4")

-----------
QUERY:

create rule r6 as on update to rules_src do instead UPDATE rules_log AS trgt SET tag = 'updated' WHERE trgt.f1 = new.f1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r6 as on update to rules_src do instead UPDATE rules_log AS trgt SET tag = ' at line 1")

-----------
QUERY:


--
-- Check deparse disambiguation of INSERT/UPDATE/DELETE targets.
--
create rule r7 as on delete to rules_src do instead
  with wins as (insert into int4_tbl as trgt values (0) returning *),
       wupd as (update int4_tbl trgt set f1 = f1+1 returning *),
       wdel as (delete from int4_tbl trgt where f1 = 0 returning *)
  insert into rules_log AS trgt select old.* from wins, wupd, wdel
  returning trgt.f1, trgt.f2;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule r7 as on delete to rules_src do instead\n  with wins as (insert into int4_tb' at line 4")

-----------
QUERY:


-- check display of all rules added above
-- \d+ rules_src

--
-- Also check multiassignment deparsing.
--
create table rule_t1(f1 int, f2 int);
RESULT:
	mySQL: []

-----------
QUERY:

create table rule_dest(f1 int, f2 int[], tag text);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '[], tag text)' at line 1")

-----------
QUERY:

create rule rr as on update to rule_t1 do instead UPDATE rule_dest trgt
  SET (f2[1], f1, tag) = (SELECT new.f2, new.f1, 'updated'::varchar)
  WHERE trgt.f1 = new.f1 RETURNING new.*;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'rule rr as on update to rule_t1 do instead UPDATE rule_dest trgt\n  SET (f2[1], f' at line 1")

-----------
QUERY:

-- \d+ rule_t1
drop table rule_t1, rule_dest;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rule_dest'")

-----------
QUERY:


--
-- Test implicit LATERAL references to old/new in rules
--
CREATE TABLE rule_t1(a int, b text DEFAULT 'xxx', c int);
RESULT:
	mySQL: ERROR - (1101, "BLOB, TEXT, GEOMETRY or JSON column 'b' can't have a default value")

-----------
QUERY:

CREATE VIEW rule_v1 AS SELECT * FROM rule_t1;
RESULT:
	mySQL: []

-----------
QUERY:

CREATE RULE v1_ins AS ON INSERT TO rule_v1
  DO ALSO INSERT INTO rule_t1
  SELECT * FROM (SELECT a + 10 FROM rule_t1 WHERE a = NEW.a) tt;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE v1_ins AS ON INSERT TO rule_v1\n  DO ALSO INSERT INTO rule_t1\n  SELECT * FRO' at line 1")

-----------
QUERY:

CREATE RULE v1_upd AS ON UPDATE TO rule_v1
  DO ALSO UPDATE rule_t1 t
  SET c = tt.a * 10
  FROM (SELECT a FROM rule_t1 WHERE a = OLD.a) tt WHERE t.a = tt.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE v1_upd AS ON UPDATE TO rule_v1\n  DO ALSO UPDATE rule_t1 t\n  SET c = tt.a * ' at line 1")

-----------
QUERY:

INSERT INTO rule_v1 VALUES (1, 'a'), (2, 'b');
RESULT:
	mySQL: ERROR - (1366, "Incorrect integer value: 'a' for column 'f2' at row 1")

-----------
QUERY:

UPDATE rule_v1 SET b = upper(b);
RESULT:
	mySQL: ERROR - (1054, "Unknown column 'b' in 'field list'")

-----------
QUERY:

SELECT * FROM rule_t1;
RESULT:
	mySQL: ()

-----------
QUERY:

DROP TABLE rule_t1 CASCADE;
RESULT:
	mySQL: []

-----------
QUERY:


--
-- check alter rename rule
--
CREATE TABLE rule_t1 (a INT);
RESULT:
	mySQL: []

-----------
QUERY:

CREATE VIEW rule_v1 AS SELECT * FROM rule_t1;
RESULT:
	mySQL: ERROR - (1050, "Table 'rule_v1' already exists")

-----------
QUERY:


CREATE RULE InsertRule AS
    ON INSERT TO rule_v1
    DO INSTEAD
        INSERT INTO rule_t1 VALUES(new.a);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE InsertRule AS\n    ON INSERT TO rule_v1\n    DO INSTEAD\n        INSERT INTO r' at line 1")

-----------
QUERY:


ALTER RULE InsertRule ON rule_v1 RENAME to NewInsertRule;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE InsertRule ON rule_v1 RENAME to NewInsertRule' at line 1")

-----------
QUERY:


INSERT INTO rule_v1 VALUES(1);
RESULT:
	mySQL: ERROR - (1356, "View 'test.rule_v1' references invalid table(s) or column(s) or function(s) or definer/invoker of view lack rights to use them")

-----------
QUERY:

SELECT * FROM rule_v1;
RESULT:
	mySQL: ERROR - (1356, "View 'test.rule_v1' references invalid table(s) or column(s) or function(s) or definer/invoker of view lack rights to use them")

-----------
QUERY:


-- \d+ rule_v1

--
-- error conditions for alter rename rule
--
ALTER RULE InsertRule ON rule_v1 RENAME TO NewInsertRule;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE InsertRule ON rule_v1 RENAME TO NewInsertRule' at line 6")

-----------
QUERY:
 -- doesn/* REPLACED */''t exist
ALTER RULE NewInsertRule ON rule_v1 RENAME TO "_RETURN";
RESULT:
	mySQL: ERROR - (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'RULE NewInsertRule ON rule_v1 RENAME TO "_RETURN"\' at line 2')

-----------
QUERY:
 -- already exists
ALTER RULE "_RETURN" ON rule_v1 RENAME TO abc;
RESULT:
	mySQL: ERROR - (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'RULE "_RETURN" ON rule_v1 RENAME TO abc\' at line 2')

-----------
QUERY:
 -- ON SELECT rule cannot be renamed

DROP VIEW rule_v1;
RESULT:
	mySQL: []

-----------
QUERY:

DROP TABLE rule_t1;
RESULT:
	mySQL: []

-----------
QUERY:


--
-- check display of VALUES in view definitions
--
create view rule_v1 as values(1,2);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(1,2)' at line 4")

-----------
QUERY:

-- \d+ rule_v1
alter table rule_v1 rename column column2 to q2;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.rule_v1' doesn't exist")

-----------
QUERY:

-- \d+ rule_v1
drop view rule_v1;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rule_v1'")

-----------
QUERY:

create view rule_v1(x) as values(1,2);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(1,2)' at line 1")

-----------
QUERY:

-- \d+ rule_v1
drop view rule_v1;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rule_v1'")

-----------
QUERY:

create view rule_v1(x) as select * from (values(1,2)) v;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(1,2)) v' at line 1")

-----------
QUERY:

-- \d+ rule_v1
drop view rule_v1;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rule_v1'")

-----------
QUERY:

create view rule_v1(x) as select * from (values(1,2)) v(q,w);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '(1,2)) v(q,w)' at line 1")

-----------
QUERY:

-- \d+ rule_v1
drop view rule_v1;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rule_v1'")

-----------
QUERY:


--
-- Check DO INSTEAD rules with ON CONFLICT
--
CREATE TABLE hats (
	hat_name    char(10) primary key,
	hat_color   char(10)      -- hat color
);
RESULT:
	mySQL: []

-----------
QUERY:


CREATE TABLE hat_data (
	hat_name    char(10),
	hat_color   char(10)      -- hat color
);
RESULT:
	mySQL: []

-----------
QUERY:

create unique index hat_data_unique_idx
  on hat_data (hat_name COLLATE "C" bpchar_pattern_ops);
RESULT:
	mySQL: ERROR - (1064, 'You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near \'COLLATE "C" bpchar_pattern_ops)\' at line 2')

-----------
QUERY:


-- DO NOTHING with ON CONFLICT
CREATE RULE hat_nosert AS ON INSERT TO hats
    DO INSTEAD
    INSERT INTO hat_data VALUES (
           NEW.hat_name,
           NEW.hat_color)
        ON CONFLICT (hat_name COLLATE "C" bpchar_pattern_ops) WHERE hat_color = 'green'
        DO NOTHING
        RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE hat_nosert AS ON INSERT TO hats\n    DO INSTEAD\n    INSERT INTO hat_data VAL' at line 2")

-----------
QUERY:

SELECT definition FROM pg_rules WHERE tablename = 'hats' ORDER BY rulename;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.pg_rules' doesn't exist")

-----------
QUERY:


-- Works (projects row)
INSERT INTO hats VALUES ('h7', 'black') RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RETURNING *' at line 2")

-----------
QUERY:

-- Works (does nothing)
INSERT INTO hats VALUES ('h7', 'black') RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RETURNING *' at line 2")

-----------
QUERY:

SELECT tablename, rulename, definition FROM pg_rules
	WHERE tablename = 'hats';
RESULT:
	mySQL: ERROR - (1146, "Table 'test.pg_rules' doesn't exist")

-----------
QUERY:

DROP RULE hat_nosert ON hats;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE hat_nosert ON hats' at line 1")

-----------
QUERY:


-- DO NOTHING without ON CONFLICT
CREATE RULE hat_nosert_all AS ON INSERT TO hats
    DO INSTEAD
    INSERT INTO hat_data VALUES (
           NEW.hat_name,
           NEW.hat_color)
        ON CONFLICT
        DO NOTHING
        RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE hat_nosert_all AS ON INSERT TO hats\n    DO INSTEAD\n    INSERT INTO hat_data' at line 2")

-----------
QUERY:

SELECT definition FROM pg_rules WHERE tablename = 'hats' ORDER BY rulename;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.pg_rules' doesn't exist")

-----------
QUERY:

DROP RULE hat_nosert_all ON hats;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE hat_nosert_all ON hats' at line 1")

-----------
QUERY:


-- Works (does nothing)
INSERT INTO hats VALUES ('h7', 'black') RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RETURNING *' at line 2")

-----------
QUERY:


-- DO UPDATE with a WHERE clause
CREATE RULE hat_upsert AS ON INSERT TO hats
    DO INSTEAD
    INSERT INTO hat_data VALUES (
           NEW.hat_name,
           NEW.hat_color)
        ON CONFLICT (hat_name)
        DO UPDATE
           SET hat_name = hat_data.hat_name, hat_color = excluded.hat_color
           WHERE excluded.hat_color <>  'forbidden' AND hat_data.* != excluded.*
        RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE hat_upsert AS ON INSERT TO hats\n    DO INSTEAD\n    INSERT INTO hat_data VAL' at line 2")

-----------
QUERY:

SELECT definition FROM pg_rules WHERE tablename = 'hats' ORDER BY rulename;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.pg_rules' doesn't exist")

-----------
QUERY:


-- Works (does upsert)
INSERT INTO hats VALUES ('h8', 'black') RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RETURNING *' at line 2")

-----------
QUERY:

SELECT * FROM hat_data WHERE hat_name = 'h8';
RESULT:
	mySQL: ()

-----------
QUERY:

INSERT INTO hats VALUES ('h8', 'white') RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RETURNING *' at line 1")

-----------
QUERY:

SELECT * FROM hat_data WHERE hat_name = 'h8';
RESULT:
	mySQL: ()

-----------
QUERY:

INSERT INTO hats VALUES ('h8', 'forbidden') RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RETURNING *' at line 1")

-----------
QUERY:

SELECT * FROM hat_data WHERE hat_name = 'h8';
RESULT:
	mySQL: ()

-----------
QUERY:

SELECT tablename, rulename, definition FROM pg_rules
	WHERE tablename = 'hats';
RESULT:
	mySQL: ERROR - (1146, "Table 'test.pg_rules' doesn't exist")

-----------
QUERY:

-- ensure explain works for on insert conflict rules
explain (costs off) INSERT INTO hats VALUES ('h8', 'forbidden') RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'costs off) INSERT INTO hats VALUES ('h8', 'forbidden') RETURNING *' at line 2")

-----------
QUERY:


-- ensure upserting into a rule, with a CTE (different offsets!) works
WITH data(hat_name, hat_color) AS MATERIALIZED (
    VALUES ('h8', 'green'),
        ('h9', 'blue'),
        ('h7', 'forbidden')
)
INSERT INTO hats
    SELECT * FROM data
RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'MATERIALIZED (\n    VALUES ('h8', 'green'),\n        ('h9', 'blue'),\n        ('h7'' at line 2")

-----------
QUERY:

EXPLAIN (costs off)
WITH data(hat_name, hat_color) AS MATERIALIZED (
    VALUES ('h8', 'green'),
        ('h9', 'blue'),
        ('h7', 'forbidden')
)
INSERT INTO hats
    SELECT * FROM data
RETURNING *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'costs off)\nWITH data(hat_name, hat_color) AS MATERIALIZED (\n    VALUES ('h8', 'g' at line 1")

-----------
QUERY:

SELECT * FROM hat_data WHERE hat_name IN ('h8', 'h9', 'h7') ORDER BY hat_name;
RESULT:
	mySQL: ()

-----------
QUERY:


DROP RULE hat_upsert ON hats;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE hat_upsert ON hats' at line 1")

-----------
QUERY:


drop table hats;
RESULT:
	mySQL: []

-----------
QUERY:

drop table hat_data;
RESULT:
	mySQL: []

-----------
QUERY:


-- test for pg_get_functiondef properly regurgitating SET parameters
-- Note that the function is kept around to stress pg_dump.
CREATE FUNCTION func_with_set_params() RETURNS integer
    AS 'select 1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'AS 'select 1' at line 4")

-----------
QUERY:
'
    LANGUAGE SQL
    SET search_path TO PG_CATALOG
    SET extra_float_digits TO 2
    SET work_mem TO '4MB'
    SET datestyle to iso, mdy
    SET local_preload_libraries TO "Mixed/Case", 'c:/''a"/path', '', '0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789'
    IMMUTABLE STRICT;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''\n    LANGUAGE SQL\n    SET search_path TO PG_CATALOG\n    SET extra_float_digits ' at line 1")

-----------
QUERY:

SELECT pg_get_functiondef('func_with_set_params()'::regprocedure);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '::regprocedure)' at line 1")

-----------
QUERY:


-- tests for pg_get_*def with invalid objects
SELECT pg_get_constraintdef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_constraintdef does not exist')

-----------
QUERY:

SELECT pg_get_functiondef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_functiondef does not exist')

-----------
QUERY:

SELECT pg_get_indexdef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_indexdef does not exist')

-----------
QUERY:

SELECT pg_get_ruledef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_ruledef does not exist')

-----------
QUERY:

SELECT pg_get_statisticsobjdef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_statisticsobjdef does not exist')

-----------
QUERY:

SELECT pg_get_triggerdef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_triggerdef does not exist')

-----------
QUERY:

SELECT pg_get_viewdef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_viewdef does not exist')

-----------
QUERY:

SELECT pg_get_function_arguments(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_function_arguments does not exist')

-----------
QUERY:

SELECT pg_get_function_identity_arguments(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_function_identity_arguments does not exist')

-----------
QUERY:

SELECT pg_get_function_result(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_function_result does not exist')

-----------
QUERY:

SELECT pg_get_function_arg_default(0, 0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_function_arg_default does not exist')

-----------
QUERY:

SELECT pg_get_function_arg_default('pg_class'::regclass, 0);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '::regclass, 0)' at line 1")

-----------
QUERY:

SELECT pg_get_partkeydef(0);
RESULT:
	mySQL: ERROR - (1305, 'FUNCTION test.pg_get_partkeydef does not exist')

-----------
QUERY:


-- test rename for a rule defined on a partitioned table
CREATE TABLE rules_parted_table (a int) PARTITION BY LIST (a);
RESULT:
	mySQL: ERROR - (1492, 'For LIST partitions each partition must be defined')

-----------
QUERY:

CREATE TABLE rules_parted_table_1 PARTITION OF rules_parted_table FOR VALUES IN (1);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'OF rules_parted_table FOR VALUES IN (1)' at line 1")

-----------
QUERY:

CREATE RULE rules_parted_table_insert AS ON INSERT to rules_parted_table
    DO INSTEAD INSERT INTO rules_parted_table_1 VALUES (NEW.*);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rules_parted_table_insert AS ON INSERT to rules_parted_table\n    DO INSTEAD' at line 1")

-----------
QUERY:

ALTER RULE rules_parted_table_insert ON rules_parted_table RENAME TO rules_parted_table_insert_redirect;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rules_parted_table_insert ON rules_parted_table RENAME TO rules_parted_tabl' at line 1")

-----------
QUERY:

DROP TABLE rules_parted_table;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.rules_parted_table'")

-----------
QUERY:


--
-- test MERGE
--
CREATE TABLE rule_merge1 (a int, b text);
RESULT:
	mySQL: []

-----------
QUERY:

CREATE TABLE rule_merge2 (a int, b text);
RESULT:
	mySQL: []

-----------
QUERY:

CREATE RULE rule1 AS ON INSERT TO rule_merge1
	DO INSTEAD INSERT INTO rule_merge2 VALUES (NEW.*);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule1 AS ON INSERT TO rule_merge1\n\tDO INSTEAD INSERT INTO rule_merge2 VALUE' at line 1")

-----------
QUERY:

CREATE RULE rule2 AS ON UPDATE TO rule_merge1
	DO INSTEAD UPDATE rule_merge2 SET a = NEW.a, b = NEW.b
	WHERE a = OLD.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule2 AS ON UPDATE TO rule_merge1\n\tDO INSTEAD UPDATE rule_merge2 SET a = NE' at line 1")

-----------
QUERY:

CREATE RULE rule3 AS ON DELETE TO rule_merge1
	DO INSTEAD DELETE FROM rule_merge2 WHERE a = OLD.a;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule3 AS ON DELETE TO rule_merge1\n\tDO INSTEAD DELETE FROM rule_merge2 WHERE' at line 1")

-----------
QUERY:


-- MERGE not supported for table with rules
MERGE INTO rule_merge1 t USING (SELECT 1 AS a) s
	ON t.a = s.a
	WHEN MATCHED AND t.a < 2 THEN
		UPDATE SET b = b || ' updated by merge'
	WHEN MATCHED AND t.a > 2 THEN
		DELETE
	WHEN NOT MATCHED THEN
		INSERT VALUES (s.a, '');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'MERGE INTO rule_merge1 t USING (SELECT 1 AS a) s\n\tON t.a = s.a\n\tWHEN MATCHED AND' at line 2")

-----------
QUERY:


-- should be ok with the other table though
MERGE INTO rule_merge2 t USING (SELECT 1 AS a) s
	ON t.a = s.a
	WHEN MATCHED AND t.a < 2 THEN
		UPDATE SET b = b || ' updated by merge'
	WHEN MATCHED AND t.a > 2 THEN
		DELETE
	WHEN NOT MATCHED THEN
		INSERT VALUES (s.a, '');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'MERGE INTO rule_merge2 t USING (SELECT 1 AS a) s\n\tON t.a = s.a\n\tWHEN MATCHED AND' at line 2")

-----------
QUERY:


-- also ok if the rules are disabled
ALTER TABLE rule_merge1 DISABLE RULE rule1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule1' at line 2")

-----------
QUERY:

ALTER TABLE rule_merge1 DISABLE RULE rule2;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule2' at line 1")

-----------
QUERY:

ALTER TABLE rule_merge1 DISABLE RULE rule3;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule3' at line 1")

-----------
QUERY:

MERGE INTO rule_merge1 t USING (SELECT 1 AS a) s
	ON t.a = s.a
	WHEN MATCHED AND t.a < 2 THEN
		UPDATE SET b = b || ' updated by merge'
	WHEN MATCHED AND t.a > 2 THEN
		DELETE
	WHEN NOT MATCHED THEN
		INSERT VALUES (s.a, '');
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'MERGE INTO rule_merge1 t USING (SELECT 1 AS a) s\n\tON t.a = s.a\n\tWHEN MATCHED AND' at line 1")

-----------
QUERY:


-- test deparsing
CREATE TABLE sf_target(id int, data text, filling int[]);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '[])' at line 2")

-----------
QUERY:


CREATE FUNCTION merge_sf_test()
 RETURNS TABLE(action text, a int, b text, id int, data text, filling int[])
 LANGUAGE sql
BEGIN ATOMIC
 MERGE INTO sf_target t
   USING rule_merge1 s
   ON (s.a = t.id)
WHEN MATCHED
   AND (s.a + t.id) = 42
   THEN UPDATE SET data = repeat(t.data, s.a) || s.b, id = length(s.b)
WHEN NOT MATCHED
   AND (s.b IS NOT NULL)
   THEN INSERT (data, id)
   VALUES (s.b, s.a)
WHEN MATCHED
   AND length(s.b || t.data) > 10
   THEN UPDATE SET data = s.b
WHEN MATCHED
   AND s.a > 200
   THEN UPDATE SET filling[s.a] = t.id
WHEN MATCHED
   AND s.a > 100
   THEN DELETE
WHEN MATCHED
   THEN DO NOTHING
WHEN NOT MATCHED
   AND s.a > 200
   THEN INSERT DEFAULT VALUES
WHEN NOT MATCHED
   AND s.a > 100
   THEN INSERT (id, data) OVERRIDING USER VALUE
   VALUES (s.a, DEFAULT)
WHEN NOT MATCHED
   AND s.a > 0
   THEN INSERT
   VALUES (s.a, s.b, DEFAULT)
WHEN NOT MATCHED
   THEN INSERT (filling[1], id)
   VALUES (s.a, s.a)
RETURNING
   merge_action() AS action, *;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'TABLE(action text, a int, b text, id int, data text, filling int[])\n LANGUAGE sq' at line 2")

-----------
QUERY:

END;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'END' at line 1")

-----------
QUERY:


\sf merge_sf_test

DROP FUNCTION merge_sf_test;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\\sf merge_sf_test\n\nDROP FUNCTION merge_sf_test' at line 1")

-----------
QUERY:

DROP TABLE sf_target;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.sf_target'")

-----------
QUERY:


--
-- Test enabling/disabling
--
CREATE TABLE ruletest1 (a int);
RESULT:
	mySQL: []

-----------
QUERY:

CREATE TABLE ruletest2 (b int);
RESULT:
	mySQL: []

-----------
QUERY:


CREATE RULE rule1 AS ON INSERT TO ruletest1
    DO INSTEAD INSERT INTO ruletest2 VALUES (NEW.*);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule1 AS ON INSERT TO ruletest1\n    DO INSTEAD INSERT INTO ruletest2 VALUES' at line 1")

-----------
QUERY:


INSERT INTO ruletest1 VALUES (1);
RESULT:
	mySQL: []

-----------
QUERY:

ALTER TABLE ruletest1 DISABLE RULE rule1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule1' at line 1")

-----------
QUERY:

INSERT INTO ruletest1 VALUES (2);
RESULT:
	mySQL: []

-----------
QUERY:

ALTER TABLE ruletest1 ENABLE RULE rule1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule1' at line 1")

-----------
QUERY:

SET session_replication_role = replica;
RESULT:
	mySQL: ERROR - (1193, "Unknown system variable 'session_replication_role'")

-----------
QUERY:

INSERT INTO ruletest1 VALUES (3);
RESULT:
	mySQL: []

-----------
QUERY:

ALTER TABLE ruletest1 ENABLE REPLICA RULE rule1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'REPLICA RULE rule1' at line 1")

-----------
QUERY:

INSERT INTO ruletest1 VALUES (4);
RESULT:
	mySQL: []

-----------
QUERY:

RESET session_replication_role;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'session_replication_role' at line 1")

-----------
QUERY:

INSERT INTO ruletest1 VALUES (5);
RESULT:
	mySQL: []

-----------
QUERY:


SELECT * FROM ruletest1;
RESULT:
	mySQL: ((1,), (2,), (3,), (4,), (5,))

-----------
QUERY:

SELECT * FROM ruletest2;
RESULT:
	mySQL: ()

-----------
QUERY:


DROP TABLE ruletest1;
RESULT:
	mySQL: []

-----------
QUERY:

DROP TABLE ruletest2;
RESULT:
	mySQL: []

-----------
QUERY:


--
-- Test non-SELECT rule on security invoker view.
-- Should use view owner/* REPLACED */''s permissions.
--
CREATE USER regress_rule_user1;
RESULT:
	mySQL: []

-----------
QUERY:


CREATE TABLE ruletest_t1 (x int);
RESULT:
	mySQL: []

-----------
QUERY:

CREATE TABLE ruletest_t2 (x int);
RESULT:
	mySQL: []

-----------
QUERY:

CREATE VIEW ruletest_v1 WITH (security_invoker=true) AS
    SELECT * FROM ruletest_t1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'WITH (security_invoker=true) AS\n    SELECT * FROM ruletest_t1' at line 1")

-----------
QUERY:

GRANT INSERT ON ruletest_v1 TO regress_rule_user1;
RESULT:
	mySQL: ERROR - (1146, "Table 'test.ruletest_v1' doesn't exist")

-----------
QUERY:


CREATE RULE rule1 AS ON INSERT TO ruletest_v1
    DO INSTEAD INSERT INTO ruletest_t2 VALUES (NEW.*);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule1 AS ON INSERT TO ruletest_v1\n    DO INSTEAD INSERT INTO ruletest_t2 VA' at line 1")

-----------
QUERY:


SET SESSION AUTHORIZATION regress_rule_user1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'regress_rule_user1' at line 1")

-----------
QUERY:

INSERT INTO ruletest_v1 VALUES (1);
RESULT:
	mySQL: ERROR - (1146, "Table 'test.ruletest_v1' doesn't exist")

-----------
QUERY:


RESET SESSION AUTHORIZATION;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'SESSION AUTHORIZATION' at line 1")

-----------
QUERY:


-- Test that main query/* REPLACED */''s relation/* REPLACED */''s permissions are checked before
-- the rule action/* REPLACED */''s relation/* REPLACED */''s.
CREATE TABLE ruletest_t3 (x int);
RESULT:
	mySQL: []

-----------
QUERY:

CREATE RULE rule2 AS ON UPDATE TO ruletest_t1
    DO INSTEAD INSERT INTO ruletest_t2 VALUES (OLD.*);
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule2 AS ON UPDATE TO ruletest_t1\n    DO INSTEAD INSERT INTO ruletest_t2 VA' at line 1")

-----------
QUERY:

REVOKE ALL ON ruletest_t2 FROM regress_rule_user1;
RESULT:
	mySQL: ERROR - (1147, "There is no such grant defined for user 'regress_rule_user1' on host '%' on table 'ruletest_t2'")

-----------
QUERY:

REVOKE ALL ON ruletest_t3 FROM regress_rule_user1;
RESULT:
	mySQL: ERROR - (1147, "There is no such grant defined for user 'regress_rule_user1' on host '%' on table 'ruletest_t3'")

-----------
QUERY:

ALTER TABLE ruletest_t1 OWNER TO regress_rule_user1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'OWNER TO regress_rule_user1' at line 1")

-----------
QUERY:

SET SESSION AUTHORIZATION regress_rule_user1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'regress_rule_user1' at line 1")

-----------
QUERY:

UPDATE ruletest_t1 t1 SET x = 0 FROM ruletest_t3 t3 WHERE t1.x = t3.x;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'FROM ruletest_t3 t3 WHERE t1.x = t3.x' at line 1")

-----------
QUERY:


RESET SESSION AUTHORIZATION;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'SESSION AUTHORIZATION' at line 1")

-----------
QUERY:

SELECT * FROM ruletest_t1;
RESULT:
	mySQL: ()

-----------
QUERY:

SELECT * FROM ruletest_t2;
RESULT:
	mySQL: ()

-----------
QUERY:


DROP VIEW ruletest_v1;
RESULT:
	mySQL: ERROR - (1051, "Unknown table 'test.ruletest_v1'")

-----------
QUERY:

DROP RULE rule2 ON ruletest_t1;
RESULT:
	mySQL: ERROR - (1064, "You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'RULE rule2 ON ruletest_t1' at line 1")

-----------
QUERY:

DROP TABLE ruletest_t3;
RESULT:
	mySQL: []

-----------
QUERY:

DROP TABLE ruletest_t2;
RESULT:
	mySQL: []

-----------
QUERY:

DROP TABLE ruletest_t1;
RESULT:
	mySQL: []

-----------
QUERY:


DROP USER regress_rule_user1;
RESULT:
	mySQL: []
