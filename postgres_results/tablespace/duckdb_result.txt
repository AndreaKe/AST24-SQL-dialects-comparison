-- relative tablespace locations are not allowed
CREATE TABLESPACE regress_tblspace LOCATION 'relative'
ERROR: -- relative tablespace locations are not allowed
CREATE TABLESPACE regress_tblspace LOCATION 'relative'

Parser Error: syntax error at or near "TABLESPACE"
 -- fail

-- empty tablespace locations are not usually allowed
CREATE TABLESPACE regress_tblspace LOCATION ''
ERROR:  -- fail

-- empty tablespace locations are not usually allowed
CREATE TABLESPACE regress_tblspace LOCATION ''

Parser Error: syntax error at or near "TABLESPACE"
 -- fail

-- as a special developer-only option to allow us to use tablespaces
-- with streaming replication on the same server, an empty location
-- can be allowed as a way to say that the tablespace should be created
-- as a directory in pg_tblspc, rather than being a symlink
SET allow_in_place_tablespaces = true
ERROR:  -- fail

-- as a special developer-only option to allow us to use tablespaces
-- with streaming replication on the same server, an empty location
-- can be allowed as a way to say that the tablespace should be created
-- as a directory in pg_tblspc, rather than being a symlink
SET allow_in_place_tablespaces = true

Catalog Error: unrecognized configuration parameter "allow_in_place_tablespaces"

Did you mean: "allow_unredacted_secrets"


-- create a tablespace using WITH clause
CREATE TABLESPACE regress_tblspacewith LOCATION '' WITH (some_nonexistent_parameter = true)
ERROR: 

-- create a tablespace using WITH clause
CREATE TABLESPACE regress_tblspacewith LOCATION '' WITH (some_nonexistent_parameter = true)

Parser Error: syntax error at or near "TABLESPACE"
 -- fail
CREATE TABLESPACE regress_tblspacewith LOCATION '' WITH (random_page_cost = 3.0)
ERROR:  -- fail
CREATE TABLESPACE regress_tblspacewith LOCATION '' WITH (random_page_cost = 3.0)

Parser Error: syntax error at or near "TABLESPACE"
 -- ok

-- check to see the parameter was used
SELECT spcoptions FROM pg_tablespace WHERE spcname = 'regress_tblspacewith'
RESULT: 
	[]


-- drop the tablespace so we can re-use the location
DROP TABLESPACE regress_tblspacewith
ERROR: 

-- drop the tablespace so we can re-use the location
DROP TABLESPACE regress_tblspacewith

Parser Error: syntax error at or near "TABLESPACE"


-- This returns a relative path as of an effect of allow_in_place_tablespaces,
-- masking the tablespace OID used in the path name.
SELECT regexp_replace(pg_tablespace_location(oid), '(pg_tblspc)/(\d+)', '\1/NNN')
  FROM pg_tablespace  WHERE spcname = 'regress_tblspace'
ERROR: 

-- This returns a relative path as of an effect of allow_in_place_tablespaces,
-- masking the tablespace OID used in the path name.
SELECT regexp_replace(pg_tablespace_location(oid), '(pg_tblspc)/(\d+)', '\1/NNN')
  FROM pg_tablespace  WHERE spcname = 'regress_tblspace'

Catalog Error: Scalar Function with name pg_tablespace_location does not exist!
Did you mean "pg_typeof"?


-- try setting and resetting some properties for the new tablespace
ALTER TABLESPACE regress_tblspace SET (random_page_cost = 1.0, seq_page_cost = 1.1)
ERROR: 

-- try setting and resetting some properties for the new tablespace
ALTER TABLESPACE regress_tblspace SET (random_page_cost = 1.0, seq_page_cost = 1.1)

Parser Error: syntax error at or near "TABLESPACE"

ALTER TABLESPACE regress_tblspace SET (some_nonexistent_parameter = true)
ERROR: 
ALTER TABLESPACE regress_tblspace SET (some_nonexistent_parameter = true)

Parser Error: syntax error at or near "TABLESPACE"
  -- fail
ALTER TABLESPACE regress_tblspace RESET (random_page_cost = 2.0)
ERROR:   -- fail
ALTER TABLESPACE regress_tblspace RESET (random_page_cost = 2.0)

Parser Error: syntax error at or near "TABLESPACE"
 -- fail
ALTER TABLESPACE regress_tblspace RESET (random_page_cost, effective_io_concurrency)
ERROR:  -- fail
ALTER TABLESPACE regress_tblspace RESET (random_page_cost, effective_io_concurrency)

Parser Error: syntax error at or near "TABLESPACE"
 -- ok

-- REINDEX (TABLESPACE)
-- catalogs and system tablespaces
-- system catalog, fail
REINDEX (TABLESPACE regress_tblspace) TABLE pg_am
ERROR:  -- ok

-- REINDEX (TABLESPACE)
-- catalogs and system tablespaces
-- system catalog, fail
REINDEX (TABLESPACE regress_tblspace) TABLE pg_am

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE regress_tblspace) TABLE CONCURRENTLY pg_am
ERROR: 
REINDEX (TABLESPACE regress_tblspace) TABLE CONCURRENTLY pg_am

Parser Error: syntax error at or near "REINDEX"

-- shared catalog, fail
REINDEX (TABLESPACE regress_tblspace) TABLE pg_authid
ERROR: 
-- shared catalog, fail
REINDEX (TABLESPACE regress_tblspace) TABLE pg_authid

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE regress_tblspace) TABLE CONCURRENTLY pg_authid
ERROR: 
REINDEX (TABLESPACE regress_tblspace) TABLE CONCURRENTLY pg_authid

Parser Error: syntax error at or near "REINDEX"

-- toast relations, fail
REINDEX (TABLESPACE regress_tblspace) INDEX pg_toast.pg_toast_1260_index
ERROR: 
-- toast relations, fail
REINDEX (TABLESPACE regress_tblspace) INDEX pg_toast.pg_toast_1260_index

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE regress_tblspace) INDEX CONCURRENTLY pg_toast.pg_toast_1260_index
ERROR: 
REINDEX (TABLESPACE regress_tblspace) INDEX CONCURRENTLY pg_toast.pg_toast_1260_index

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE regress_tblspace) TABLE pg_toast.pg_toast_1260
ERROR: 
REINDEX (TABLESPACE regress_tblspace) TABLE pg_toast.pg_toast_1260

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE regress_tblspace) TABLE CONCURRENTLY pg_toast.pg_toast_1260
ERROR: 
REINDEX (TABLESPACE regress_tblspace) TABLE CONCURRENTLY pg_toast.pg_toast_1260

Parser Error: syntax error at or near "REINDEX"

-- system catalog, fail
REINDEX (TABLESPACE pg_global) TABLE pg_authid
ERROR: 
-- system catalog, fail
REINDEX (TABLESPACE pg_global) TABLE pg_authid

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE pg_global) TABLE CONCURRENTLY pg_authid
ERROR: 
REINDEX (TABLESPACE pg_global) TABLE CONCURRENTLY pg_authid

Parser Error: syntax error at or near "REINDEX"


-- table with toast relation
CREATE TABLE regress_tblspace_test_tbl (num1 bigint, num2 double precision, t text)

INSERT INTO regress_tblspace_test_tbl (num1, num2, t)
  SELECT round(random()*100), random(), 'text'
  FROM generate_series(1, 10) s(i)

CREATE INDEX regress_tblspace_test_tbl_idx ON regress_tblspace_test_tbl (num1)

-- move to global tablespace, fail
REINDEX (TABLESPACE pg_global) INDEX regress_tblspace_test_tbl_idx
ERROR: 
-- move to global tablespace, fail
REINDEX (TABLESPACE pg_global) INDEX regress_tblspace_test_tbl_idx

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE pg_global) INDEX CONCURRENTLY regress_tblspace_test_tbl_idx
ERROR: 
REINDEX (TABLESPACE pg_global) INDEX CONCURRENTLY regress_tblspace_test_tbl_idx

Parser Error: syntax error at or near "REINDEX"


-- check transactional behavior of REINDEX (TABLESPACE)
BEGIN

REINDEX (TABLESPACE regress_tblspace) INDEX regress_tblspace_test_tbl_idx
ERROR: 
REINDEX (TABLESPACE regress_tblspace) INDEX regress_tblspace_test_tbl_idx

Parser Error: syntax error at or near "REINDEX"

REINDEX (TABLESPACE regress_tblspace) TABLE regress_tblspace_test_tbl
ERROR: 
REINDEX (TABLESPACE regress_tblspace) TABLE regress_tblspace_test_tbl

Parser Error: syntax error at or near "REINDEX"

ROLLBACK

-- no relation moved to the new tablespace
SELECT c.relname FROM pg_class c, pg_tablespace s
  WHERE c.reltablespace = s.oid AND s.spcname = 'regress_tblspace'
RESULT: 
	[]


-- check that all indexes are moved to a new tablespace with different
-- relfilenode.
-- Save first the existing relfilenode for the toast and main relations.
SELECT relfilenode as main_filenode FROM pg_class
  WHERE relname = 'regress_tblspace_test_tbl_idx' \gset
SELECT relfilenode as toast_filenode FROM pg_class
  WHERE oid =
    (SELECT i.indexrelid
       FROM pg_class c,
            pg_index i
       WHERE i.indrelid = c.reltoastrelid AND
             c.relname = 'regress_tblspace_test_tbl') \gset
REINDEX (TABLESPACE regress_tblspace) TABLE regress_tblspace_test_tbl
ERROR: 

-- check that all indexes are moved to a new tablespace with different
-- relfilenode.
-- Save first the existing relfilenode for the toast and main relations.
SELECT relfilenode as main_filenode FROM pg_class
  WHERE relname = 'regress_tblspace_test_tbl_idx' \gset
SELECT relfilenode as toast_filenode FROM pg_class
  WHERE oid =
    (SELECT i.indexrelid
       FROM pg_class c,
            pg_index i
       WHERE i.indrelid = c.reltoastrelid AND
             c.relname = 'regress_tblspace_test_tbl') \gset
REINDEX (TABLESPACE regress_tblspace) TABLE regress_tblspace_test_tbl

Parser Error: syntax error at or near "\"

SELECT c.relname FROM pg_class c, pg_tablespace s
  WHERE c.reltablespace = s.oid AND s.spcname = 'regress_tblspace'
  ORDER BY c.relname
RESULT: 
	[]

ALTER TABLE regress_tblspace_test_tbl SET TABLESPACE regress_tblspace
ERROR: 
ALTER TABLE regress_tblspace_test_tbl SET TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

ALTER TABLE regress_tblspace_test_tbl SET TABLESPACE pg_default
ERROR: 
ALTER TABLE regress_tblspace_test_tbl SET TABLESPACE pg_default

Parser Error: syntax error at or near "TABLESPACE"

SELECT c.relname FROM pg_class c, pg_tablespace s
  WHERE c.reltablespace = s.oid AND s.spcname = 'regress_tblspace'
  ORDER BY c.relname
RESULT: 
	[]

-- Move back to the default tablespace.
ALTER INDEX regress_tblspace_test_tbl_idx SET TABLESPACE pg_default
ERROR: 
-- Move back to the default tablespace.
ALTER INDEX regress_tblspace_test_tbl_idx SET TABLESPACE pg_default

Parser Error: syntax error at or near "TABLESPACE"

SELECT c.relname FROM pg_class c, pg_tablespace s
  WHERE c.reltablespace = s.oid AND s.spcname = 'regress_tblspace'
  ORDER BY c.relname
RESULT: 
	[]

REINDEX (TABLESPACE regress_tblspace, CONCURRENTLY) TABLE regress_tblspace_test_tbl
ERROR: 
REINDEX (TABLESPACE regress_tblspace, CONCURRENTLY) TABLE regress_tblspace_test_tbl

Parser Error: syntax error at or near "REINDEX"

SELECT c.relname FROM pg_class c, pg_tablespace s
  WHERE c.reltablespace = s.oid AND s.spcname = 'regress_tblspace'
  ORDER BY c.relname
RESULT: 
	[]

SELECT relfilenode = :main_filenode AS main_same FROM pg_class
  WHERE relname = 'regress_tblspace_test_tbl_idx'
ERROR: 
SELECT relfilenode = :main_filenode AS main_same FROM pg_class
  WHERE relname = 'regress_tblspace_test_tbl_idx'

Parser Error: syntax error at or near ":"

SELECT relfilenode = :toast_filenode as toast_same FROM pg_class
  WHERE oid =
    (SELECT i.indexrelid
       FROM pg_class c,
            pg_index i
       WHERE i.indrelid = c.reltoastrelid AND
             c.relname = 'regress_tblspace_test_tbl')
ERROR: 
SELECT relfilenode = :toast_filenode as toast_same FROM pg_class
  WHERE oid =
    (SELECT i.indexrelid
       FROM pg_class c,
            pg_index i
       WHERE i.indrelid = c.reltoastrelid AND
             c.relname = 'regress_tblspace_test_tbl')

Parser Error: syntax error at or near ":"

DROP TABLE regress_tblspace_test_tbl


-- REINDEX (TABLESPACE) with partitions
-- Create a partition tree and check the set of relations reindexed
-- with their new tablespace.
CREATE TABLE tbspace_reindex_part (c1 int, c2 int) PARTITION BY RANGE (c1)
ERROR: 

-- REINDEX (TABLESPACE) with partitions
-- Create a partition tree and check the set of relations reindexed
-- with their new tablespace.
CREATE TABLE tbspace_reindex_part (c1 int, c2 int) PARTITION BY RANGE (c1)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE tbspace_reindex_part_0 PARTITION OF tbspace_reindex_part
  FOR VALUES FROM (0) TO (10) PARTITION BY list (c2)
ERROR: 
CREATE TABLE tbspace_reindex_part_0 PARTITION OF tbspace_reindex_part
  FOR VALUES FROM (0) TO (10) PARTITION BY list (c2)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE tbspace_reindex_part_0_1 PARTITION OF tbspace_reindex_part_0
  FOR VALUES IN (1)
ERROR: 
CREATE TABLE tbspace_reindex_part_0_1 PARTITION OF tbspace_reindex_part_0
  FOR VALUES IN (1)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE tbspace_reindex_part_0_2 PARTITION OF tbspace_reindex_part_0
  FOR VALUES IN (2)
ERROR: 
CREATE TABLE tbspace_reindex_part_0_2 PARTITION OF tbspace_reindex_part_0
  FOR VALUES IN (2)

Parser Error: syntax error at or near "PARTITION"

-- This partitioned table will have no partitions.
CREATE TABLE tbspace_reindex_part_10 PARTITION OF tbspace_reindex_part
   FOR VALUES FROM (10) TO (20) PARTITION BY list (c2)
ERROR: 
-- This partitioned table will have no partitions.
CREATE TABLE tbspace_reindex_part_10 PARTITION OF tbspace_reindex_part
   FOR VALUES FROM (10) TO (20) PARTITION BY list (c2)

Parser Error: syntax error at or near "PARTITION"

-- Create some partitioned indexes
CREATE INDEX tbspace_reindex_part_index ON ONLY tbspace_reindex_part (c1)
ERROR: 
-- Create some partitioned indexes
CREATE INDEX tbspace_reindex_part_index ON ONLY tbspace_reindex_part (c1)

Parser Error: syntax error at or near "ONLY"

CREATE INDEX tbspace_reindex_part_index_0 ON ONLY tbspace_reindex_part_0 (c1)
ERROR: 
CREATE INDEX tbspace_reindex_part_index_0 ON ONLY tbspace_reindex_part_0 (c1)

Parser Error: syntax error at or near "ONLY"

ALTER INDEX tbspace_reindex_part_index ATTACH PARTITION tbspace_reindex_part_index_0
ERROR: 
ALTER INDEX tbspace_reindex_part_index ATTACH PARTITION tbspace_reindex_part_index_0

Parser Error: syntax error at or near "ATTACH"

-- This partitioned index will have no partitions.
CREATE INDEX tbspace_reindex_part_index_10 ON ONLY tbspace_reindex_part_10 (c1)
ERROR: 
-- This partitioned index will have no partitions.
CREATE INDEX tbspace_reindex_part_index_10 ON ONLY tbspace_reindex_part_10 (c1)

Parser Error: syntax error at or near "ONLY"

ALTER INDEX tbspace_reindex_part_index ATTACH PARTITION tbspace_reindex_part_index_10
ERROR: 
ALTER INDEX tbspace_reindex_part_index ATTACH PARTITION tbspace_reindex_part_index_10

Parser Error: syntax error at or near "ATTACH"

CREATE INDEX tbspace_reindex_part_index_0_1 ON ONLY tbspace_reindex_part_0_1 (c1)
ERROR: 
CREATE INDEX tbspace_reindex_part_index_0_1 ON ONLY tbspace_reindex_part_0_1 (c1)

Parser Error: syntax error at or near "ONLY"

ALTER INDEX tbspace_reindex_part_index_0 ATTACH PARTITION tbspace_reindex_part_index_0_1
ERROR: 
ALTER INDEX tbspace_reindex_part_index_0 ATTACH PARTITION tbspace_reindex_part_index_0_1

Parser Error: syntax error at or near "ATTACH"

CREATE INDEX tbspace_reindex_part_index_0_2 ON ONLY tbspace_reindex_part_0_2 (c1)
ERROR: 
CREATE INDEX tbspace_reindex_part_index_0_2 ON ONLY tbspace_reindex_part_0_2 (c1)

Parser Error: syntax error at or near "ONLY"

ALTER INDEX tbspace_reindex_part_index_0 ATTACH PARTITION tbspace_reindex_part_index_0_2
ERROR: 
ALTER INDEX tbspace_reindex_part_index_0 ATTACH PARTITION tbspace_reindex_part_index_0_2

Parser Error: syntax error at or near "ATTACH"

SELECT relid, parentrelid, level FROM pg_partition_tree('tbspace_reindex_part_index')
  ORDER BY relid, level
ERROR: 
SELECT relid, parentrelid, level FROM pg_partition_tree('tbspace_reindex_part_index')
  ORDER BY relid, level

Catalog Error: Table Function with name pg_partition_tree does not exist!
Did you mean "pg_timezone_names"?

-- Track the original tablespace, relfilenode and OID of each index
-- in the tree.
CREATE TEMP TABLE reindex_temp_before AS
  SELECT oid, relname, relfilenode, reltablespace
  FROM pg_class
    WHERE relname ~ 'tbspace_reindex_part_index'

REINDEX (TABLESPACE regress_tblspace, CONCURRENTLY) TABLE tbspace_reindex_part
ERROR: 
REINDEX (TABLESPACE regress_tblspace, CONCURRENTLY) TABLE tbspace_reindex_part

Parser Error: syntax error at or near "REINDEX"

-- REINDEX CONCURRENTLY changes the OID of the old relation, hence a check
-- based on the relation name below.
SELECT b.relname,
       CASE WHEN a.relfilenode = b.relfilenode THEN 'relfilenode is unchanged'
       ELSE 'relfilenode has changed' END AS filenode,
       CASE WHEN a.reltablespace = b.reltablespace THEN 'reltablespace is unchanged'
       ELSE 'reltablespace has changed' END AS tbspace
  FROM reindex_temp_before b JOIN pg_class a ON b.relname = a.relname
  ORDER BY 1
RESULT: 
	[]

DROP TABLE tbspace_reindex_part
ERROR: 
DROP TABLE tbspace_reindex_part

Catalog Error: Table with name tbspace_reindex_part does not exist!
Did you mean "pg_index"?


-- create a schema we can use
CREATE SCHEMA testschema


-- try a table
CREATE TABLE testschema.foo (i int) TABLESPACE regress_tblspace
ERROR: 

-- try a table
CREATE TABLE testschema.foo (i int) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'foo'
RESULT: 
	[]


INSERT INTO testschema.foo VALUES(1)
ERROR: 

INSERT INTO testschema.foo VALUES(1)

Catalog Error: Table with name foo does not exist!
Did you mean "temp.pg_catalog.pg_am"?

INSERT INTO testschema.foo VALUES(2)
ERROR: 
INSERT INTO testschema.foo VALUES(2)

Catalog Error: Table with name foo does not exist!
Did you mean "temp.pg_catalog.pg_am"?


-- tables from dynamic sources
CREATE TABLE testschema.asselect TABLESPACE regress_tblspace AS SELECT 1
ERROR: 

-- tables from dynamic sources
CREATE TABLE testschema.asselect TABLESPACE regress_tblspace AS SELECT 1

Parser Error: syntax error at or near "TABLESPACE"

SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'asselect'
RESULT: 
	[]


PREPARE selectsource(int) AS SELECT $1
ERROR: 

PREPARE selectsource(int) AS SELECT $1

Not implemented Error: Prepared statement argument types are not supported, use CAST

CREATE TABLE testschema.asexecute TABLESPACE regress_tblspace
    AS EXECUTE selectsource(2)
ERROR: 
CREATE TABLE testschema.asexecute TABLESPACE regress_tblspace
    AS EXECUTE selectsource(2)

Parser Error: syntax error at or near "TABLESPACE"

SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'asexecute'
RESULT: 
	[]


-- index
CREATE INDEX foo_idx on testschema.foo(i) TABLESPACE regress_tblspace
ERROR: 

-- index
CREATE INDEX foo_idx on testschema.foo(i) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname = 'foo_idx'
RESULT: 
	[]


-- check \d output
-- \d testschema.foo
-- \d testschema.foo_idx

--
-- partitioned table
--
CREATE TABLE testschema.part (a int) PARTITION BY LIST (a)
ERROR: 

-- check \d output
-- \d testschema.foo
-- \d testschema.foo_idx

--
-- partitioned table
--
CREATE TABLE testschema.part (a int) PARTITION BY LIST (a)

Parser Error: syntax error at or near "PARTITION"

SET default_tablespace TO pg_global
ERROR: 
SET default_tablespace TO pg_global

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE TABLE testschema.part_1 PARTITION OF testschema.part FOR VALUES IN (1)
ERROR: 
CREATE TABLE testschema.part_1 PARTITION OF testschema.part FOR VALUES IN (1)

Parser Error: syntax error at or near "PARTITION"

RESET default_tablespace
ERROR: 
RESET default_tablespace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE TABLE testschema.part_1 PARTITION OF testschema.part FOR VALUES IN (1)
ERROR: 
CREATE TABLE testschema.part_1 PARTITION OF testschema.part FOR VALUES IN (1)

Parser Error: syntax error at or near "PARTITION"

SET default_tablespace TO regress_tblspace
ERROR: 
SET default_tablespace TO regress_tblspace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE TABLE testschema.part_2 PARTITION OF testschema.part FOR VALUES IN (2)
ERROR: 
CREATE TABLE testschema.part_2 PARTITION OF testschema.part FOR VALUES IN (2)

Parser Error: syntax error at or near "PARTITION"

SET default_tablespace TO pg_global
ERROR: 
SET default_tablespace TO pg_global

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE TABLE testschema.part_3 PARTITION OF testschema.part FOR VALUES IN (3)
ERROR: 
CREATE TABLE testschema.part_3 PARTITION OF testschema.part FOR VALUES IN (3)

Parser Error: syntax error at or near "PARTITION"

ALTER TABLE testschema.part SET TABLESPACE regress_tblspace
ERROR: 
ALTER TABLE testschema.part SET TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

CREATE TABLE testschema.part_3 PARTITION OF testschema.part FOR VALUES IN (3)
ERROR: 
CREATE TABLE testschema.part_3 PARTITION OF testschema.part FOR VALUES IN (3)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE testschema.part_4 PARTITION OF testschema.part FOR VALUES IN (4)
  TABLESPACE pg_default
ERROR: 
CREATE TABLE testschema.part_4 PARTITION OF testschema.part FOR VALUES IN (4)
  TABLESPACE pg_default

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE testschema.part_56 PARTITION OF testschema.part FOR VALUES IN (5, 6)
  PARTITION BY LIST (a)
ERROR: 
CREATE TABLE testschema.part_56 PARTITION OF testschema.part FOR VALUES IN (5, 6)
  PARTITION BY LIST (a)

Parser Error: syntax error at or near "PARTITION"

ALTER TABLE testschema.part SET TABLESPACE pg_default
ERROR: 
ALTER TABLE testschema.part SET TABLESPACE pg_default

Parser Error: syntax error at or near "TABLESPACE"

CREATE TABLE testschema.part_78 PARTITION OF testschema.part FOR VALUES IN (7, 8)
  PARTITION BY LIST (a)
ERROR: 
CREATE TABLE testschema.part_78 PARTITION OF testschema.part FOR VALUES IN (7, 8)
  PARTITION BY LIST (a)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE testschema.part_910 PARTITION OF testschema.part FOR VALUES IN (9, 10)
  PARTITION BY LIST (a) TABLESPACE regress_tblspace
ERROR: 
CREATE TABLE testschema.part_910 PARTITION OF testschema.part FOR VALUES IN (9, 10)
  PARTITION BY LIST (a) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "PARTITION"

RESET default_tablespace
ERROR: 
RESET default_tablespace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE TABLE testschema.part_78 PARTITION OF testschema.part FOR VALUES IN (7, 8)
  PARTITION BY LIST (a)
ERROR: 
CREATE TABLE testschema.part_78 PARTITION OF testschema.part FOR VALUES IN (7, 8)
  PARTITION BY LIST (a)

Parser Error: syntax error at or near "PARTITION"


SELECT relname, spcname FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON (c.relnamespace = n.oid)
    LEFT JOIN pg_catalog.pg_tablespace t ON c.reltablespace = t.oid
    where c.relname LIKE 'part%' AND n.nspname = 'testschema' order by relname
RESULT: 
	[]

RESET default_tablespace
ERROR: 
RESET default_tablespace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

DROP TABLE testschema.part
ERROR: 
DROP TABLE testschema.part

Catalog Error: Table with name part does not exist!
Did you mean "temp.pg_catalog.pg_am"?


-- partitioned index
CREATE TABLE testschema.part (a int) PARTITION BY LIST (a)
ERROR: 

-- partitioned index
CREATE TABLE testschema.part (a int) PARTITION BY LIST (a)

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE testschema.part1 PARTITION OF testschema.part FOR VALUES IN (1)
ERROR: 
CREATE TABLE testschema.part1 PARTITION OF testschema.part FOR VALUES IN (1)

Parser Error: syntax error at or near "PARTITION"

CREATE INDEX part_a_idx ON testschema.part (a) TABLESPACE regress_tblspace
ERROR: 
CREATE INDEX part_a_idx ON testschema.part (a) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

CREATE TABLE testschema.part2 PARTITION OF testschema.part FOR VALUES IN (2)
ERROR: 
CREATE TABLE testschema.part2 PARTITION OF testschema.part FOR VALUES IN (2)

Parser Error: syntax error at or near "PARTITION"

SELECT relname, spcname FROM pg_catalog.pg_tablespace t, pg_catalog.pg_class c
    where c.reltablespace = t.oid AND c.relname LIKE 'part%_idx' ORDER BY relname
RESULT: 
	[]

-- \d testschema.part
-- \d+ testschema.part
-- \d testschema.part1
-- \d+ testschema.part1
-- \d testschema.part_a_idx
-- \d+ testschema.part_a_idx

-- partitioned rels cannot specify the default tablespace.  These fail:
CREATE TABLE testschema.dflt (a int PRIMARY KEY) PARTITION BY LIST (a) TABLESPACE pg_default
ERROR: 
-- \d testschema.part
-- \d+ testschema.part
-- \d testschema.part1
-- \d+ testschema.part1
-- \d testschema.part_a_idx
-- \d+ testschema.part_a_idx

-- partitioned rels cannot specify the default tablespace.  These fail:
CREATE TABLE testschema.dflt (a int PRIMARY KEY) PARTITION BY LIST (a) TABLESPACE pg_default

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE testschema.dflt (a int PRIMARY KEY USING INDEX TABLESPACE pg_default) PARTITION BY LIST (a)
ERROR: 
CREATE TABLE testschema.dflt (a int PRIMARY KEY USING INDEX TABLESPACE pg_default) PARTITION BY LIST (a)

Parser Error: syntax error at or near "INDEX"

SET default_tablespace TO 'pg_default'
ERROR: 
SET default_tablespace TO 'pg_default'

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE TABLE testschema.dflt (a int PRIMARY KEY) PARTITION BY LIST (a) TABLESPACE regress_tblspace
ERROR: 
CREATE TABLE testschema.dflt (a int PRIMARY KEY) PARTITION BY LIST (a) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE testschema.dflt (a int PRIMARY KEY USING INDEX TABLESPACE regress_tblspace) PARTITION BY LIST (a)
ERROR: 
CREATE TABLE testschema.dflt (a int PRIMARY KEY USING INDEX TABLESPACE regress_tblspace) PARTITION BY LIST (a)

Parser Error: syntax error at or near "INDEX"

-- but these work:
CREATE TABLE testschema.dflt (a int PRIMARY KEY USING INDEX TABLESPACE regress_tblspace) PARTITION BY LIST (a) TABLESPACE regress_tblspace
ERROR: 
-- but these work:
CREATE TABLE testschema.dflt (a int PRIMARY KEY USING INDEX TABLESPACE regress_tblspace) PARTITION BY LIST (a) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "INDEX"

SET default_tablespace TO ''
ERROR: 
SET default_tablespace TO ''

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE TABLE testschema.dflt2 (a int PRIMARY KEY) PARTITION BY LIST (a)
ERROR: 
CREATE TABLE testschema.dflt2 (a int PRIMARY KEY) PARTITION BY LIST (a)

Parser Error: syntax error at or near "PARTITION"

DROP TABLE testschema.dflt, testschema.dflt2
ERROR: 
DROP TABLE testschema.dflt, testschema.dflt2

Not implemented Error: Can only drop one object at a time


-- check that default_tablespace doesn''t affect ALTER TABLE index rebuilds
CREATE TABLE testschema.test_default_tab(id bigint) TABLESPACE regress_tblspace
ERROR: 

-- check that default_tablespace doesn''t affect ALTER TABLE index rebuilds
CREATE TABLE testschema.test_default_tab(id bigint) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

INSERT INTO testschema.test_default_tab VALUES (1)
ERROR: 
INSERT INTO testschema.test_default_tab VALUES (1)

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

CREATE INDEX test_index1 on testschema.test_default_tab (id)
ERROR: 
CREATE INDEX test_index1 on testschema.test_default_tab (id)

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

CREATE INDEX test_index2 on testschema.test_default_tab (id) TABLESPACE regress_tblspace
ERROR: 
CREATE INDEX test_index2 on testschema.test_default_tab (id) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

ALTER TABLE testschema.test_default_tab ADD CONSTRAINT test_index3 PRIMARY KEY (id)
ERROR: 
ALTER TABLE testschema.test_default_tab ADD CONSTRAINT test_index3 PRIMARY KEY (id)

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE testschema.test_default_tab ADD CONSTRAINT test_index4 UNIQUE (id) USING INDEX TABLESPACE regress_tblspace
ERROR: 
ALTER TABLE testschema.test_default_tab ADD CONSTRAINT test_index4 UNIQUE (id) USING INDEX TABLESPACE regress_tblspace

Parser Error: syntax error at or near "USING"


-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- use a custom tablespace for default_tablespace
SET default_tablespace TO regress_tblspace
ERROR: 

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- use a custom tablespace for default_tablespace
SET default_tablespace TO regress_tblspace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE bigint
ERROR: 
-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE bigint

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE int
ERROR: 
-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE int

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

-- now use the default tablespace for default_tablespace
SET default_tablespace TO ''
ERROR: 
-- now use the default tablespace for default_tablespace
SET default_tablespace TO ''

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE int
ERROR: 
-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE int

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE bigint
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab ALTER id TYPE bigint

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
DROP TABLE testschema.test_default_tab
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
DROP TABLE testschema.test_default_tab

Catalog Error: Table with name test_default_tab does not exist!
Did you mean "memory.TEXT_TBL"?


-- check that default_tablespace doesn''t affect ALTER TABLE index rebuilds
-- (this time with a partitioned table)
CREATE TABLE testschema.test_default_tab_p(id bigint, val bigint)
    PARTITION BY LIST (id) TABLESPACE regress_tblspace
ERROR: 

-- check that default_tablespace doesn''t affect ALTER TABLE index rebuilds
-- (this time with a partitioned table)
CREATE TABLE testschema.test_default_tab_p(id bigint, val bigint)
    PARTITION BY LIST (id) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "PARTITION"

CREATE TABLE testschema.test_default_tab_p1 PARTITION OF testschema.test_default_tab_p
    FOR VALUES IN (1)
ERROR: 
CREATE TABLE testschema.test_default_tab_p1 PARTITION OF testschema.test_default_tab_p
    FOR VALUES IN (1)

Parser Error: syntax error at or near "PARTITION"

INSERT INTO testschema.test_default_tab_p VALUES (1)
ERROR: 
INSERT INTO testschema.test_default_tab_p VALUES (1)

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

CREATE INDEX test_index1 on testschema.test_default_tab_p (val)
ERROR: 
CREATE INDEX test_index1 on testschema.test_default_tab_p (val)

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

CREATE INDEX test_index2 on testschema.test_default_tab_p (val) TABLESPACE regress_tblspace
ERROR: 
CREATE INDEX test_index2 on testschema.test_default_tab_p (val) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

ALTER TABLE testschema.test_default_tab_p ADD CONSTRAINT test_index3 PRIMARY KEY (id)
ERROR: 
ALTER TABLE testschema.test_default_tab_p ADD CONSTRAINT test_index3 PRIMARY KEY (id)

Not implemented Error: No support for that ALTER TABLE option yet!

ALTER TABLE testschema.test_default_tab_p ADD CONSTRAINT test_index4 UNIQUE (id) USING INDEX TABLESPACE regress_tblspace
ERROR: 
ALTER TABLE testschema.test_default_tab_p ADD CONSTRAINT test_index4 UNIQUE (id) USING INDEX TABLESPACE regress_tblspace

Parser Error: syntax error at or near "USING"


-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- use a custom tablespace for default_tablespace
SET default_tablespace TO regress_tblspace
ERROR: 

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- use a custom tablespace for default_tablespace
SET default_tablespace TO regress_tblspace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE bigint
ERROR: 
-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE bigint

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab_p
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab_p

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE int
ERROR: 
-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE int

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab_p
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
SELECT * FROM testschema.test_default_tab_p

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

-- now use the default tablespace for default_tablespace
SET default_tablespace TO ''
ERROR: 
-- now use the default tablespace for default_tablespace
SET default_tablespace TO ''

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE int
ERROR: 
-- tablespace should not change if no rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE int

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE bigint
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
-- tablespace should not change even if there is an index rewrite
ALTER TABLE testschema.test_default_tab_p ALTER val TYPE bigint

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?

-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
DROP TABLE testschema.test_default_tab_p
ERROR: 
-- \d testschema.test_index1
-- \d testschema.test_index2
-- \d testschema.test_index3
-- \d testschema.test_index4
DROP TABLE testschema.test_default_tab_p

Catalog Error: Table with name test_default_tab_p does not exist!
Did you mean "memory.TEXT_TBL"?


-- check that default_tablespace affects index additions in ALTER TABLE
CREATE TABLE testschema.test_tab(id int) TABLESPACE regress_tblspace
ERROR: 

-- check that default_tablespace affects index additions in ALTER TABLE
CREATE TABLE testschema.test_tab(id int) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

INSERT INTO testschema.test_tab VALUES (1)
ERROR: 
INSERT INTO testschema.test_tab VALUES (1)

Catalog Error: Table with name test_tab does not exist!
Did you mean "memory.TEXT_TBL"?

SET default_tablespace TO regress_tblspace
ERROR: 
SET default_tablespace TO regress_tblspace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

ALTER TABLE testschema.test_tab ADD CONSTRAINT test_tab_unique UNIQUE (id)
ERROR: 
ALTER TABLE testschema.test_tab ADD CONSTRAINT test_tab_unique UNIQUE (id)

Not implemented Error: No support for that ALTER TABLE option yet!

SET default_tablespace TO ''
ERROR: 
SET default_tablespace TO ''

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

ALTER TABLE testschema.test_tab ADD CONSTRAINT test_tab_pkey PRIMARY KEY (id)
ERROR: 
ALTER TABLE testschema.test_tab ADD CONSTRAINT test_tab_pkey PRIMARY KEY (id)

Not implemented Error: No support for that ALTER TABLE option yet!

-- \d testschema.test_tab_unique
-- \d testschema.test_tab_pkey
SELECT * FROM testschema.test_tab
ERROR: 
-- \d testschema.test_tab_unique
-- \d testschema.test_tab_pkey
SELECT * FROM testschema.test_tab

Catalog Error: Table with name test_tab does not exist!
Did you mean "memory.TEXT_TBL"?

DROP TABLE testschema.test_tab
ERROR: 
DROP TABLE testschema.test_tab

Catalog Error: Table with name test_tab does not exist!
Did you mean "memory.TEXT_TBL"?


-- check that default_tablespace is handled correctly by multi-command
-- ALTER TABLE that includes a tablespace-preserving rewrite
CREATE TABLE testschema.test_tab(a int, b int, c int)

SET default_tablespace TO regress_tblspace
ERROR: 
SET default_tablespace TO regress_tblspace

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

ALTER TABLE testschema.test_tab ADD CONSTRAINT test_tab_unique UNIQUE (a)
ERROR: 
ALTER TABLE testschema.test_tab ADD CONSTRAINT test_tab_unique UNIQUE (a)

Not implemented Error: No support for that ALTER TABLE option yet!

CREATE INDEX test_tab_a_idx ON testschema.test_tab (a)

SET default_tablespace TO ''
ERROR: 
SET default_tablespace TO ''

Catalog Error: unrecognized configuration parameter "default_tablespace"

Did you mean: "default_order"

CREATE INDEX test_tab_b_idx ON testschema.test_tab (b)

-- \d testschema.test_tab_unique
-- \d testschema.test_tab_a_idx
-- \d testschema.test_tab_b_idx
ALTER TABLE testschema.test_tab ALTER b TYPE bigint, ADD UNIQUE (c)
ERROR: 
-- \d testschema.test_tab_unique
-- \d testschema.test_tab_a_idx
-- \d testschema.test_tab_b_idx
ALTER TABLE testschema.test_tab ALTER b TYPE bigint, ADD UNIQUE (c)

Parser Error: Only one ALTER command per statement is supported

-- \d testschema.test_tab_unique
-- \d testschema.test_tab_a_idx
-- \d testschema.test_tab_b_idx
DROP TABLE testschema.test_tab


-- let''s try moving a table from one place to another
CREATE TABLE testschema.atable AS VALUES (1), (2)

CREATE UNIQUE INDEX anindex ON testschema.atable(column1)
ERROR: 
CREATE UNIQUE INDEX anindex ON testschema.atable(column1)

Binder Error: Table "atable" does not have a column named "column1"


ALTER TABLE testschema.atable SET TABLESPACE regress_tblspace
ERROR: 

ALTER TABLE testschema.atable SET TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

ALTER INDEX testschema.anindex SET TABLESPACE regress_tblspace
ERROR: 
ALTER INDEX testschema.anindex SET TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

ALTER INDEX testschema.part_a_idx SET TABLESPACE pg_global
ERROR: 
ALTER INDEX testschema.part_a_idx SET TABLESPACE pg_global

Parser Error: syntax error at or near "TABLESPACE"

ALTER INDEX testschema.part_a_idx SET TABLESPACE pg_default
ERROR: 
ALTER INDEX testschema.part_a_idx SET TABLESPACE pg_default

Parser Error: syntax error at or near "TABLESPACE"

ALTER INDEX testschema.part_a_idx SET TABLESPACE regress_tblspace
ERROR: 
ALTER INDEX testschema.part_a_idx SET TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"


INSERT INTO testschema.atable VALUES(3)
	-- ok
INSERT INTO testschema.atable VALUES(1)
	-- fail (checks index)
SELECT COUNT(*) FROM testschema.atable
RESULT: 
	[(4,)]
		-- checks heap

-- let''s try moving a materialized view from one place to another
CREATE MATERIALIZED VIEW testschema.amv AS SELECT * FROM testschema.atable
ERROR: 		-- checks heap

-- let''s try moving a materialized view from one place to another
CREATE MATERIALIZED VIEW testschema.amv AS SELECT * FROM testschema.atable

Parser Error: syntax error at or near "MATERIALIZED"

ALTER MATERIALIZED VIEW testschema.amv SET TABLESPACE regress_tblspace
ERROR: 
ALTER MATERIALIZED VIEW testschema.amv SET TABLESPACE regress_tblspace

Parser Error: syntax error at or near "MATERIALIZED"

REFRESH MATERIALIZED VIEW testschema.amv
ERROR: 
REFRESH MATERIALIZED VIEW testschema.amv

Parser Error: syntax error at or near "REFRESH"

SELECT COUNT(*) FROM testschema.amv
ERROR: 
SELECT COUNT(*) FROM testschema.amv

Catalog Error: Table with name amv does not exist!
Did you mean "temp.pg_catalog.pg_am"?


-- Will fail with bad path
CREATE TABLESPACE regress_badspace LOCATION '/no/such/location'
ERROR: 

-- Will fail with bad path
CREATE TABLESPACE regress_badspace LOCATION '/no/such/location'

Parser Error: syntax error at or near "TABLESPACE"


-- No such tablespace
CREATE TABLE bar (i int) TABLESPACE regress_nosuchspace
ERROR: 

-- No such tablespace
CREATE TABLE bar (i int) TABLESPACE regress_nosuchspace

Parser Error: syntax error at or near "TABLESPACE"


-- Fail, in use for some partitioned object
DROP TABLESPACE regress_tblspace
ERROR: 

-- Fail, in use for some partitioned object
DROP TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

ALTER INDEX testschema.part_a_idx SET TABLESPACE pg_default
ERROR: 
ALTER INDEX testschema.part_a_idx SET TABLESPACE pg_default

Parser Error: syntax error at or near "TABLESPACE"

-- Fail, not empty
DROP TABLESPACE regress_tblspace
ERROR: 
-- Fail, not empty
DROP TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"


CREATE ROLE regress_tablespace_user1 login
ERROR: 

CREATE ROLE regress_tablespace_user1 login

Parser Error: syntax error at or near "ROLE"

CREATE ROLE regress_tablespace_user2 login
ERROR: 
CREATE ROLE regress_tablespace_user2 login

Parser Error: syntax error at or near "ROLE"

GRANT USAGE ON SCHEMA testschema TO regress_tablespace_user2
ERROR: 
GRANT USAGE ON SCHEMA testschema TO regress_tablespace_user2

Parser Error: syntax error at or near "GRANT"


ALTER TABLESPACE regress_tblspace OWNER TO regress_tablespace_user1
ERROR: 

ALTER TABLESPACE regress_tblspace OWNER TO regress_tablespace_user1

Parser Error: syntax error at or near "TABLESPACE"


CREATE TABLE testschema.tablespace_acl (c int)

-- new owner lacks permission to create this index from scratch
CREATE INDEX k ON testschema.tablespace_acl (c) TABLESPACE regress_tblspace
ERROR: 
-- new owner lacks permission to create this index from scratch
CREATE INDEX k ON testschema.tablespace_acl (c) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"

ALTER TABLE testschema.tablespace_acl OWNER TO regress_tablespace_user2
ERROR: 
ALTER TABLE testschema.tablespace_acl OWNER TO regress_tablespace_user2

Parser Error: syntax error at or near "OWNER"


SET SESSION ROLE regress_tablespace_user2
ERROR: 

SET SESSION ROLE regress_tablespace_user2

Parser Error: syntax error at or near "regress_tablespace_user2"

CREATE TABLE tablespace_table (i int) TABLESPACE regress_tblspace
ERROR: 
CREATE TABLE tablespace_table (i int) TABLESPACE regress_tblspace

Parser Error: syntax error at or near "TABLESPACE"
 -- fail
ALTER TABLE testschema.tablespace_acl ALTER c TYPE bigint

REINDEX (TABLESPACE regress_tblspace) TABLE tablespace_table
ERROR: 
REINDEX (TABLESPACE regress_tblspace) TABLE tablespace_table

Parser Error: syntax error at or near "REINDEX"
 -- fail
REINDEX (TABLESPACE regress_tblspace, CONCURRENTLY) TABLE tablespace_table
ERROR:  -- fail
REINDEX (TABLESPACE regress_tblspace, CONCURRENTLY) TABLE tablespace_table

Parser Error: syntax error at or near "REINDEX"
 -- fail
RESET ROLE
ERROR:  -- fail
RESET ROLE

Catalog Error: unrecognized configuration parameter "ROLE"

Did you mean: "threads", "Calendar", "profile_output", "errors_as_json", "home_directory"


ALTER TABLESPACE regress_tblspace RENAME TO regress_tblspace_renamed
ERROR: 

ALTER TABLESPACE regress_tblspace RENAME TO regress_tblspace_renamed

Parser Error: syntax error at or near "TABLESPACE"


ALTER TABLE ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default
ERROR: 

ALTER TABLE ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default

Parser Error: syntax error at or near "ALL"

ALTER INDEX ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default
ERROR: 
ALTER INDEX ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default

Parser Error: syntax error at or near "ALL"

ALTER MATERIALIZED VIEW ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default
ERROR: 
ALTER MATERIALIZED VIEW ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default

Parser Error: syntax error at or near "MATERIALIZED"


-- Should show notice that nothing was done
ALTER TABLE ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default
ERROR: 

-- Should show notice that nothing was done
ALTER TABLE ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default

Parser Error: syntax error at or near "ALL"

ALTER MATERIALIZED VIEW ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default
ERROR: 
ALTER MATERIALIZED VIEW ALL IN TABLESPACE regress_tblspace_renamed SET TABLESPACE pg_default

Parser Error: syntax error at or near "MATERIALIZED"


-- Should succeed
DROP TABLESPACE regress_tblspace_renamed
ERROR: 

-- Should succeed
DROP TABLESPACE regress_tblspace_renamed

Parser Error: syntax error at or near "TABLESPACE"


DROP SCHEMA testschema CASCADE


DROP ROLE regress_tablespace_user1
ERROR: 

DROP ROLE regress_tablespace_user1

Parser Error: syntax error at or near "ROLE"

DROP ROLE regress_tablespace_user2
ERROR: 
DROP ROLE regress_tablespace_user2

Parser Error: syntax error at or near "ROLE"


